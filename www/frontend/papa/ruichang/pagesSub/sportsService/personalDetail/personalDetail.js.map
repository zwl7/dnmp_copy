{"version":3,"file":"personalDetail.js","sources":["../../../../../../src/pagesSub/sportsService/personalDetail/personalDetail.vue","../../../../../../uniPage:/cGFnZXNTdWIvc3BvcnRzU2VydmljZS9wZXJzb25hbERldGFpbC9wZXJzb25hbERldGFpbC52dWU"],"sourcesContent":["<template>\n  <view>\n    <navBar\n      navColor=\"#fff\"\n      title=\"个人资料\"\n      titleColor=\"#323233\"\n      backColor=\"#323233\"\n      :showBack=\"true\"\n    ></navBar>\n    <view class=\"personal-detail\" :style=\"{ 'margin-top': marginTop + 'rpx' }\">\n      <uv-form\n        labelPosition=\"left\"\n        :model=\"form\"\n        :rules=\"rules\"\n        labelWidth=\"100\"\n        errorType=\"toast\"\n        ref=\"formRef\"\n      >\n        <uv-form-item label=\"头像\" prop=\"avatar\" :borderBottom=\"true\" ref=\"item1\">\n          <template #right>\n            <view class=\"flex items-center\">\n              <!-- <u-avatar\n                v-if=\"form.avatar\"\n                :src=\"form.avatar\"\n                size=\"30\"\n                @click=\"replaceAvatar\"\n              ></u-avatar>\n              <u-avatar\n                v-else\n                :text=\"form.name.substr(2, 5)\"\n                fontSize=\"13\"\n                class=\"user-img\"\n                bg-color=\"rgb(114, 220, 220)\"\n              ></u-avatar> -->\n              <view class=\"img-wrap\">\n                <image\n                  :src=\"form.avatar ? form.avatar : default_img\"\n                  alt=\"头像\"\n                  @click=\"replaceAvatar\"\n                />\n              </view>\n              <uv-icon name=\"arrow-right\" color=\"#969799\" @click=\"replaceAvatar\"></uv-icon>\n            </view>\n          </template>\n        </uv-form-item>\n\n        <uv-form-item label=\"昵称\" prop=\"nick_name\" :borderBottom=\"true\" ref=\"item1\">\n          <template #right>\n            <view class=\"flex items-center\">\n              <uv-input v-model=\"form.nick_name\" border=\"none\" placeholder=\"请输入昵称\" />\n              <uv-icon name=\"arrow-right\" color=\"#969799\"></uv-icon>\n            </view>\n          </template>\n        </uv-form-item>\n\n        <uv-form-item label=\"手机号\" prop=\"phone\" :borderBottom=\"true\" ref=\"item1\">\n          <template #right>\n            <view class=\"flex items-center\">\n              {{ form.phone }}\n            </view>\n          </template>\n        </uv-form-item>\n        <uv-form-item label=\"实名认证\" prop=\"guide\" ref=\"item1\" :borderBottom=\"true\">\n          <template #right>\n            <view class=\"flex items-center\" @click=\"toValidate\">\n              <text>{{ form.guide }}</text>\n              <uv-icon v-if=\"form.guide == '去认证'\" name=\"arrow-right\" color=\"#969799\"></uv-icon>\n            </view>\n          </template>\n        </uv-form-item>\n\n        <uv-form-item\n          label=\"我的身份\"\n          prop=\"nick_name\"\n          :borderBottom=\"true\"\n          ref=\"item1\"\n          @click=\"toMyIdentity\"\n        >\n          <template #right>\n            <view class=\"flex items-center\">\n              <uv-icon name=\"arrow-right\" color=\"#969799\"></uv-icon>\n            </view>\n          </template>\n        </uv-form-item>\n      </uv-form>\n      <view class=\"footer-fixed\">\n        <button class=\"logout-btn flx-center\" size=\"medium\" @click=\"handleLogout\">\n          退出当前账号\n        </button>\n        <button class=\"save-btn flx-center\" size=\"medium\" @click=\"save\">保存资料</button>\n      </view>\n    </view>\n    <canvas canvas-id=\"canvas\" id=\"canvas\" style=\"visibility: hidden\"></canvas>\n  </view>\n</template>\n<script>\nimport { rules } from './index'\nimport navBar from '@/components/navBar/index.vue'\nimport default_img from '@/static/images/default-avatar.png'\nimport { chooseImage } from '@/utils/index'\nimport { uploadPic, wxMemberLogout, wxMemberUpdate } from '@/apis/common.js'\nexport default {\n  components: {\n    navBar,\n  },\n  data() {\n    return {\n      default_img,\n      marginTop: '',\n      rules,\n      form: {\n        name: '',\n        avatar: '',\n        phone: '',\n        guide: '',\n        fileList: [],\n      },\n      userInfo: {},\n    }\n  },\n  onShow() {\n    const app = getApp()\n    let { navBarHeight, menuTop, userInfo } = app.globalData\n    this.marginTop = navBarHeight + menuTop\n    this.userInfo = userInfo\n    this.form = {\n      ...userInfo,\n      avatar: userInfo.avatar_url,\n      guide: userInfo.is_auth == 1 ? '已认证' : '未认证',\n      fileList: [\n        {\n          url: userInfo.avatar_url,\n        },\n      ],\n    }\n  },\n  methods: {\n    toMyIdentity() {\n      // 判断是否实名,未实名则跳转到实名认证页面\n      uni.navigateTo({\n        url: '/pagesSub/sportsService/realAuth/myIdentity',\n      })\n    },\n    toValidate() {\n      if (this.userInfo.is_auth == 1) {\n        // uni.showToast({\n        // \ttitle: '您已认证',\n        // \ticon: 'none'\n        // });\n        return\n      }\n      let app = getApp()\n      let phone = app.globalData.userInfo.phone\n      uni.navigateTo({\n        url: '/pages/register/register?phone=' + phone,\n      })\n    },\n    async save() {\n      try {\n        await this.$refs.formRef\n          .validate()\n          .then(async () => {\n            let params = {\n              avatar: this.form.avatar,\n              nick_name: this.form.nick_name,\n            }\n            let app = getApp()\n            let res = await wxMemberUpdate(params)\n            if (res.code == 200) {\n              app.globalData.userInfo.avatar_url = this.form.avatar\n              app.globalData.userInfo.nick_name = this.form.nick_name\n              uni.showToast({\n                title: '保存成功',\n                icon: 'success',\n              })\n              setTimeout(() => {\n                uni.reLaunch({\n                  url: '/pages/tabbar/newMine/newMine',\n                })\n              }, 1000)\n            } else {\n              uni.showToast({\n                title: res.message,\n                icon: 'none',\n              })\n            }\n          })\n          .catch((errors) => {\n            console.warn('error', errors)\n          })\n      } catch (error) {\n        console.warn('error', error)\n      }\n    },\n    async handleLogout() {\n      uni.showModal({\n        title: '',\n        content: '确定要退出登录吗?',\n        showCancel: true,\n        success: async (t) => {\n          if (t.confirm) {\n            let res = await wxMemberLogout({ type: 'mini_app' })\n            if (res.code == 200) {\n              let app = getApp()\n              uni.showToast({\n                title: '退出成功',\n                icon: 'success',\n                duration: 1500,\n              })\n              let defaultUserInfo = {\n                userInfo: {\n                  phone: '',\n                  nick_name: '',\n                  name: '',\n                  avatar_url: '',\n                  is_auth: -1,\n                },\n                is_get_loginInfo: false,\n                is_login: false,\n                token: '',\n                isAuth: false,\n              }\n              app.globalData = {\n                ...app.globalData,\n                ...defaultUserInfo,\n              }\n              await app.handleLogin()\n              uni.reLaunch({\n                url: '/pages/tabbar/newHome/newHome',\n              })\n            }\n          }\n        },\n      })\n    },\n    async replaceAvatar() {\n      const res = await chooseImage('canvas')\n      if (res.status) {\n        uploadPic({ filePath: res.file }).then((resp) => {\n          let res = JSON.parse(resp.data)\n          if (res.code == 200) {\n            this.form.avatar = res.data.imgUrl\n          } else {\n            this.$toast(res.message)\n          }\n        })\n      }\n    },\n  },\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.personal-detail {\n  padding: 32rpx;\n  .logout-btn {\n    min-width: 330rpx;\n    height: 80rpx;\n    opacity: 1;\n    border-radius: 200rpx;\n    background: $hubei-plain-button-bg-color;\n    border: 1px solid $hubei-plain-button-border-color;\n    color: $hubei-plain-button-font-color;\n    font-size: 28rpx;\n    font-weight: 500;\n  }\n  .save-btn {\n    min-width: 330rpx;\n    height: 80rpx;\n    opacity: 1;\n    border-radius: 200rpx;\n    background: $hubei-primary-button-bg-color;\n    color: $hubei-primary-button-font-color;\n    border: 1px solid $hubei-primary-button-border-color;\n    font-size: 28rpx;\n    font-weight: 500;\n  }\n  .img-wrap {\n    margin-right: 10rpx;\n\n    image {\n      width: 72rpx;\n      height: 72rpx;\n      border-radius: 50%;\n    }\n  }\n  :deep(.uv-input__content__field-wrapper__field) {\n    text-align: right !important;\n  }\n  :deep(.uv-line) {\n    border-color: #f5f5f5 !important;\n  }\n  :deep(.uv-form-item__body) {\n    padding: 28rpx 0;\n  }\n}\n\n// :deep(.uni-page-head) {\n//   box-sizing: unset;\n// }#EBEDF0\n</style>\n","import MiniProgramPage from '/Users/guoxiaoming/code/papa-code/pm-yn/uniapp-social-sports-new/src/pagesSub/sportsService/personalDetail/personalDetail.vue'\nwx.createPage(MiniProgramPage)"],"names":["default_img","rules","uni","wxMemberUpdate","wxMemberLogout","chooseImage","uploadPic","res"],"mappings":"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"}