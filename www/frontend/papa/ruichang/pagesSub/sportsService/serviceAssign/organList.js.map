{"version":3,"file":"organList.js","sources":["../../../../../../src/pagesSub/sportsService/serviceAssign/organList.vue","../../../../../../uniPage:/cGFnZXNTdWIvc3BvcnRzU2VydmljZS9zZXJ2aWNlQXNzaWduL29yZ2FuTGlzdC52dWU"],"sourcesContent":["<template>\n  <view class=\"service-assign\">\n    <navBar\n      :navColor=\"'transparent'\"\n      title=\"组织派单\"\n      titleColor=\"#323233\"\n      backColor=\"#323233\"\n      :showBack=\"true\"\n    ></navBar>\n    <view class=\"header\">\n      <!-- 顶部渐变背景+标题+背景图 -->\n      <view class=\"order-header\">\n        <view class=\"header-content\" @click=\"checkOrganList\">\n          <view class=\"header-title\">\n            {{ currentOrgan.name }}\n            <uv-icon name=\"arrow-right\" size=\"16\" color=\"\" class=\"icon\"></uv-icon>\n          </view>\n          <!-- <view class=\"header-desc\">轻松享健身服务</view> -->\n        </view>\n      </view>\n      <!--  customStyle=\"width: 100%;height: 80rpx;\" -->\n      <!-- itemStyle=\"width: 45%;line-height:60rpx;\" -->\n      <uv-tabs\n        :list=\"tabs\"\n        customStyle=\"width: 100%;height: 80rpx;\"\n        itemStyle=\"width: 50%;height: 80rpx;box-sizing: border-box\"\n        @click=\"changeTabs\"\n        lineColor=\"#303133\"\n      ></uv-tabs>\n      <view style=\"margin-top: 34rpx\">\n        <searchForm\n          :statusList=\"statusList\"\n          :typeList=\"typeList\"\n          @search=\"hanldeSearch\"\n        ></searchForm>\n      </view>\n      <!-- <view class=\"tabs\">\n        <view\n          v-for=\"(tab, index) in tabs\"\n          :key=\"index\"\n          :class=\"['tab-item', currentTab === index ? 'active' : '']\"\n          @click=\"handleTabChange(index)\"\n        >\n          {{ tab.name }}\n          <text class=\"count\">({{ tab.count }})</text>\n        </view>\n      </view> -->\n    </view>\n    <!-- 滑动tab栏 -->\n    <view class=\"order-list\">\n      <!-- :showApplyBtn=\"currentTab === 0\" -->\n      <service-order-item\n        v-for=\"(item, index) in list\"\n        :key=\"index + 'orderItem'\"\n        :item=\"item\"\n        @accept=\"handleAccept\"\n        @reject=\"handleReject\"\n        @detail=\"handleDetail\"\n      />\n      <empty v-if=\"showEmpty\"></empty>\n      <loadMore :status=\"loadStatus\" v-if=\"showLoadMore\" />\n    </view>\n    <!-- 类型选择 -->\n    <uv-action-sheet\n      ref=\"organListRef\"\n      :actions=\"organActions\"\n      :title=\"organActions.length > 0 ? '请选择组织' : '暂无组织'\"\n      @select=\"onOrganSelect\"\n      round\n    />\n  </view>\n</template>\n\n<script>\nimport ServiceOrderItem from './components/ServiceOrderItem.vue'\nimport listMixins from '@/mixins/listMixins.js'\nimport {\n  getOrgDispatchList,\n  orgDispatch,\n  platformDispatch,\n} from '@/apis/sportsService/serviceAssign.js'\nimport searchForm from './components/searchForm.vue'\nimport { useUserStore } from '@/store'\nimport { getServicesDictPage, getPersonnelAuth } from '@/apis/sportsService/common'\nexport default {\n  components: {\n    ServiceOrderItem,\n    searchForm,\n  },\n  mixins: [listMixins],\n  data() {\n    return {\n      tabs: [\n        { name: '待处理', count: 8, key: 'org_wait' },\n        { name: '全部', count: 3, key: '' },\n      ],\n      currentTab: 0,\n      orderList: [],\n      page: 1,\n      pageSize: 10,\n      loadMoreStatus: 'loadmore',\n      isRefreshing: false,\n      typeList: [],\n      statusList: [],\n      formSearch: {\n        dictId: '',\n        serveWorkStatStatus: '',\n        serveWorkDevStatus: 'org_wait',\n      },\n      currentOrgan: {\n        resource_id: '',\n        name: '',\n      },\n      organActions: [],\n    }\n  },\n  async onShow() {\n    this.resetData()\n  },\n  async mounted() {\n    this.handelGetServicesDictPage()\n    // 获取状态\n    const data = useUserStore().getEnumListByKey('serveWorkStatStatus') || []\n    console.log({ data })\n    data.unshift({ label: '全部', value: '' })\n    this.statusList = data.map((item) => ({\n      name: item.label,\n      value: item.value,\n    }))\n  },\n\n  methods: {\n    // 获取订单列表\n    async getList(refresh = false) {\n      if (!this.currentOrgan.resource_id) {\n        await this.getIdentityList()\n      }\n      let param = {\n        page: this.page,\n        size: 10,\n        ...this.formSearch,\n        organizationId: this.currentOrgan.resource_id,\n      }\n\n      // 模拟接口请求\n      // await new Promise((resolve) => setTimeout(resolve, 500))\n      const res = await getOrgDispatchList(param)\n      this.getListExtend(res, refresh)\n      // this.list = list\n    },\n    onOrganSelect(organ) {\n      console.log({ organ })\n      this.currentOrgan = organ\n      this.resetData()\n    },\n    // 打开组织\n    checkOrganList() {\n      this.$refs.organListRef.open()\n    },\n    hanldeSearch(formSearch) {\n      this.formSearch = Object.assign(this.formSearch, formSearch)\n      this.resetData()\n    },\n    // 切换tab栏\n    changeTabs(e) {\n      console.log({ e })\n      this.formSearch.serveWorkDevStatus = e.key\n      this.resetData()\n    },\n    // 获取服务类型\n    async handelGetServicesDictPage() {\n      const res = await getServicesDictPage({ dict_type_sign: 'service_type' })\n      if (res.code === 0) {\n        this.typeList = res.data.listData || []\n        this.typeList.unshift({ name: '全部', dictId: '' })\n      }\n    },\n    // 点击列表项\n    handleDetail(item) {\n      uni.navigateTo({\n        url: `/pagesSub/sportsService/serviceAssign/detail?id=${item.serveWorkId}&mode=org&orgId=${this.currentOrgan.resource_id}`,\n      })\n    },\n    // 获取组织列表\n    async getIdentityList() {\n      const res = await getPersonnelAuth()\n      if (res.code === 200) {\n        console.log({ res })\n        const actions = res.data\n          .filter((item) => item.resource_type == '1')\n          .map((item) => ({\n            name: item.resource_name,\n            resource_id: item.resource_id,\n          }))\n        console.log({ actions })\n\n        this.organActions = actions\n        this.currentOrgan = actions[0]\n        return 'ok'\n      }\n    },\n    // 接单\n    async handleAccept(item) {\n      console.log({ item })\n      //  const res = await platformDispatch({ processType: 'platform', serveWorkId: item.serveWorkId, })\n      //  if (res.code === 0) {\n      //    // 弹窗提示\n      //    uni.showToast({\n      //      title: '接单成功',\n      //      icon: 'success',\n      //    })\n      //    this.resetData()\n      //  }\n      // 携带id跳转到详情页面\n      uni.navigateTo({\n        url: `/pagesSub/sportsService/serviceAssign/detail?id=${item.serveWorkId}`,\n      })\n    },\n    // 拒单\n    async handleReject(item, fn) {\n      console.log({ item })\n      const res = await platformDispatch({\n        processType: 'reject',\n        serveWorkId: item.serveWorkId,\n        rejectReason: item.rejectReason,\n      })\n      if (res.code === 0) {\n        uni.showToast({\n          title: '拒单成功',\n          icon: 'success',\n        })\n        this.resetData()\n        fn()\n      }\n    },\n    // 完成服务\n    async handleComplete(item) {\n      uni.showModal({\n        title: '提示',\n        content: '确认完成服务吗？',\n        success: (res) => {\n          if (res.confirm) {\n            uni.showToast({\n              title: '操作成功',\n              icon: 'success',\n            })\n            this.getOrgDispatchList(true)\n          }\n        },\n      })\n    },\n  },\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.service-assign {\n  min-height: 100vh;\n  background-color: $hubei-list-page-bg-color;\n\n  .header {\n    // padding: 20px 30px;\n    // background-color: #fff;\n\n    .title {\n      margin-bottom: 20px;\n      font-size: 16px;\n      font-weight: bold;\n    }\n\n    .tabs {\n      display: flex;\n      border-bottom: 1px solid #eee;\n\n      .tab-item {\n        position: relative;\n        flex: 1;\n        padding: 20px 0;\n        font-size: 14px;\n        color: #666;\n        text-align: center;\n\n        .count {\n          font-size: 12px;\n          color: #999;\n        }\n\n        &.active {\n          font-weight: bold;\n          color: #2979ff;\n\n          &::after {\n            position: absolute;\n            bottom: -1px;\n            left: 50%;\n            width: 40px;\n            height: 4px;\n            content: '';\n            background-color: #2979ff;\n            transform: translateX(-50%);\n          }\n        }\n      }\n    }\n  }\n}\n\n.tab-bar-scroll {\n  width: 100vw;\n  background: transparent;\n  margin-top: -32rpx;\n  margin-bottom: 12rpx;\n}\n\n.tab-bar {\n  display: flex;\n  background: #fff;\n  border-radius: 40rpx;\n  box-shadow: 0 2rpx 8rpx #eaf9d6;\n  padding: 8rpx 12rpx;\n  margin: 0 24rpx;\n  overflow-x: auto;\n\n  .tab-item {\n    min-width: 120rpx;\n    padding: 12rpx 0;\n    margin: 0 12rpx;\n    font-size: 28rpx;\n    color: #888;\n    text-align: center;\n    border-radius: 32rpx;\n    background: transparent;\n    transition: all 0.2s;\n\n    &.active {\n      color: #fff;\n      background: linear-gradient(90deg, #b6f730 0%, #7bb800 100%);\n      font-weight: 700;\n      box-shadow: 0 2rpx 8rpx #b6f73044;\n    }\n  }\n}\n\n.order-header {\n  width: 100vw;\n  height: 370rpx;\n  background: url('https://cdn-static.papa.com.cn/social/sportsService/organAssignBg.png');\n  background-size: cover;\n  position: relative;\n  // margin-bottom: 20rpx;\n\n  .header-content {\n    position: absolute;\n    bottom: 50rpx;\n    left: 32rpx;\n    z-index: 2;\n\n    .header-title {\n      display: flex;\n      gap: 22rpx;\n      font-size: 32rpx;\n      font-weight: 500;\n      color: rgba(48, 49, 51, 1);\n      line-height: 44rpx;\n    }\n\n    .header-desc {\n      font-size: 32rpx;\n      color: rgba(48, 49, 51, 1);\n      background: linear-gradient(90deg, rgba(140, 244, 188, 1) 0%, rgba(225, 255, 122, 1) 100%);\n      display: inline-block;\n      border-radius: 26rpx;\n      padding: 0 24rpx;\n      line-height: 56rpx;\n    }\n  }\n}\n\n.order-list {\n  box-sizing: border-box;\n  padding: 36rpx 32rpx 24rpx;\n  background: transparent;\n}\n</style>\n","import MiniProgramPage from '/Users/guoxiaoming/code/papa-code/pm-yn/uniapp-social-sports-new/src/pagesSub/sportsService/serviceAssign/organList.vue'\nwx.createPage(MiniProgramPage)"],"names":["listMixins","useUserStore","getOrgDispatchList","getServicesDictPage","uni","getPersonnelAuth","platformDispatch"],"mappings":"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"}