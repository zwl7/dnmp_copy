{"version":3,"file":"index.js","sources":["../../../../../src/pages/login/index.js","../../../../../src/pages/login/index.vue","../../../../../uniPage:/cGFnZXMvbG9naW4vaW5kZXgudnVl"],"sourcesContent":["import { reg_tel_phone } from '@/utils/reg'\n\nexport const rules = {\n  phone: [\n    {\n      required: true,\n      message: '请填写手机号',\n      trigger: ['blur', 'change'],\n    },\n    {\n      pattern: reg_tel_phone,\n      message: '手机号格式不正确',\n    },\n  ],\n  code: [\n    {\n      required: true,\n      message: '请填写验证码',\n      trigger: ['blur', 'change'],\n    },\n  ],\n}\n","<template>\n  <view class=\"login-container\">\n    <image :src=\"login_avatar\" alt=\"\" class=\"logo\" />\n    <!-- #ifndef MP-WEIXIN -->\n    <div class=\"login-form-container\">\n      <uv-form\n        labelPosition=\"left\"\n        :model=\"form\"\n        :rules=\"rules\"\n        labelWidth=\"100\"\n        errorType=\"toast\"\n        ref=\"formRef\"\n      >\n        <uv-form-item prop=\"phone\" borderBottom ref=\"item1\">\n          <uv-input v-model=\"form.phone\" border=\"none\" placeholder=\"请输入手机号\">\n            <template #prefix>\n              <uv-icon :name=\"account\" color=\"#A8ABB2\" size=\"16\" class=\"icon\"></uv-icon>\n            </template>\n          </uv-input>\n        </uv-form-item>\n        <uv-form-item prop=\"code\" borderBottom ref=\"item1\">\n          <uv-input\n            v-model=\"form.code\"\n            border=\"none\"\n            :focus=\"focus\"\n            placeholder=\"短信验证码\"\n            maxlength=\"6\"\n          >\n            <template #prefix>\n              <uv-icon :name=\"phoneCode\" color=\"#A8ABB2\" size=\"16\" class=\"icon\"></uv-icon>\n            </template>\n            <template #suffix>\n              <view class=\"flex\">\n                <uv-code :seconds=\"seconds\" ref=\"uCodeRef\" @change=\"codeChange\"></uv-code>\n                <uv-button type=\"primary\" size=\"mini\" @tap=\"getCode\">{{ tips }}</uv-button>\n              </view>\n            </template>\n          </uv-input>\n        </uv-form-item>\n      </uv-form>\n    </div>\n    <!-- #endif -->\n    <view class=\"footer-container\">\n      <!-- #ifndef MP-WEIXIN -->\n      <view class=\"login-btn\">\n        <uv-button\n          type=\"primary\"\n          shape=\"circle\"\n          :loading=\"loading\"\n          loadingText=\"登录中\"\n          ripple\n          @click=\"handleH5Login\"\n        >\n          登录\n        </uv-button>\n      </view>\n      <!-- #endif -->\n\n      <!-- #ifdef MP-WEIXIN -->\n      <view class=\"login-btn\">\n        <uv-button\n          v-if=\"agreed.length > 0\"\n          type=\"primary\"\n          shape=\"circle\"\n          ripple\n          open-type=\"getPhoneNumber|agreePrivacyAuthorization\"\n          @getphonenumber=\"getphonenumber\"\n        >\n          手机号授权登录\n        </uv-button>\n        <uv-button\n          v-if=\"agreed.length == 0\"\n          type=\"primary\"\n          shape=\"circle\"\n          ripple\n          @click=\"handleClickAgree\"\n        >\n          手机号授权登录\n        </uv-button>\n      </view>\n      <!-- #endif -->\n\n      <view class=\"back-btn\" @click=\"handleBack\">返回首页</view>\n      <view class=\"footer-text mt-72rpx\">\n        <view>\n          <uv-checkbox-group v-model=\"agreed\">\n            <uv-checkbox :iconSize=\"15\" :name=\"1\" shape=\"circle\"></uv-checkbox>\n          </uv-checkbox-group>\n        </view>\n        <text>\n          我已阅读并同意\n          <text class=\"agree\" @click.stop=\"handleAgree\">《服务协议》</text>\n        </text>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script>\nimport { rules } from './index'\nimport account from '@/static/images/account.png'\nimport phoneCode from '@/static/images/phone-code.png'\nimport { reg_tel_phone } from '@/utils/reg'\nimport store from '@/store/index.js'\nimport { getEvnCompanyID } from '@/utils/index'\nimport themeMixins from '@/mixins/themeMixins'\nexport default {\n  mixins: [themeMixins],\n  data() {\n    return {\n      agreed: [],\n      account,\n      seconds: 60,\n      phoneCode,\n      tips: '',\n      focus: false,\n      loading: false,\n      rules,\n      form: {\n        phone: '',\n        code: '',\n        company_id: getEvnCompanyID(),\n      },\n    }\n  },\n  computed: {\n    login_avatar() {\n      return this.themeIconMapGetter['LOGIN_PAGE_AVATR']\n    },\n  },\n  onLoad() {\n    this.getCompanyInfo()\n  },\n  methods: {\n    async getCompanyInfo() {\n      const userStore = store.useUserStore()\n      let domain = userStore.domain\n      const res = await this.$api.getCompany({\n        domain: domain,\n      })\n      if (res.data.code == 200) {\n        if (res.data.data.company_id) {\n          this.form.company_id = res.data.data.company_id\n        }\n      }\n    },\n    handleAgree() {\n      uni.navigateTo({ url: '/pages-sub/statement/index' })\n    },\n    async handleH5Login() {\n      this.$refs.formRef.validate().then(async () => {\n        if (!this.agreed.length) {\n          try {\n            await this.$dialog('是否已阅读并同意《服务协议》?', {\n              showCancelButton: true,\n              confirmButtonText: '同意',\n              cancelButtonText: '取消',\n            })\n            this.agreed.push(1)\n          } catch (error) {\n            console.log('error', error)\n            return\n          }\n        }\n        this.loading = true\n        const res = await this.$api.loginByPhone(this.form)\n        if (res.code == 200) {\n          await this.$store.user.setToken(res.data.token)\n          await this.$store.user._setIsLogin(res.data.is_login)\n          await this.$toast('登录成功', { type: 'success' })\n          this.handleSuccess()\n          this.loading = false\n        } else {\n          this.$toast(res.message, { type: 'warning' })\n          this.loading = false\n        }\n      })\n    },\n    async handleSuccess() {\n      const user = this.$store.user\n      try {\n        await user.getUserInfo()\n        uni.reLaunch({ url: '/pages/tabbar/home/index' })\n      } catch (error) {\n        this.$toast(error, { type: 'warning' })\n        uni.reLaunch({ url: '/pages/tabbar/home/index' })\n        console.warn('error', error)\n      }\n    },\n    handleBack() {\n      uni.reLaunch({ url: '/pages/tabbar/home/index' })\n    },\n    async getCode() {\n      if (!this.form.phone) {\n        this.$toast('请填写手机号', { type: 'warning' })\n        return\n      }\n      if (!reg_tel_phone.test(this.form.phone)) {\n        this.$toast('手机号格式不正确', { type: 'warning' })\n        return\n      }\n      this.focus = true\n      await this.$api.getPhoneCode({ phone: this.form.phone, scene: 'MemberLogin' })\n      this.$refs.uCodeRef.start()\n    },\n    codeChange(text) {\n      this.tips = text\n    },\n\n    // 获取手机号\n    getphonenumber(e) {\n      console.log('e', e)\n      if (e && e.errMsg == 'getPhoneNumber:ok') {\n        let code = e.code\n        this.fnRequest({\n          code: code,\n          token: this.$store.user.token,\n        })\n      } else {\n        uni.showToast({\n          title: '获取手机号失败',\n          icon: 'none',\n        })\n        return\n      }\n    },\n    async fnRequest(info) {\n      let userInfo = info\n      let res = await this.$api.wxMiniAuthLogin(userInfo)\n      if (res.code !== 200) {\n        this.$toast(res.message)\n        return\n      }\n      await this.$store.user.setToken(res.data.token)\n      await this.$store.user._setIsLogin(true)\n      await this.handleSuccess()\n    },\n    async handleClickAgree() {\n      if (!this.agreed.length) {\n        try {\n          await this.$dialog('是否已阅读并同意《服务协议》?', {\n            showCancelButton: true,\n            confirmButtonText: '同意',\n            cancelButtonText: '取消',\n          })\n          this.agreed.push(1)\n        } catch (error) {\n          console.log('error', error)\n          return\n        }\n      }\n    },\n  },\n}\n</script>\n\n<style lang=\"scss\" scoped>\nuni-page-body {\n  border: none !important;\n}\n\n.login-container {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  min-height: 100vh;\n  background-color: #fff;\n  padding: 140rpx 48rpx 0;\n  box-sizing: border-box;\n\n  .logo {\n    width: 150rpx;\n    height: 164rpx;\n    margin-bottom: 106rpx;\n  }\n\n  .login-form-container {\n    width: 100%;\n\n    .icon {\n      padding-right: 30rpx;\n    }\n\n    .uni-input-placeholder {\n      font-size: 28rpx;\n      color: #a8abb2;\n    }\n\n    .uv-form-item {\n      border-bottom: 1px solid #e5e5e5;\n\n      .uv-form-item__body {\n        border: 1px solid red;\n      }\n    }\n  }\n\n  .footer-container {\n    width: 100%;\n\n    .login-btn {\n      margin: 88rpx 0 36rpx;\n    }\n\n    .back-btn {\n      text-align: center;\n      margin-bottom: 36rpx;\n      font-size: 28rpx;\n      color: #666;\n    }\n\n    .footer-text {\n      display: flex;\n      align-items: center;\n      justify-content: flex-start;\n      padding-left: 34rpx;\n      // justify-content: center;\n      font-size: 24rpx;\n      color: #999;\n\n      .agree {\n        color: #576b95;\n      }\n    }\n  }\n}\n\n.code-btn {\n  // height: 72rpx;\n  // width: 250rpx;\n  // color: #409eff;\n  // font-size: 28rpx;\n  // background-color: #f0f5ff;\n  // border: none;\n  // border-radius: 8rpx;\n}\n</style>\n","import MiniProgramPage from '/Users/guoxiaoming/code/papa-code/pm-yn/uniapp-social-sports-new/src/pages/login/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["reg_tel_phone","themeMixins","account","phoneCode","getEvnCompanyID","store","uni"],"mappings":"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"}