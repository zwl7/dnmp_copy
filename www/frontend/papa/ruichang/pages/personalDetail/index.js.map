{"version":3,"file":"index.js","sources":["../../../../../src/pages/personalDetail/index.js","../../../../../src/pages/personalDetail/index.vue","../../../../../uniPage:/cGFnZXMvcGVyc29uYWxEZXRhaWwvaW5kZXgudnVl"],"sourcesContent":["import { reg_tel_phone, reg_cp } from \"@/utils/reg\";\n\nexport const rules = {\n\tname: {\n\t\ttype: \"string\",\n\t\trequired: true,\n\t\tmessage: \"请填写姓名\",\n\t\ttrigger: [\"blur\", \"change\"]\n\t},\n\tphone: [\n\t\t{\n\t\t\trequired: true,\n\t\t\tmessage: \"请填写手机号\",\n\t\t\ttrigger: [\"blur\", \"change\"]\n\t\t},\n\t\t{\n\t\t\tpattern: reg_tel_phone,\n\t\t\tmessage: \"手机号格式不正确\"\n\t\t}\n\t]\n};\n","<template>\n  <view class=\"page-container\">\n    <uv-form\n      labelPosition=\"left\"\n      :model=\"form\"\n      :rules=\"rules\"\n      labelWidth=\"100\"\n      errorType=\"toast\"\n      ref=\"formRef\"\n      width=\"100%\"\n    >\n      <uv-form-item label=\"头像\" prop=\"avatar\" :borderBottom=\"true\" ref=\"item1\">\n        <template #right>\n          <view class=\"flex items-center\">\n            <uv-avatar\n              :src=\"form.avatar || defaultAvatar\"\n              size=\"30\"\n              @click=\"replaceAvatar\"\n            ></uv-avatar>\n            <uv-icon name=\"arrow-right\" color=\"#969799\" @click=\"replaceAvatar\"></uv-icon>\n          </view>\n        </template>\n      </uv-form-item>\n\n      <uv-form-item label=\"昵称\" prop=\"name\" :borderBottom=\"true\" ref=\"item1\">\n        <template #right>\n          <view class=\"flex items-center\">\n            <uv-input\n              v-model=\"form.nick_name\"\n              border=\"none\"\n              placeholder=\"请输入昵称\"\n              inputAlign=\"right\"\n            />\n          </view>\n        </template>\n      </uv-form-item>\n\n      <uv-form-item label=\"性别\" prop=\"sex\" :borderBottom=\"true\" ref=\"item1\">\n        <template #right>\n          <view class=\"flex items-center\" @click=\"handleShowSexPicker\">\n            <!-- 0未知 1男 2女 -->\n            <!-- <text>{{ sex[form.sex] }}</text> -->\n            <uv-input\n              readonly\n              v-model=\"sex[form.sex]\"\n              placeholder=\"请请选择性别\"\n              border=\"none\"\n              inputAlign=\"right\"\n            />\n            <uv-icon name=\"arrow-right\" color=\"#969799\"></uv-icon>\n          </view>\n        </template>\n        <uv-picker\n          ref=\"sexPicker\"\n          :show=\"showPicker\"\n          :columns=\"sexOptions\"\n          keyName=\"label\"\n          @confirm=\"handlePickerConfirm\"\n          @cancel=\"showPicker = false\"\n          @change=\"changeHandler\"\n          :defaultIndex=\"defaultIndex\"\n        ></uv-picker>\n        <!-- <view @click=\"handleClickSelect(5)\">\n                    <uv-input v-model=\"form.levelStr\" placeholder=\"请请选择性别\" border=\"none\" />\n                </view>\n                <template #right>\n                    <uv-icon name=\"arrow-right\" color=\"#969799\"></uv-icon>\n                </template> -->\n      </uv-form-item>\n\n      <uv-form-item label=\"手机号\" prop=\"phone\" :borderBottom=\"true\" ref=\"item1\">\n        <template #right>\n          <uv-input readonly v-model=\"form.phone\" border=\"none\" inputAlign=\"right\" />\n        </template>\n      </uv-form-item>\n\n      <uv-form-item label=\"指导员\" prop=\"guide\" ref=\"item1\">\n        <template #right>\n          <view class=\"flex items-center\" @click=\"toValidate\">\n            <uv-input readonly v-model=\"form.guide\" border=\"none\" inputAlign=\"right\" />\n            <uv-icon name=\"arrow-right\" color=\"#969799\"></uv-icon>\n          </view>\n        </template>\n      </uv-form-item>\n    </uv-form>\n    <view class=\"footer-fixed\">\n      <view class=\"flex-1\">\n        <uv-button\n          class=\"logout-btn mr-2 flex-1\"\n          type=\"primary\"\n          :plain=\"true\"\n          shape=\"circle\"\n          size=\"medium\"\n          @click=\"handleLogout\"\n        >\n          退出当前账号\n        </uv-button>\n      </view>\n      <view class=\"flex-1\">\n        <uv-button class=\"flex-1\" type=\"primary\" shape=\"circle\" size=\"medium\" @click=\"save\">\n          保存资料\n        </uv-button>\n      </view>\n    </view>\n    <!-- 选择 -->\n    <!-- <uv-picker\n\t\t\t:show=\"showPicker\"\n\t\t\t:columns=\"columns\"\n\t\t\tkeyName=\"label\"\n\t\t\t@confirm=\"handlePickerConfirm\"\n\t\t\t@cancel=\"showPicker = false\"\n\t\t\t@change=\"changeHandler\"\n\t\t\t:key=\"currentPick\"\n\t\t></uv-picker> -->\n  </view>\n  <canvas canvas-id=\"canvas\" id=\"canvas\" style=\"visibility: hidden\"></canvas>\n</template>\n<script>\nimport { rules } from './index'\nimport { getPickBackFile } from '@/utils/tree'\nimport { previewImage, chooseImage } from '@/utils/index'\nimport { isMp } from '@/utils/platform'\nimport defaultAvatar from '@/static/images/avatar.png'\nexport default {\n  data() {\n    return {\n      defaultAvatar,\n      previewImage: previewImage,\n      currentPick: 1,\n      rules,\n      showPicker: false,\n      form: {\n        nick_name: '',\n        avatar: '',\n        sex: '',\n        phone: '',\n        guide: '',\n        fileList: [],\n      },\n      sex: {\n        0: '未知',\n        1: '男',\n        2: '女',\n      },\n      sexOptions: [\n        [\n          { label: '男', id: 1 },\n          { label: '女', id: 2 },\n        ],\n      ],\n      defaultIndex: [],\n    }\n  },\n  onLoad() {\n    let result = getPickBackFile([this.$store.user.userInfo.sex], this.sexOptions[0], 1)\n    this.defaultIndex = result.defaultIndex\n    this.form = {\n      guide: this.$store.user.userInfo.is_auth_instructor == 1 ? '已认证' : '未认证',\n      fileList: [\n        {\n          url: this.$store.user.userInfo.avatar_url,\n        },\n      ],\n      ...this.$store.user.userInfo,\n      name: this.$store.user.userInfo.nick_name,\n    }\n    console.log(this.form)\n    console.log(this.$store.user.userInfo)\n  },\n  methods: {\n    getFileList() {},\n    toValidate() {\n      if (this.$store.user.userInfo.is_auth_instructor == 1) {\n        uni.navigateTo({\n          url: '/pages-sub/realname/detail',\n        })\n        return\n      }\n      uni.navigateTo({\n        url: '/pages-sub/realname/index',\n      })\n    },\n    async save() {\n      try {\n        await this.$refs.formRef\n          .validate()\n          .then(async () => {\n            let params = {\n              avatar: this.form.avatar,\n              nick_name: this.form.nick_name,\n              sex: this.form.sex,\n              phone: this.form.phone,\n            }\n            let res = await (isMp\n              ? this.$api.updateInfoPlatformMmeberInfo(params)\n              : this.$api.updateMmeberInfo(params))\n            if (res.code == 200) {\n              this.$store.user.userInfo = {\n                ...this.$store.user.userInfo,\n                ...params,\n              }\n              this.$toast('保存成功', {\n                type: 'success',\n                complete() {\n                  uni.navigateBack()\n                },\n              })\n            } else {\n              this.$toast(res.message)\n            }\n          })\n          .catch((errors) => {\n            console.warn('error', errors)\n          })\n      } catch (error) {\n        console.warn('error', error)\n      }\n    },\n    async handleLogout() {\n      try {\n        await this.$dialog('确定要退出登录吗?', {\n          showCancelButton: true,\n          confirmButtonText: '确定',\n          cancelButtonText: '取消',\n        })\n      } catch (error) {\n        console.log(error)\n        return\n      }\n\n      await this.$store.user.logout()\n      await this.$toast('退出登录成功', { type: 'success' })\n    },\n    async replaceAvatar() {\n      const res = await chooseImage('canvas')\n      if (res.status) {\n        this.$api.uploadPic({ filePath: res.file }).then((resp) => {\n          let res = JSON.parse(resp.data)\n          if (res.code == 200) {\n            this.form.avatar = res.data.imgUrl\n          } else {\n            this.$toast(res.message)\n          }\n        })\n      }\n    },\n    changeHandler(e) {},\n    handleShowSexPicker() {\n      this.$refs['sexPicker'].open()\n    },\n    handlePickerConfirm(e) {\n      this.showPicker = false\n      this.form.sex = e.value[0].id\n    },\n  },\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.page-container {\n  width: 100%;\n  min-height: 100vh;\n  padding: 24rpx;\n  box-sizing: border-box;\n  background-color: #fff;\n}\n\n.uni-input-placeholder {\n  text-align: right;\n}\n:deep(.uni-page-head) {\n  box-sizing: unset;\n}\n\n:deep(.uni-input-input) {\n  text-align: right;\n}\n.center {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n.footer-fixed {\n  display: flex;\n  align-items: center;\n  gap: 36rpx;\n}\n</style>\n","import MiniProgramPage from '/Users/guoxiaoming/code/papa-code/pm-yn/uniapp-social-sports-new/src/pages/personalDetail/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["reg_tel_phone","defaultAvatar","previewImage","getPickBackFile","uni","isMp","chooseImage","res"],"mappings":"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"}