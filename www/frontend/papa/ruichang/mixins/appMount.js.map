{"version":3,"file":"appMount.js","sources":["../../../../src/mixins/appMount.js"],"sourcesContent":["/**\n * 显示toast\n * @param {string} title 标题\n * @param {number} duration 持续时间\n */\nfunction showToastNone(title, duraction = 1500) {\n  uni.showToast({\n    icon: 'none',\n    title: title,\n    duration: 1500,\n  })\n}\n\n/**\n * 判断是否全屏\n * @returns {Promise<{windowHeight: number, scrollHeight: number, isFullScreen: boolean}>}\n */\nfunction isFullScreen() {\n  return new Promise((reslove) => {\n    uni\n      .createSelectorQuery()\n      .selectViewport()\n      .scrollOffset()\n      .exec(async (res) => {\n        const windowHeight = uni.getSystemInfoSync().windowHeight\n        const scrollHeight = res[0].scrollHeight\n        let obj = {\n          windowHeight: windowHeight,\n          scrollHeight: scrollHeight,\n          isFullScreen: windowHeight > scrollHeight,\n        }\n        reslove(obj)\n      })\n  })\n}\n\n/**\n * 打开网页\n * @param {string} url 网页地址\n */\nfunction openUrl(url) {\n  uni.navigateTo({\n    url: '/pages/webView/webView?url=' + encodeURIComponent(url),\n  })\n}\n\n/**\n * 时间格式化\n * @param {number} timestamp 时间戳\n * @param {string} format 格式\n * @returns {string} 格式化后的时间\n */\nexport function timeFrom(timestamp = null, format = 'yyyy-mm-dd') {\n  if (timestamp == null) timestamp = Number(new Date())\n  timestamp = parseInt(timestamp)\n  if (timestamp.toString().length == 10) timestamp *= 1000\n  let timer = new Date().getTime() - timestamp\n  timer = parseInt(timer / 1000)\n  // 如果小于5分钟,则返回\"刚刚\",其他以此类推\n  let tips = ''\n  switch (true) {\n    case timer < 300:\n      tips = '刚刚'\n      break\n    case timer >= 300 && timer < 3600:\n      tips = `${parseInt(timer / 60)} 分钟前`\n      break\n    case timer >= 3600 && timer < 86400:\n      tips = `${parseInt(timer / 3600)} 小时前`\n      break\n    default:\n      if (format == 'yyyy-mm-dd hh:MM:ss' && getApp().globalData.isIos) {\n        format = 'yyyy/mm/dd hh:MM:ss'\n      }\n      tips = uni.$uv.timeFormat(timestamp, format)\n  }\n  return tips\n}\n\n/**\n * 距离格式化\n * @param {number} distance 距离\n * @returns {string} 格式化后的距离\n */\nfunction distanceFormat(distance) {\n  if (distance) {\n    return Math.ceil(distance / 1000) + 'KM'\n  } else {\n    return ''\n  }\n}\n\n/**\n * 格式化富文本\n * @param {string} html 富文本\n * @param {string} tip 提示\n * @returns {string} 格式化后的富文本\n */\nfunction formatRichText(html, tip) {\n  html = html ? html : ''\n  let newContent = ''\n  newContent = html.replace(/<img[^>]*>/gi, function (match) {\n    match = match.replace(`style=\"\"`, '')\n    match = match.replace(/style=\"[^\"]+\"/gi, '').replace(/style='[^']+'/gi, '')\n    match = match.replace(/width=\"[^\"]+\"/gi, '').replace(/width='[^']+'/gi, '')\n    match = match.replace(/height=\"[^\"]+\"/gi, '').replace(/height='[^']+'/gi, '')\n    return match\n  })\n  newContent = newContent.replace(/style=\"[^\"]+\"/gi, function (match) {\n    match = match\n      .replace(/width:[^;]+;/gi, 'max-width:100%;')\n      .replace(/width:[^;]+;/gi, 'max-width:100%;')\n    return match\n  })\n  newContent = newContent.replace(/<br[^>]*\\/>/gi, '')\n  newContent = newContent.replace(\n    /\\<img/gi,\n    '<img style=\"max-width:100%;height:auto;display:inline-block;margin:10rpx auto;\"',\n  )\n  if (!newContent) {\n    return tip\n  }\n  return newContent\n}\n\n/**\n * 打开地图\n * @param {object} info 位置信息\n */\nfunction toLocation(info) {\n  let { latitude, longitude } = info\n  if (!latitude || !longitude) {\n    showToastNone('暂无位置信息')\n    return\n  }\n  uni.openLocation({\n    latitude: +latitude,\n    longitude: +longitude,\n    name: info.name ?? '',\n    address: info.address ?? '',\n    scale: 16,\n    infoUrl: '',\n    fail(err) {\n      console.error('----toLocation fail----', err)\n      showToastNone('地图打开失败' + err.errMsg)\n    },\n  })\n}\n\n/**\n * 拨打电话\n * @param {object} info 联系方式\n */\nfunction callPhone(info) {\n  if (!info.phone) {\n    showToastNone('暂无联系方式')\n    return\n  }\n  uni.makePhoneCall({\n    phoneNumber: info.phone,\n    fail(err) {\n      console.error(err)\n    },\n  })\n}\n\n/**\n * cdn图片地址变量\n * @param {string} url 图片地址\n * @returns {string} cdn图片地址\n */\nexport function cdnUrl(url) {\n  return 'https://cdn-static.papa.com.cn/jxpq' + url\n}\n\n/**\n * 格式化跳转路径\n * @param {object} obj 跳转信息\n * @returns {string} 跳转路径\n */\nexport function formatJumpPath(obj) {\n  let url = ''\n  if (obj.jump_type === 1) {\n    url = obj.link_url\n  } else if (obj.jump_type === 2) {\n    url = obj.out_link_url\n  } else if (obj.jump_type === 3) {\n    url = `${obj.link_url}@APPID=${obj.out_link_url}`\n  }\n  return url\n}\n\n/**\n * 跳转路径\n * @param {string | object} url 路径\n */\nexport function jumpPath(url) {\n  console.log('----jumpPath----', url)\n  try {\n    if (typeof url === 'object') {\n      url = formatJumpPath(url)\n    }\n    let arr = url.split('@APPID=')\n    if (arr.length > 1) {\n      uni.navigateToMiniProgram({\n        appId: arr[arr.length - 1],\n        path: arr[0],\n        envVersion: 'release',\n        success: (res) => {\n          console.log('打开成功', res)\n        },\n        fail: (err) => {},\n      })\n    } else {\n      if (url.indexOf('http') != -1) {\n        uni.navigateTo({\n          url: '/pages/webView/webView?url=' + encodeURIComponent(url),\n        })\n      } else {\n        if (\n          [\n            '/pages/tabbar/home/index',\n            '/pages/matchIndex/matchIndex',\n            '/pages/tabbar/mine/mine',\n            '/pages/tabbar/map/map',\n            '/pages/tabbar/activity/index',\n            // '/pages/associationList/associationList',\n          ].indexOf(url) == -1\n        ) {\n          uni.navigateTo({\n            url,\n            success: (res) => {\n              console.log('----jumpPath success----', res)\n            },\n            fail: (err) => {\n              uni.showToast({\n                icon: 'none',\n                title: err.errMsg,\n              })\n              console.log('----jumpPath fail----', err)\n            },\n          })\n        } else {\n          uni.switchTab({\n            url,\n            success: (res) => {\n              console.log('----jumpPath success----', res)\n            },\n            fail: (err) => {\n              uni.showToast({\n                icon: 'none',\n                title: err.errMsg,\n              })\n              console.log('----jumpPath fail----', err)\n            },\n          })\n        }\n      }\n    }\n  } catch (error) {\n    console.log('----jumpPath error----', error)\n    uni.showToast({\n      icon: 'none',\n      title: '跳转失败',\n    })\n  }\n}\n\nfunction sleepFunction(time) {\n  return new Promise((resolve) => {\n    setTimeout(() => {\n      resolve('sleep' + time)\n    }, time)\n  })\n}\n\n/**\n * 用于promise执行时间过长时，自动显示loading\n */\nexport async function autoLoading(promise, delay = 200, duration = 350) {\n  let res = await Promise.race([promise, sleepFunction(delay)])\n  if (!res?.includes?.('sleep')) {\n    return res\n  }\n  uni.showLoading({ title: '加载中' })\n  let [result] = await Promise.all([promise, sleepFunction(duration)])\n  uni.hideLoading()\n  return result\n}\n\nconst install = (app) => {\n  app.config.globalProperties.$showToastNone = showToastNone\n  app.config.globalProperties.$isFullScreen = isFullScreen\n  app.config.globalProperties.$openUrl = openUrl\n  app.config.globalProperties.$timeFrom = timeFrom\n  app.config.globalProperties.$distanceFormat = distanceFormat\n  app.config.globalProperties.$formatRichText = formatRichText\n  app.config.globalProperties.$toLocation = toLocation\n  app.config.globalProperties.$callPhone = callPhone\n  app.config.globalProperties.$cdnUrl = cdnUrl\n  app.config.globalProperties.$jumpPath = jumpPath\n  app.config.globalProperties.$autoLoading = autoLoading\n}\n\nexport default install\n"],"names":["uni"],"mappings":"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"}