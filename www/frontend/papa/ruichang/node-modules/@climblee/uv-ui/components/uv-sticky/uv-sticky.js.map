{"version":3,"file":"uv-sticky.js","sources":["../../../../../../../../node_modules/@climblee/uv-ui/components/uv-sticky/uv-sticky.vue","../../../../../../../../uniComponent:/L1VzZXJzL2d1b3hpYW9taW5nL2NvZGUvcGFwYS1jb2RlL3BtLXluL3VuaWFwcC1zb2NpYWwtc3BvcnRzLW5ldy9ub2RlX21vZHVsZXMvQGNsaW1ibGVlL3V2LXVpL2NvbXBvbmVudHMvdXYtc3RpY2t5L3V2LXN0aWNreS52dWU"],"sourcesContent":["<template>\r\n\t<view\r\n\t\tclass=\"uv-sticky\"\r\n\t\t:id=\"elId\"\r\n\t\t:style=\"[style]\"\r\n\t>\r\n\t\t<view\r\n\t\t\t:style=\"[stickyContent]\"\r\n\t\t\tclass=\"uv-sticky__content\"\r\n\t\t>\r\n\t\t\t<slot />\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\timport mpMixin from '../../libs/mixin/mpMixin.js'\r\n\timport mixin from '../../libs/mixin/mixin.js'\r\n\timport props from './props.js';;\r\n\t/**\r\n\t * sticky 吸顶\r\n\t * @description 该组件与CSS中position: sticky属性实现的效果一致，当组件达到预设的到顶部距离时， 就会固定在指定位置，组件位置大于预设的顶部距离时，会重新按照正常的布局排列。\r\n\t * @tutorial https://www.uvui.cn/components/sticky.html\r\n\t * @property {String ｜ Number}\toffsetTop\t\t吸顶时与顶部的距离，单位px（默认 0 ）\r\n\t * @property {String ｜ Number}\tcustomNavHeight\t自定义导航栏的高度 （h5 默认44  其他默认 0 ）\r\n\t * @property {Boolean}\t\t\tdisabled\t\t是否开启吸顶功能 （默认 false ）\r\n\t * @property {String}\t\t\tbgColor\t\t\t组件背景颜色（默认 '#ffffff' ）\r\n\t * @property {String ｜ Number}\tzIndex\t\t\t吸顶时的z-index值\r\n\t * @property {String ｜ Number}\tindex\t\t\t自定义标识，用于区分是哪一个组件\r\n\t * @property {Object}\t\t\tcustomStyle\t\t组件的样式，对象形式\r\n\t * @example <uv-sticky offsetTop=\"200\"><view>塞下秋来风景异，衡阳雁去无留意</view></uv-sticky>\r\n\t */\r\n\texport default {\r\n\t\tname: 'uv-sticky',\r\n\t\tmixins: [mpMixin, mixin, props],\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tcssSticky: false, // 是否使用css的sticky实现\r\n\t\t\t\tstickyTop: 0, // 吸顶的top值，因为可能受自定义导航栏影响，最终的吸顶值非offsetTop值\r\n\t\t\t\telId: '',\r\n\t\t\t\tleft: 0, // js模式时，吸顶的内容因为处于postition: fixed模式，为了和原来保持一致的样式，需要记录并重新设置它的left，height，width属性\r\n\t\t\t\twidth: 'auto',\r\n\t\t\t\theight: 'auto',\r\n\t\t\t\tfixed: false, // js模式时，是否处于吸顶模式\r\n\t\t\t}\r\n\t\t},\r\n\t\tcomputed: {\r\n\t\t\tstyle() {\r\n\t\t\t\tconst style = {}\r\n\t\t\t\tif(!this.disabled) {\r\n\t\t\t\t\tif (this.cssSticky) {\r\n\t\t\t\t\t\tstyle.position = 'sticky'\r\n\t\t\t\t\t\tstyle.zIndex = this.uZindex\r\n\t\t\t\t\t\tstyle.top = this.$uv.addUnit(this.stickyTop)\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tstyle.height = this.fixed ? this.height + 'px' : 'auto'\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// 无需吸顶时，设置会默认的relative(nvue)和非nvue的static静态模式即可\r\n\t\t\t\t\t// #ifdef APP-NVUE\r\n\t\t\t\t\tstyle.position = 'relative'\r\n\t\t\t\t\t// #endif\r\n\t\t\t\t\t// #ifndef APP-NVUE\r\n\t\t\t\t\tstyle.position = 'static'\r\n\t\t\t\t\t// #endif\r\n\t\t\t\t}\r\n\t\t\t\tstyle.backgroundColor = this.bgColor\r\n\t\t\t\treturn this.$uv.deepMerge(this.$uv.addStyle(this.customStyle), style)\r\n\t\t\t},\r\n\t\t\t// 吸顶内容的样式\r\n\t\t\tstickyContent() {\r\n\t\t\t\tconst style = {}\r\n\t\t\t\tif (!this.cssSticky) {\r\n\t\t\t\t\tstyle.position = this.fixed ? 'fixed' : 'static'\r\n\t\t\t\t\tstyle.top = this.stickyTop + 'px'\r\n\t\t\t\t\tstyle.left = this.left + 'px'\r\n\t\t\t\t\tstyle.width = this.width == 'auto' ? 'auto' : this.width + 'px'\r\n\t\t\t\t\tstyle.zIndex = this.uZindex\r\n\t\t\t\t}\r\n\t\t\t\treturn style\r\n\t\t\t},\r\n\t\t\tuZindex() {\r\n\t\t\t\treturn this.zIndex ? this.zIndex : 970\r\n\t\t\t}\r\n\t\t},\r\n\t\tcreated() {\r\n\t\t\tthis.elId = this.$uv.guid();\r\n\t\t},\r\n\t\tmounted() {\r\n\t\t\tthis.init()\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\tinit() {\r\n\t\t\t\tthis.getStickyTop()\r\n\t\t\t\t// 判断使用的模式\r\n\t\t\t\tthis.checkSupportCssSticky()\r\n\t\t\t\t// 如果不支持css sticky，则使用js方案，此方案性能比不上css方案\r\n\t\t\t\tif (!this.cssSticky) {\r\n\t\t\t\t\t!this.disabled && this.initObserveContent()\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tinitObserveContent() {\r\n\t\t\t\t// 获取吸顶内容的高度，用于在js吸顶模式时，给父元素一个填充高度，防止\"塌陷\"\r\n\t\t\t\tthis.$uvGetRect('#' + this.elId).then((res) => {\r\n\t\t\t\t\tthis.height = res.height\r\n\t\t\t\t\tthis.left = res.left\r\n\t\t\t\t\tthis.width = res.width\r\n\t\t\t\t\tthis.$nextTick(() => {\r\n\t\t\t\t\t\tthis.observeContent()\r\n\t\t\t\t\t})\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tobserveContent() {\r\n\t\t\t\t// 先断掉之前的观察\r\n\t\t\t\tthis.disconnectObserver('contentObserver')\r\n\t\t\t\tconst contentObserver = uni.createIntersectionObserver({\r\n\t\t\t\t\t// 检测的区间范围\r\n\t\t\t\t\tthresholds: [0.95, 0.98, 1]\r\n\t\t\t\t})\r\n\t\t\t\t// 到屏幕顶部的高度时触发\r\n\t\t\t\tcontentObserver.relativeToViewport({\r\n\t\t\t\t\ttop: -this.stickyTop\r\n\t\t\t\t})\r\n\t\t\t\t// 绑定观察的元素\r\n\t\t\t\tcontentObserver.observe(`#${this.elId}`, res => {\r\n\t\t\t\t\tthis.setFixed(res.boundingClientRect.top)\r\n\t\t\t\t})\r\n\t\t\t\tthis.contentObserver = contentObserver\r\n\t\t\t},\r\n\t\t\tsetFixed(top) {\r\n\t\t\t\t// 判断是否出于吸顶条件范围\r\n\t\t\t\tconst fixed = top <= this.stickyTop\r\n\t\t\t\tthis.fixed = fixed\r\n\t\t\t},\r\n\t\t\tdisconnectObserver(observerName) {\r\n\t\t\t\t// 断掉观察，释放资源\r\n\t\t\t\tconst observer = this[observerName]\r\n\t\t\t\tobserver && observer.disconnect()\r\n\t\t\t},\r\n\t\t\tgetStickyTop() {\r\n\t\t\t\tthis.stickyTop = this.$uv.getPx(this.offsetTop) + this.$uv.getPx(this.customNavHeight)\r\n\t\t\t},\r\n\t\t\tasync checkSupportCssSticky() {\r\n\t\t\t\t// #ifdef H5\r\n\t\t\t\t// H5，一般都是现代浏览器，是支持css sticky的，这里使用创建元素嗅探的形式判断\r\n\t\t\t\tif (this.checkCssStickyForH5()) {\r\n\t\t\t\t\tthis.cssSticky = true\r\n\t\t\t\t}\r\n\t\t\t\t// #endif\r\n\r\n\t\t\t\t// 如果安卓版本高于8.0，依然认为是支持css sticky的(因为安卓7在某些机型，可能不支持sticky)\r\n\t\t\t\tif (this.$uv.os() === 'android' && Number(this.$uv.sys().system) > 8) {\r\n\t\t\t\t\tthis.cssSticky = true\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// APP-Vue和微信平台，通过computedStyle判断是否支持css sticky\r\n\t\t\t\t// #ifdef APP-VUE || MP-WEIXIN\r\n\t\t\t\tthis.cssSticky = await this.checkComputedStyle()\r\n\t\t\t\t// #endif\r\n\r\n\t\t\t\t// ios上，从ios6开始，都是支持css sticky的\r\n\t\t\t\tif (this.$uv.os() === 'ios') {\r\n\t\t\t\t\tthis.cssSticky = true\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// nvue，是支持css sticky的\r\n\t\t\t\t// #ifdef APP-NVUE\r\n\t\t\t\tthis.cssSticky = true\r\n\t\t\t\t// #endif\r\n\t\t\t},\r\n\t\t\t// 在APP和微信小程序上，通过uni.createSelectorQuery可以判断是否支持css sticky\r\n\t\t\tcheckComputedStyle() {\r\n\t\t\t\t// 方法内进行判断，避免在其他平台生成无用代码\r\n\t\t\t\t// #ifdef APP-VUE || MP-WEIXIN\r\n\t\t\t\treturn new Promise(resolve => {\r\n\t\t\t\t\tuni.createSelectorQuery().in(this).select('.uv-sticky').fields({\r\n\t\t\t\t\t\tcomputedStyle: [\"position\"]\r\n\t\t\t\t\t}).exec(e => {\r\n\t\t\t\t\t\tresolve('sticky' === e[0].position)\r\n\t\t\t\t\t})\r\n\t\t\t\t})\r\n\t\t\t\t// #endif\r\n\t\t\t},\r\n\t\t\t// H5通过创建元素的形式嗅探是否支持css sticky\r\n\t\t\t// 判断浏览器是否支持sticky属性\r\n\t\t\tcheckCssStickyForH5() {\r\n\t\t\t\t// 方法内进行判断，避免在其他平台生成无用代码\r\n\t\t\t\t// #ifdef H5\r\n\t\t\t\tconst vendorList = ['', '-webkit-', '-ms-', '-moz-', '-o-'],\r\n\t\t\t\t\tvendorListLength = vendorList.length,\r\n\t\t\t\t\tstickyElement = document.createElement('div')\r\n\t\t\t\tfor (let i = 0; i < vendorListLength; i++) {\r\n\t\t\t\t\tstickyElement.style.position = vendorList[i] + 'sticky'\r\n\t\t\t\t\tif (stickyElement.style.position !== '') {\r\n\t\t\t\t\t\treturn true\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn false;\r\n\t\t\t\t// #endif\r\n\t\t\t}\r\n\t\t},\r\n\t\t// #ifdef VUE2\r\n\t\tbeforeDestroy() {\r\n\t\t\tthis.disconnectObserver('contentObserver')\r\n\t\t},\r\n\t\t// #endif\r\n\t\t// #ifdef VUE3\r\n\t\tunmounted() {\r\n\t\t\tthis.disconnectObserver('contentObserver')\r\n\t\t}\r\n\t\t// #endif\r\n\t}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n\t@import '../../libs/css/components.scss';\r\n\t.uv-sticky {\r\n\t\t/* #ifdef APP-VUE || MP-WEIXIN */\r\n\t\t// 此处默认写sticky属性，是为了给微信和APP通过uni.createSelectorQuery查询是否支持css sticky使用\r\n\t\tposition: sticky;\r\n\t\t/* #endif */\r\n\t}\r\n</style>\r\n","import Component from '/Users/guoxiaoming/code/papa-code/pm-yn/uniapp-social-sports-new/node_modules/@climblee/uv-ui/components/uv-sticky/uv-sticky.vue'\nwx.createComponent(Component)"],"names":["mpMixin","mixin","props","uni"],"mappings":"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","x_google_ignoreList":[0]}