{"version":3,"file":"cascadeSelect.js","sources":["../../../../../src/components/dropDown/cascadeSelect.vue","../../../../../uniComponent:/L1VzZXJzL2d1b3hpYW9taW5nL2NvZGUvcGFwYS1jb2RlL3BtLXluL3VuaWFwcC1zb2NpYWwtc3BvcnRzLW5ldy9zcmMvY29tcG9uZW50cy9kcm9wRG93bi9jYXNjYWRlU2VsZWN0LnZ1ZQ"],"sourcesContent":["<template>\n  <view class=\"cascade-container\">\n    <scroll-view\n      :scroll-y=\"true\"\n      enhanced\n      v-for=\"(wrapItem, wrapIdx) in wrapContent\"\n      :key=\"wrapIdx\"\n      :class=\"['scroll-v', { 'first-line': wrapIdx == 0 }]\"\n      :style=\"itemStyle\"\n    >\n      <view\n        :class=\"['item', { active: item[valueKey] === values[wrapIdx] }]\"\n        v-for=\"(item, i) in wrapItem\"\n        :key=\"i\"\n        @click=\"itemClick(wrapIdx, i)\"\n      >\n        <view class=\"label\">{{ item[labelKey] }}</view>\n        <uni-icons\n          v-if=\"item[valueKey] == values[wrapIdx]\"\n          type=\"checkmarkempty\"\n          size=\"14\"\n          class=\"selected-icon\"\n        ></uni-icons>\n      </view>\n    </scroll-view>\n  </view>\n</template>\n\n<script>\n// const DEFAULT_FIELDS = { label: 'name', value: 'company_area_id', children: 'next' }\nconst DEFAULT_FIELDS = { label: 'name', value: 'tag_id', children: 'tag_id_arr' }\nconst app = getApp()\nexport default {\n  props: {\n    options: {\n      type: Array,\n      default: () => {\n        return []\n      },\n    },\n    fieldNames: {\n      type: Object,\n      default: () => DEFAULT_FIELDS,\n    },\n    defaultSelected: {\n      type: Array,\n      default: () => {\n        return []\n      },\n    },\n    isFullValue: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  data() {\n    return {\n      baseOptions: [],\n      wrapContent: [],\n      values: [],\n      pathData: [],\n      selectItem: [],\n      maxDepth: 0,\n    }\n  },\n  computed: {\n    labelKey() {\n      return this.fieldNames.label || DEFAULT_FIELDS.label\n    },\n    valueKey() {\n      return this.fieldNames.value || DEFAULT_FIELDS.value\n    },\n    childrenKey() {\n      return this.fieldNames.children || DEFAULT_FIELDS.children\n    },\n    itemStyle() {\n      if (this.maxDepth == 3) {\n        return {\n          'max-width': '33%',\n        }\n      } else {\n        return {}\n      }\n    },\n  },\n  watch: {\n    options(n) {\n      this.baseOptions = n\n      if (n) {\n        this.maxDepth = this.getMaxDepth(n, this.childrenKey)\n        this.initDefaultSelected()\n      }\n    },\n  },\n  created() {},\n  async mounted() {},\n  methods: {\n    reset() {\n      this.initDefaultSelected()\n      this.values = []\n      this.pathData = []\n      this.$emit('change', { values: this.values, data: this.pathData })\n    },\n    getValues() {\n      return { values: this.values, data: this.pathData }\n    },\n    initDefaultSelected(idx = 0) {\n      let formatList = [this.baseOptions]\n      let firstChildren = this.baseOptions\n      while (formatList.length < this.maxDepth) {\n        let list = []\n        firstChildren.map((v, i) => {\n          if (this.defaultSelected.includes(v[this.valueKey]) && v[this.childrenKey]?.length) {\n            list = v[this.childrenKey]\n          }\n        })\n        if (list.length == 0) {\n          list = firstChildren[0][this.childrenKey]\n        }\n        firstChildren = list\n        formatList.push(list)\n      }\n      this.wrapContent = formatList\n      this.values = [...this.defaultSelected]\n    },\n    itemClick(wrapIdx, i) {\n      let currentKey = this.wrapContent[wrapIdx][i][this.valueKey]\n      let pathListData = this.findPath(this.baseOptions, currentKey)\n      let valueList = pathListData.map((e) => e[this.valueKey])\n      this.values = valueList\n      this.pathData = pathListData\n      let children = this.wrapContent[wrapIdx][i][this.childrenKey]\n      if (children?.length) {\n        this.wrapContent[++wrapIdx] = children\n        if (this.isFullValue) {\n          this.$nextTick(() => {\n            this.itemClick(wrapIdx, 0)\n          })\n        }\n      } else {\n        if (++wrapIdx < this.maxDepth) {\n          this.wrapContent[wrapIdx] = []\n        }\n      }\n      this.$nextTick(() => {\n        this.$emit('change', { values: this.values, data: pathListData })\n      })\n    },\n    //   递归查找路径\n    findPath(treeData, targetId) {\n      for (let node of treeData) {\n        if (node[this.valueKey] === targetId) {\n          return [node]\n        }\n        if (node[this.childrenKey] && node[this.childrenKey].length > 0) {\n          let path = this.findPath(node[this.childrenKey], targetId)\n          if (path) {\n            return [node, ...path]\n          }\n        }\n      }\n      return null\n    },\n    //   递归获取最大深度\n    getMaxDepth(arr, valueKey = 'children') {\n      if (!Array.isArray(arr) || arr.length === 0) {\n        return 0\n      }\n      let maxDepth = 0\n      for (let item of arr) {\n        if (item && Array.isArray(item[valueKey])) {\n          maxDepth = Math.max(maxDepth, this.getMaxDepth(item[valueKey], valueKey))\n        }\n      }\n      return maxDepth + 1\n    },\n  },\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.cascade-container {\n  height: 100%;\n  flex: 1;\n  overflow: auto;\n  display: flex;\n  .scroll-v {\n    flex: 1;\n    flex-shrink: 0;\n    .item {\n      width: 100%;\n      box-sizing: border-box;\n      padding: 0 24rpx;\n      overflow: hidden;\n      text-overflow: ellipsis;\n      height: 88rpx;\n      line-height: 88rpx;\n      text-align: center;\n      font-size: 28rpx;\n      font-weight: 400;\n      color: $hubei-text-color-primary;\n      position: relative;\n      .label {\n        width: 100%;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        white-space: nowrap;\n      }\n      &.active {\n        color: $hubei-primary;\n        font-weight: 500;\n      }\n      .selected-icon {\n        position: absolute;\n        right: 0;\n        top: 0;\n      }\n    }\n  }\n  .first-line {\n    background-color: #f5f7fa;\n    max-width: 33%;\n    .active {\n      background-color: #fff !important;\n      position: relative;\n      color: $hubei-primary;\n      font-weight: 500;\n      &:before {\n        position: absolute;\n        left: 0;\n        top: 0;\n        content: '';\n        width: 10rpx;\n        height: 100%;\n        background-color: $hubei-primary;\n      }\n    }\n  }\n}\n</style>\n","import Component from '/Users/guoxiaoming/code/papa-code/pm-yn/uniapp-social-sports-new/src/components/dropDown/cascadeSelect.vue'\nwx.createComponent(Component)"],"names":[],"mappings":"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"}