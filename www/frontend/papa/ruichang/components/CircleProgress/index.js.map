{"version":3,"file":"index.js","sources":["../../../../../src/components/CircleProgress/index.vue","../../../../../uniComponent:/L1VzZXJzL2d1b3hpYW9taW5nL2NvZGUvcGFwYS1jb2RlL3BtLXluL3VuaWFwcC1zb2NpYWwtc3BvcnRzLW5ldy9zcmMvY29tcG9uZW50cy9DaXJjbGVQcm9ncmVzcy9pbmRleC52dWU"],"sourcesContent":["<template>\n  <view\n    class=\"tui-circular-container\"\n    :style=\"{ width: diam + 'px', height: (height || diam) + 'px' }\"\n  >\n    <!-- #ifndef MP-ALIPAY -->\n    <canvas\n      class=\"tui-circular-default\"\n      :canvas-id=\"defaultCanvasId\"\n      :id=\"defaultCanvasId\"\n      :style=\"{ width: diam + 'px', height: (height || diam) + 'px' }\"\n      v-if=\"defaultShow && defaultCanvasId\"\n    ></canvas>\n    <canvas\n      class=\"tui-circular-progress\"\n      :canvas-id=\"progressCanvasId\"\n      :id=\"progressCanvasId\"\n      :style=\"{ width: diam + 'px', height: (height || diam) + 'px' }\"\n      v-if=\"progressCanvasId\"\n    ></canvas>\n    <!-- #endif -->\n\n    <!-- #ifdef MP-ALIPAY -->\n    <canvas\n      class=\"tui-circular-default\"\n      :canvas-id=\"defaultCanvasId\"\n      :id=\"defaultCanvasId\"\n      :style=\"{ width: diam * 4 + 'px', height: (height || diam) * 4 + 'px' }\"\n      v-if=\"defaultShow\"\n    ></canvas>\n    <canvas\n      class=\"tui-circular-progress\"\n      :canvas-id=\"progressCanvasId\"\n      :id=\"progressCanvasId\"\n      :style=\"{ width: diam * 4 + 'px', height: (height || diam) * 4 + 'px' }\"\n    ></canvas>\n    <!-- #endif -->\n    <slot></slot>\n  </view>\n</template>\n\n<script>\nexport default {\n  name: 'tuiCircularProgress',\n  emits: ['change', 'end'],\n  props: {\n    /*\n\t\t\t\t  传值需使用rpx进行转换保证各终端兼容\n\t\t\t\t  px = rpx / 750 * wx.getSystemInfoSync().windowWidth\n\t\t\t\t  圆形进度条(画布)宽度，直径 [px]\n\t\t\t\t*/\n    diam: {\n      type: Number,\n      default: 60,\n    },\n    //圆形进度条(画布)高度，默认取diam值[当画半弧时传值，height有值时则取height]\n    height: {\n      type: Number,\n      default: 0,\n    },\n    //进度条线条宽度[px]\n    lineWidth: {\n      type: Number,\n      default: 4,\n    },\n    /*\n\t\t\t\t 线条的端点样式\n\t\t\t\t butt：向线条的每个末端添加平直的边缘\n\t\t\t\t round\t向线条的每个末端添加圆形线帽\n\t\t\t\t square\t向线条的每个末端添加正方形线帽\n\t\t\t\t*/\n    lineCap: {\n      type: String,\n      default: 'round',\n    },\n    //圆环进度字体大小 [px]\n    fontSize: {\n      type: Number,\n      default: 12,\n    },\n    //圆环进度字体颜色\n    fontColor: {\n      type: String,\n      default: '',\n    },\n    //是否显示进度文字\n    fontShow: {\n      type: Boolean,\n      default: true,\n    },\n    /*\n\t\t\t\t 自定义显示文字[默认为空，显示百分比，fontShow=true时生效]\n\t\t\t\t 可以使用 slot自定义显示内容\n\t\t\t\t*/\n    percentText: {\n      type: String,\n      default: '',\n    },\n    //是否显示默认(背景)进度条\n    defaultShow: {\n      type: Boolean,\n      default: true,\n    },\n    //默认进度条颜色\n    defaultColor: {\n      type: String,\n      default: '#CCCCCC',\n    },\n    //进度条颜色\n    progressColor: {\n      type: String,\n      default: '',\n    },\n    //进度条渐变颜色[结合progressColor使用，默认为空]\n    gradualColor: {\n      type: String,\n      default: '',\n    },\n    //起始弧度，单位弧度\n    sAngle: {\n      type: Number,\n      default: -Math.PI / 2,\n    },\n    //指定弧度的方向是逆时针还是顺时针。默认是false，即顺时针\n    counterclockwise: {\n      type: Boolean,\n      default: false,\n    },\n    //进度百分比 [10% 传值 10]\n    percentage: {\n      type: Number,\n      default: 0,\n    },\n    //进度百分比缩放倍数[使用半弧为100%时，则可传2]\n    multiple: {\n      type: Number,\n      default: 1,\n    },\n    //动画执行时间[单位毫秒，低于50无动画]\n    duration: {\n      type: Number,\n      default: 800,\n    },\n    //backwards: 动画从头播；forwards：动画从上次结束点接着播\n    activeMode: {\n      type: String,\n      default: 'backwards',\n    },\n  },\n  watch: {\n    percentage(val) {\n      this.initDraw()\n    },\n  },\n  data() {\n    // #ifndef MP-WEIXIN || MP-QQ\n    let cid = `id01_${Math.ceil(Math.random() * 10e5).toString(36)}`\n    let did = `id02_${Math.ceil(Math.random() * 10e5).toString(36)}`\n    // #endif\n    return {\n      // #ifdef MP-WEIXIN || MP-QQ\n      progressCanvasId: 'progressCanvasId',\n      defaultCanvasId: 'defaultCanvasId',\n      // #endif\n      // #ifndef MP-WEIXIN || MP-QQ\n      progressCanvasId: cid,\n      defaultCanvasId: did,\n      // #endif\n      progressContext: null,\n      linearGradient: null,\n      //起始百分比\n      startPercentage: 0,\n      // dpi\n      //pixelRatio: uni.getSystemInfoSync().pixelRatio\n    }\n  },\n  mounted() {\n    this.$nextTick(() => {\n      setTimeout(() => {\n        this.initDraw(true)\n      }, 50)\n    })\n  },\n  methods: {\n    //初始化绘制\n    initDraw(init) {\n      let start = this.activeMode === 'backwards' ? 0 : this.startPercentage\n      start = start > this.percentage ? 0 : start\n      if (this.defaultShow && init) {\n        this.drawDefaultCircular()\n      }\n      this.drawProgressCircular(start)\n    },\n    //默认(背景)圆环\n    drawDefaultCircular() {\n      let ctx = uni.createCanvasContext(this.defaultCanvasId, this)\n      let lineWidth = Number(this.lineWidth)\n      // #ifdef MP-ALIPAY\n      lineWidth = lineWidth * 4\n      // #endif\n      ctx.setLineWidth(lineWidth)\n      ctx.setStrokeStyle(this.defaultColor)\n      //终止弧度\n      let eAngle = Math.PI * (this.height ? 1 : 2) + this.sAngle\n      this.drawArc(ctx, eAngle)\n    },\n    //进度圆环\n    drawProgressCircular(startPercentage) {\n      let ctx = this.progressContext\n      let gradient = this.linearGradient\n      if (!ctx) {\n        ctx = uni.createCanvasContext(this.progressCanvasId, this)\n        //创建一个线性的渐变颜色 CanvasGradient对象\n        let diam = Number(this.diam)\n        // #ifdef MP-ALIPAY\n        diam = diam * 4\n        // #endif\n        const progressColor =\n          this.progressColor || (uni && uni.$tui && uni.$tui.color.primary) || '#5677fc'\n        gradient = ctx.createLinearGradient(0, 0, diam, 0)\n        gradient.addColorStop('0', progressColor)\n        if (this.gradualColor) {\n          gradient.addColorStop('1', this.gradualColor)\n        }\n        // #ifdef APP-PLUS || MP\n        const res = uni.getSystemInfoSync()\n        if (!this.gradualColor && res.platform.toLocaleLowerCase() == 'android') {\n          gradient.addColorStop('1', progressColor)\n        }\n        // #endif\n        this.progressContext = ctx\n        this.linearGradient = gradient\n      }\n      let lineWidth = Number(this.lineWidth)\n      // #ifdef MP-ALIPAY\n      lineWidth = lineWidth * 4\n      // #endif\n      ctx.setLineWidth(lineWidth)\n      ctx.setStrokeStyle(gradient)\n      let time = this.percentage == 0 || this.duration < 50 ? 0 : this.duration / this.percentage\n      if (this.percentage > 0) {\n        startPercentage = this.duration < 50 ? this.percentage - 1 : startPercentage\n        startPercentage++\n      }\n      if (this.fontShow) {\n        let fontSize = Number(this.fontSize)\n        // #ifdef MP-ALIPAY\n        fontSize = fontSize * 4\n        // #endif\n        ctx.setFontSize(fontSize)\n        const fontColor = this.fontColor || (uni && uni.$tui && uni.$tui.color.primary) || '#5677fc'\n        ctx.setFillStyle(fontColor)\n        ctx.setTextAlign('center')\n        ctx.setTextBaseline('middle')\n        let percentage = this.percentText\n        if (!percentage) {\n          percentage = this.counterclockwise\n            ? 100 - startPercentage * this.multiple\n            : startPercentage * this.multiple\n          percentage = `${percentage}%`\n        }\n        let radius = this.diam / 2\n        // #ifdef MP-ALIPAY\n        radius = radius * 4\n        // #endif\n        ctx.fillText(percentage, radius, radius)\n      }\n      if (this.percentage == 0 || (this.counterclockwise && startPercentage == 100)) {\n        ctx.draw()\n      } else {\n        let eAngle = ((2 * Math.PI) / 100) * startPercentage + this.sAngle\n        this.drawArc(ctx, eAngle)\n      }\n      setTimeout(() => {\n        this.startPercentage = startPercentage\n        if (startPercentage >= this.percentage) {\n          this.$emit('end', {\n            canvasId: this.progressCanvasId,\n            percentage: startPercentage,\n          })\n        } else {\n          this.drawProgressCircular(startPercentage)\n        }\n        this.$emit('change', {\n          percentage: startPercentage,\n        })\n      }, time)\n      // #ifdef H5\n      // requestAnimationFrame(()=>{})\n      // #endif\n    },\n    //创建弧线\n    drawArc(ctx, eAngle) {\n      ctx.setLineCap(this.lineCap)\n      ctx.beginPath()\n      let radius = this.diam / 2 //x=y\n      let lineWidth = Number(this.lineWidth)\n      // #ifdef MP-ALIPAY\n      radius = radius * 4\n      lineWidth = lineWidth * 4\n      // #endif\n      ctx.arc(radius, radius, radius - lineWidth, this.sAngle, eAngle, this.counterclockwise)\n      ctx.stroke()\n      ctx.draw()\n    },\n  },\n}\n</script>\n\n<style scoped>\n.tui-circular-container,\n.tui-circular-default {\n  position: relative;\n}\n\n/* #ifdef MP-ALIPAY */\n.tui-circular-default,\n.tui-circular-progress {\n  zoom: 0.25;\n}\n\n/* #endif */\n\n.tui-circular-progress {\n  position: absolute;\n  left: 0;\n  top: 0;\n  z-index: 10;\n}\n</style>\n","import Component from '/Users/guoxiaoming/code/papa-code/pm-yn/uniapp-social-sports-new/src/components/CircleProgress/index.vue'\nwx.createComponent(Component)"],"names":["uni"],"mappings":"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"}