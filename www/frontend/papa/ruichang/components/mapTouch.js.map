{"version":3,"file":"mapTouch.js","sources":["../../../../src/components/mapTouch.vue","../../../../uniComponent:/L1VzZXJzL2d1b3hpYW9taW5nL2NvZGUvcGFwYS1jb2RlL3BtLXluL3VuaWFwcC1zb2NpYWwtc3BvcnRzLW5ldy9zcmMvY29tcG9uZW50cy9tYXBUb3VjaC52dWU"],"sourcesContent":["<template>\n  <movable-area class=\"movableArea\" :style=\"{ height: windowHeight + 'px' }\">\n    <movable-view\n      id=\"id\"\n      class=\"movableView\"\n      direction=\"all\"\n      @change=\"movechange\"\n      :y=\"seletHeight\"\n      :disabled=\"disabled\"\n      :style=\"{ height: windowHeightIn + 'px' }\"\n    >\n      <view @touchstart=\"touchstart\" @touchmove=\"touchmove\" @touchend=\"touchend\">\n        <slot name=\"header\"></slot>\n      </view>\n      <scroll-view\n        scroll-top=\"0\"\n        scroll-y=\"true\"\n        class=\"scroll-Y\"\n        :style=\"{ paddingBottom: seletHeight + 'px' }\"\n      >\n        <slot name=\"body\"></slot>\n        <view class=\"footer-view\"></view>\n      </scroll-view>\n    </movable-view>\n  </movable-area>\n</template>\n\n<script>\nexport default {\n  props: {\n    calcHeight: {\n      type: Number,\n      default: 200, // 没有tabbar 140， 有tabbar 200\n    },\n  },\n  data() {\n    return {\n      serchText: '',\n      initSeletHeight: 0,\n      seletHeight: 700,\n      Height: 600,\n      windowHeight: '',\n      windowHeightIn: '',\n      disabled: true,\n      // 位置状态\n      positions: {\n        top: 0,\n        middle: 0,\n        bottom: 0\n      },\n      // 触摸相关数据\n      touch: {\n        startY: 0,\n        lastY: 0,\n        startTime: 0,\n        moveSpeed: 0\n      },\n      // 当前位置状态\n      currentPosition: 'bottom', // 'top', 'middle', 'bottom'\n    }\n  },\n  created() {\n    setTimeout(() => {\n      this.initPositions()\n    }, 50)\n  },\n  methods: {\n    initPositions() {\n      uni.getSystemInfo({\n        success: (res) => {\n          const windowHeight = res.windowHeight\n          \n          // 设置三个位置的具体数值\n          this.positions.top = 0\n          this.positions.middle = Math.floor(windowHeight * 0.3)  // 屏幕50%位置\n          this.positions.bottom = windowHeight - this.calcHeight\n          \n          // 初始化其他值\n          this.windowHeight = windowHeight * 2\n          this.windowHeightIn = windowHeight\n          this.seletHeight = this.positions.bottom\n          this.initSeletHeight = this.positions.bottom\n        }\n      })\n    },\n\n    touchstart(e) {\n      const touch = e.touches[0]\n      this.touch.startY = touch.clientY\n      this.touch.lastY = touch.clientY\n      this.touch.startTime = Date.now()\n      this.touch.moveSpeed = 0\n      this.disabled = false\n    },\n\n    touchmove(e) {\n      const touch = e.touches[0]\n      const currentY = touch.clientY\n      const deltaY = currentY - this.touch.lastY\n      const deltaTime = Date.now() - this.touch.startTime\n      \n      // 计算移动速度 (像素/毫秒)\n      this.touch.moveSpeed = deltaY / deltaTime\n      this.touch.lastY = currentY\n    },\n\n    touchend(e) {\n      const query = uni.createSelectorQuery().in(this)\n      query.select('#id').boundingClientRect((data) => {\n        const topHeight = data.top\n        const totalMoveDistance = this.touch.startY - this.touch.lastY\n        const moveSpeed = this.touch.moveSpeed\n        \n        // 决定最终位置\n        let finalPosition = this.decideFinalPosition(topHeight, totalMoveDistance, moveSpeed)\n        \n        // 设置最终位置\n        this.seletHeight = this.positions[finalPosition]\n        this.currentPosition = finalPosition\n        this.disabled = true\n        \n        console.log('最终位置：', finalPosition, '高度：', this.seletHeight)\n      }).exec()\n    },\n\n    decideFinalPosition(topHeight, totalMoveDistance, moveSpeed) {\n      const SPEED_THRESHOLD = 0.5 // 速度阈值，单位：像素/毫秒\n      const DISTANCE_THRESHOLD = 10 // 距离阈值，单位：像素\n      \n      // 如果移动速度较快，优先考虑速度方向\n      if (Math.abs(moveSpeed) > SPEED_THRESHOLD) {\n        if (moveSpeed < 0) { // 快速上滑\n          return topHeight < this.positions.middle ? 'top' : 'middle'\n        } else { // 快速下滑\n          return topHeight > this.positions.middle ? 'bottom' : 'middle'\n        }\n      }\n      \n      // 根据当前位置和移动距离判断\n      switch (this.currentPosition) {\n        case 'bottom':\n          if (totalMoveDistance > DISTANCE_THRESHOLD) {\n            return 'middle'\n          }\n          return 'bottom'\n          \n        case 'middle':\n          if (Math.abs(totalMoveDistance) < DISTANCE_THRESHOLD) {\n            return 'middle'\n          }\n          return totalMoveDistance > 0 ? 'top' : 'bottom'\n          \n        case 'top':\n          if (totalMoveDistance < -DISTANCE_THRESHOLD) {\n            return 'middle'\n          }\n          return 'top'\n          \n        default:\n          return 'bottom'\n      }\n    },\n\n    movechange(e) {\n      this.Height = e.detail.y\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\">\n.movableArea {\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 190vh;\n  pointer-events: none;\n}\n\n.movableView {\n  width: 100vw;\n  height: 100vh;\n  background: #fff;\n  pointer-events: auto;\n  border-radius: 40rpx 40rpx 0 0;\n}\n\n.drag-indicator {\n  width: 80rpx;\n  height: 8rpx;\n  background: #E0E0E0;\n  border-radius: 4rpx;\n  margin: 16rpx auto;\n}\n\n.scroll-Y {\n  height: calc(100% - 150rpx);\n  box-sizing: border-box;\n}\n\n.footer-view {\n  height: calc(120rpx + env(safe-area-inset-bottom));\n}\n</style>\n","import Component from '/Users/guoxiaoming/code/papa-code/pm-yn/uniapp-social-sports-new/src/components/mapTouch.vue'\nwx.createComponent(Component)"],"names":["uni"],"mappings":"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"}