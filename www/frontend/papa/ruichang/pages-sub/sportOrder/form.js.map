{"version":3,"file":"form.js","sources":["../../../../../src/pages-sub/sportOrder/form.vue","../../../../../uniPage:/cGFnZXMtc3ViL3Nwb3J0T3JkZXIvZm9ybS52dWU"],"sourcesContent":["<template>\n  <view class=\"order-form-page\">\n    <navBar\n      :navColor=\"'transparent'\"\n      title=\"\"\n      titleColor=\"#323233\"\n      backColor=\"#323233\"\n      :showBack=\"true\"\n    ></navBar>\n    <!-- 顶部渐变+标题+icon -->\n    <view class=\"form-header\">\n      <!-- <view class=\"header-title\">新增点单</view> -->\n      <image\n        src=\"https://cdn-static.papa.com.cn/social/sportsService/addOrderBanner.png\"\n        class=\"header-icon\"\n      />\n    </view>\n    <div class=\"main\">\n      <uv-form\n        ref=\"formRef\"\n        :model=\"form\"\n        :rules=\"rules\"\n        label-width=\"200rpx\"\n        label-align=\"left\"\n        :errorType=\"'toast'\"\n      >\n        <!-- 点单人信息模块 -->\n        <view class=\"greenBox\">\n          <view class=\"block-title-bg\">点单人信息</view>\n          <view class=\"block-content\">\n            <uv-form-item label=\"联系人\" prop=\"contact\" borderBottom>\n              <view style=\"text-align: right\">{{ appStore.userInfo.nick_name || '--' }}</view>\n            </uv-form-item>\n            <uv-form-item label=\"手机号\" prop=\"phone\">\n              <!-- <uv-input\n                v-model=\"form.phone\"\n                inputAlign=\"right\"\n                border=\"none\"\n                placeholder=\"请输入手机号\"\n              /> -->\n              <view style=\"text-align: right\">{{ appStore.userInfo.phone || '--' }}</view>\n            </uv-form-item>\n          </view>\n        </view>\n        <!-- 服务需求详情模块 -->\n        <view class=\"greenBox\">\n          <view class=\"block-title-bg\">服务需求详情</view>\n          <view class=\"block-content\">\n            <uv-form-item\n              label=\"类型\"\n              prop=\"dictName\"\n              @click=\"openTypeSelect\"\n              borderBottom\n              required\n            >\n              <uv-input\n                v-model=\"form.dictName\"\n                placeholder=\"请选择类型\"\n                inputAlign=\"right\"\n                readonly\n                border=\"none\"\n              ></uv-input>\n              <template v-slot:right>\n                <uv-icon name=\"arrow-right\"></uv-icon>\n              </template>\n            </uv-form-item>\n            <uv-form-item label=\"名称\" prop=\"name\" borderBottom required>\n              <uv-input\n                v-model=\"form.name\"\n                placeholder=\"请输入服务名称，不超过20字\"\n                maxlength=\"20\"\n                inputAlign=\"right\"\n                border=\"none\"\n              />\n            </uv-form-item>\n            <uv-form-item label=\"地址\" borderBottom prop=\"address\" required @click=\"openMapSelect\">\n              <uv-input\n                v-model=\"form.address\"\n                inputAlign=\"right\"\n                border=\"none\"\n                readonly\n                placeholder=\"请输入具体服务地点\"\n              />\n              <template v-slot:right>\n                <uv-icon name=\"arrow-right\"></uv-icon>\n              </template>\n            </uv-form-item>\n            <uv-form-item\n              label=\"服务起始时间\"\n              borderBottom\n              prop=\"serveStartDate\"\n              @click=\"openStartTimeSelect\"\n              required\n            >\n              <uv-input\n                v-model=\"form.serveStartDate\"\n                placeholder=\"请选择具体服务起始时间\"\n                inputAlign=\"right\"\n                border=\"none\"\n                readonly\n              />\n              <template v-slot:right>\n                <uv-icon name=\"arrow-right\"></uv-icon>\n              </template>\n            </uv-form-item>\n            <uv-form-item\n              label=\"服务结束时间\"\n              borderBottom\n              prop=\"serveEndDate\"\n              @click=\"openEndTimeSelect\"\n              required\n            >\n              <uv-input\n                v-model=\"form.serveEndDate\"\n                placeholder=\"请选择具体结束时间\"\n                inputAlign=\"right\"\n                border=\"none\"\n                readonly\n              />\n              <template v-slot:right>\n                <uv-icon name=\"arrow-right\"></uv-icon>\n              </template>\n            </uv-form-item>\n            <uv-form-item label=\"人数\" prop=\"peopleNum\" required>\n              <uv-input\n                v-model=\"form.peopleNum\"\n                inputAlign=\"right\"\n                border=\"none\"\n                placeholder=\"请输入参与服务活动人数\"\n              />\n            </uv-form-item>\n          </view>\n        </view>\n        <!-- 需求描述模块 -->\n        <view class=\"greenBox\">\n          <view class=\"block-title-bg\">需求描述</view>\n          <view class=\"\">\n            <uv-form-item>\n              <uv-textarea\n                v-model=\"form.demandDescription\"\n                placeholder=\"请详细输入需求具体内容，包括需要提供服务的具体内容、提供服务人员要求\"\n                maxlength=\"200\"\n                count\n                height=\"162\"\n                border=\"none\"\n                customStyle=\"padding: 24rpx;background: #f8fbfd;\"\n                placeholderStyle=\"line-height: 48rpx;font-size: 28rpx;color: rgba(192, 196, 204, 1);\"\n              />\n            </uv-form-item>\n          </view>\n        </view>\n      </uv-form>\n    </div>\n    <!-- 底部按钮 -->\n    <view class=\"footer-btn-wrap\">\n      <bottom-button @click=\"handleSubmit\">提交</bottom-button>\n      <uv-safe-bottom />\n    </view>\n    <!-- 类型选择ActionSheet -->\n    <uv-action-sheet\n      ref=\"typeSelect\"\n      :actions=\"typeActions\"\n      title=\"请选择类型\"\n      @select=\"onTypeSelect\"\n      round=\"20\"\n    />\n    <!-- 时间选择器 -->\n    <uv-datetime-picker\n      ref=\"startTmePicker\"\n      v-model=\"startTime\"\n      type=\"datetime\"\n      :formatter=\"formatter\"\n      @confirm=\"onStartTimeConfirm\"\n    />\n    <uv-datetime-picker\n      ref=\"endTimePicker\"\n      v-model=\"endTime\"\n      type=\"datetime\"\n      :formatter=\"formatter\"\n      @confirm=\"onEndTimeConfirm\"\n      :minDate=\"form.serveStartDate ? new Date(form.serveStartDate).getTime() : Date.now()\"\n    />\n  </view>\n</template>\n\n<script>\nimport { addOrder, getOrderSetting } from '@/apis/sportsService/serviceOrder'\nimport { getServicesDictPage } from '@/apis/sportsService/common'\nimport { formatTimeBase } from '@/utils/timeUtil.ts'\nimport { useAppStore } from '@/store'\nimport bottomButton from '@/components/bottomButton.vue'\n// getServicesDictPage\nexport default {\n  components: {\n    bottomButton,\n  },\n  data() {\n    return {\n      form: {\n        contact: '',\n        dictName: '',\n        dictId: '',\n        phone: '',\n        name: '',\n        address: '',\n        peopleNum: '',\n        serveStartDate: '',\n        serveEndDate: '',\n        demandDescription: '',\n      },\n      startTime: Date.now(),\n      endTime: Date.now(),\n      typeActions: [\n        // { name: '科学健身指导', value: '1' },\n        // { name: '广场舞指导', value: '2' },\n        // { name: '篮球培训', value: '3' },\n      ],\n      showTimePicker: false,\n      appStore: useAppStore(),\n      rules: {\n        dictName: {\n          required: true,\n          trigger: ['change'],\n          message: '请选择类型',\n        },\n        name: {\n          required: true,\n          trigger: ['change', 'blur'],\n          message: '请输入服务名称',\n        },\n        address: {\n          required: true,\n          trigger: ['change', 'blur'],\n          message: '请输入服务地址',\n        },\n        peopleNum: {\n          type: 'number',\n          min: 1,\n          required: true,\n          trigger: ['change', 'blur'],\n          message: '请输入正确的参与活动人数',\n        },\n        serveStartDate: {\n          required: true,\n          message: '请选择服务开始时间',\n          trigger: ['change'],\n        },\n        serveEndDate: {\n          required: true,\n          message: '请选择服务结束时间',\n          trigger: ['change'],\n        },\n        // demandDescription: {\n        //   required: true,\n        //   message: '请输入需求描述',\n        //   trigger: ['change', 'blur'],\n        // },\n      },\n      orderAuthor: {},\n      submited: false,\n    }\n  },\n  mounted() {\n    this.handelGetServicesDictPage()\n    this.handleJudgeAuth()\n  },\n  onShow() {\n    this.submited = false\n  },\n  methods: {\n    // 判断权限\n    handleJudgeAuth() {\n      const app = getApp()\n      let { userInfo } = app.globalData\n      // 判断是否实名认证\n      if (!userInfo.is_auth) {\n        // 弹窗提醒实名认证\n        uni.showModal({\n          title: '提示',\n          content: '请先完成实名认证',\n          confirmText: '去认证',\n          success: (res) => {\n            if (res.confirm) {\n              uni.reLaunch({\n                url: '/pagesSub/sportsService/realAuth/realAtuthSubmit',\n              })\n            } else if (res.cancel) {\n              uni.navigateBack()\n            }\n          },\n        })\n      } else {\n        // 判断身份\n        this.handelGetOderSetting()\n      }\n    },\n    // 获取点单配置\n    async handelGetOderSetting() {\n      const res = await getOrderSetting(1)\n      if (res.code === 0) {\n        const { userInfo } = this.appStore\n        this.orderAuthor = res.data.orderIdentity\n        const isAuth = userInfo.authTypes?.includes('siteManager')\n        if (this.orderAuthor === 'admin' && !isAuth) {\n          // 判断是否拥有该身份\n          uni.showModal({\n            title: '提示',\n            content: '只有站点管理员才能新增需求，您可前往”我的身份“查看自己的身份信息。',\n            success: (res) => {\n              if (res.confirm) {\n                uni.reLaunch({\n                  url: '/pagesSub/sportsService/realAuth/myIdentity',\n                })\n              } else if (res.cancel) {\n                uni.navigateBack()\n              }\n            },\n          })\n        }\n      }\n    },\n    // 打开地图选择地址\n    openMapSelect() {\n      uni.chooseLocation({\n        success: (res) => {\n          console.log({ res })\n          this.form.address = res.address + res.name\n          this.form.lat = res.latitude\n          this.form.lng = res.longitude\n        },\n      })\n    },\n    async handelGetServicesDictPage() {\n      const res = await getServicesDictPage({ dict_type_sign: 'service_type' })\n      if (res.code === 0) {\n        const list = res.data.listData\n        console.log({ list })\n        this.typeActions = list\n      }\n    },\n    openTypeSelect() {\n      this.$refs.typeSelect.open()\n    },\n    onTypeSelect(e) {\n      console.log({ e })\n\n      this.form.dictId = e.dictId\n      this.form.dictName = e.name\n    },\n    openStartTimeSelect() {\n      this.$refs.startTmePicker.open()\n    },\n    openEndTimeSelect() {\n      if (!this.form.serveStartDate) {\n        uni.showToast({\n          title: '请先选择服务开始时间',\n          icon: 'none',\n        })\n        return\n      }\n      this.$refs.endTimePicker.open()\n    },\n    onStartTimeConfirm(e) {\n      const newDate = formatTimeBase(e.value, '{y}-{m}-{d} {h}:{i}:{s}')\n      this.form.serveStartDate = newDate\n      // this.startTime = e.value\n    },\n    onEndTimeConfirm(e) {\n      const newDate = formatTimeBase(e.value, '{y}-{m}-{d} {h}:{i}:{s}')\n      this.form.serveEndDate = newDate\n    },\n    async handleSubmit() {\n      // uni.showToast({ title: '提交成功提交成功提交成功提交成功提交成功提交成功提交成功', icon: 'none' })\n      if (this.submited) return\n      // 表单校验和提交逻辑\n      this.$refs.formRef.validate().then(async () => {\n        // 判断人数是否大于1\n        if (this.form.peopleNum < 1) {\n          uni.showToast({\n            title: '服务参与人数请输入至少1人',\n            icon: 'none',\n          })\n          return\n        }\n        this.submited = true\n        const res = await addOrder(this.form)\n        if (res.code === 0) {\n          uni.showToast({ title: '提交成功', icon: 'success' })\n          // uni.navigateTo({ url: '/pagesSub/sportsService/serviceOrder' })\n          setTimeout(() => {\n            uni.navigateBack()\n          }, 500)\n        } else {\n          uni.showToast({ title: res.msg, icon: 'none' })\n        }\n      })\n    },\n    formatter(type, value) {\n      if (type === 'year') {\n        return `${value}年`\n      }\n      if (type === 'month') {\n        return `${value}月`\n      }\n      if (type === 'day') {\n        return `${value}日`\n      }\n      if (type === 'hour') {\n        return `${value}时`\n      }\n      if (type === 'minute') {\n        return `${value}分`\n      }\n      if (type === 'second') {\n        return `${value}秒`\n      }\n      return value\n    },\n  },\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.order-form-page {\n  min-height: 100vh;\n  background: #f7f8fa;\n  padding-bottom: 230rpx;\n}\n\n.main {\n  padding: 20rpx 32rpx;\n}\n\n.form-header {\n  position: relative;\n  height: 322rpx;\n  display: flex;\n  align-items: flex-start;\n  justify-content: space-between;\n  padding-left: 70rpx;\n  background: url('https://cdn-static.papa.com.cn/social/sportsService/addOrderBanner.png')\n    no-repeat;\n  background-size: cover;\n\n  .header-title {\n    font-size: 70rpx;\n    font-weight: 400;\n    color: rgba(48, 49, 51, 1);\n    line-height: 90rpx;\n    margin-top: 160rpx;\n  }\n\n  .header-icon {\n    width: 120rpx;\n    height: 120rpx;\n    margin-top: -32rpx;\n  }\n}\n\n.greenBox {\n  margin-bottom: 24rpx;\n\n  .block-title-bg {\n    font-size: 32rpx;\n    color: rgba(51, 51, 51, 1);\n    font-weight: 500;\n    line-height: 46rpx;\n    margin-bottom: 16rpx;\n  }\n\n  .block-content {\n    padding: 8rpx 24rpx 24rpx 24rpx;\n    background: #fff;\n  }\n}\n\n.footer-btn-wrap {\n  position: fixed;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: transparent;\n  padding: 24rpx 32rpx 32rpx 32rpx;\n  z-index: 10;\n}\n</style>\n","import MiniProgramPage from '/Users/guoxiaoming/code/papa-code/pm-yn/uniapp-social-sports-new/src/pages-sub/sportOrder/form.vue'\nwx.createPage(MiniProgramPage)"],"names":["useAppStore","uni","getOrderSetting","res","getServicesDictPage","formatTimeBase","addOrder"],"mappings":"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"}