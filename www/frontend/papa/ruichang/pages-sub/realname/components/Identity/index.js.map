{"version":3,"file":"index.js","sources":["../../../../../../../src/pages-sub/realname/components/Identity/index.vue","../../../../../../../uniComponent:/L1VzZXJzL2d1b3hpYW9taW5nL2NvZGUvcGFwYS1jb2RlL3BtLXluL3VuaWFwcC1zb2NpYWwtc3BvcnRzLW5ldy9zcmMvcGFnZXMtc3ViL3JlYWxuYW1lL2NvbXBvbmVudHMvSWRlbnRpdHkvaW5kZXgudnVl"],"sourcesContent":["<template>\n  <view class=\"h-full px-4 flex flex-col\">\n    <view>\n      <uv-form\n        ref=\"uForm\"\n        :model=\"formData\"\n        :label-width=\"90\"\n        :border-bottom=\"true\"\n        label-position=\"left\"\n        errorType=\"toast\"\n      >\n        <uv-form-item prop=\"realName\" :customStyle=\"formItemCustomStyle\">\n          <uv-input\n            v-model=\"formData.realName\"\n            border=\"none\"\n            placeholder=\"请输入姓名\"\n            inputAlign=\"right\"\n          >\n            <template #prefix>\n              <text>姓名</text>\n            </template>\n            <!-- <template #suffix>\n              <text>|输入</text>\n            </template> -->\n          </uv-input>\n        </uv-form-item>\n        <uv-form-item prop=\"idcardNo\" :customStyle=\"formItemCustomStyle\">\n          <uv-input\n            v-model=\"formData.idcardNo\"\n            border=\"none\"\n            placeholder=\"请输入身份证号\"\n            inputAlign=\"right\"\n          >\n            <template #prefix>\n              <text>身份证号</text>\n            </template>\n            <!-- <template #suffix>\n              <text class=\"suffix-idcard\">请输入身份证号</text>\n            </template> -->\n          </uv-input>\n        </uv-form-item>\n      </uv-form>\n      <!-- <view class=\"text-red-500 text-xs pt-4\">\n        注意: 此处仅作演示，姓名和身份证可以不真实，但格式需正确\n      </view> -->\n    </view>\n    <view class=\"center pt-30\">\n      <view class=\"next-step\">\n        <uv-button\n          type=\"primary\"\n          text=\"下一步\"\n          shape=\"circle\"\n          @click=\"handleSubmit\"\n          plain\n        ></uv-button>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script>\nimport * as user from '@/apis/user/index'\nimport { isMp } from '@/utils/platform'\nexport default {\n  props: {\n    handler: {\n      type: Function,\n      default: () => () => {},\n    },\n  },\n  data() {\n    return {\n      formItemCustomStyle: {\n        background: 'rgba(246, 248, 252, 1)',\n        padding: '24rpx 32rpx',\n        borderRadius: '12rpx',\n        marginBottom: '24rpx',\n      },\n      formData: {\n        realName: '',\n        idcardNo: '',\n      },\n      formRules: {\n        realName: {\n          type: 'string',\n          required: true,\n          message: '姓名不能为空',\n          trigger: ['blur'],\n        },\n        idcardNo: [\n          {\n            type: 'string',\n            required: true,\n            message: '身份证号不能为空',\n            trigger: ['blur'],\n          },\n          {\n            validator: (rule, value, callback) => uni.$u.test.idCard(value),\n            message: '身份证号格式错误',\n            trigger: ['blur'],\n          },\n        ],\n      },\n    }\n  },\n  computed: {\n    userInfo() {\n      return this.$store.user.userInfo\n    },\n  },\n  created() {\n    this.formData = {\n      ...this.formData,\n      realName: this.userInfo.realName,\n      idcardNo: this.userInfo.idcardNo,\n    }\n  },\n  mounted() {\n    this.$refs.uForm.setRules(this.formRules)\n  },\n  methods: {\n    async handleSubmit() {\n      try {\n        await this.$refs.uForm.validate()\n      } catch (error) {\n        console.warn('error', error)\n        return\n      }\n\n      const params = {\n        ...this.formData,\n        name: this.formData.realName,\n        id_card: this.formData.idcardNo,\n      }\n      this.$loading(true)\n      const res = await (isMp ? user.platformUserAuth(params) : user.userAuth(params))\n      this.$loading(false)\n      if (res.code == 200) {\n        const authed = res.data\n        if (authed) {\n          this.handler({\n            active: 1,\n            params: {\n              ...params,\n              phone: authed,\n            },\n          })\n        }\n      } else {\n        uni.showModal({\n          title: '提示',\n          showCancel: false,\n          confirmText: '我知道了',\n          content: res.message,\n          success: (e) => {\n            console.log(e)\n          },\n        })\n      }\n    },\n    async handleBind() {\n      const params = {\n        ...this.formData,\n      }\n      this.$loading(true)\n      const res = await this.$api.bindUserinfo(params)\n      this.$loading(false)\n      if (res.success) {\n        const binded = res.data\n        if (binded) {\n          await this.$toast('该用户信息已存在, 自动绑定成功')\n          this.handler({\n            active: 3,\n            params: {\n              ...this.formData,\n              binded,\n            },\n          })\n          return\n        }\n\n        this.$toast('绑定失败, 请联系客服')\n      }\n    },\n  },\n}\n</script>\n\n<style lang=\"scss\" scoped>\n:deep(.uv-input__content__prefix-icon) {\n  margin-left: 10px;\n  color: rgba(96, 98, 102, 1);\n}\n\n:deep(.uv-input__content__subfix-icon) {\n  margin-right: 10px;\n}\n\n:deep(.uv-input) {\n  background: rgba(246, 248, 252, 1);\n}\n\n:deep(.uv-input__content__field-wrapper__field) {\n  text-align: right !important;\n  padding-right: 10rpx !important;\n}\n\n:deep(.uv-form-item__body__right__message) {\n  text-align: right;\n}\n.next-step {\n  width: 45%;\n}\n.center {\n  display: flex;\n  justify-content: center;\n}\n\n.suffix-idcard {\n  color: rgba(168, 171, 178, 1);\n}\n</style>\n","import Component from '/Users/guoxiaoming/code/papa-code/pm-yn/uniapp-social-sports-new/src/pages-sub/realname/components/Identity/index.vue'\nwx.createComponent(Component)"],"names":["uni","isMp","user.platformUserAuth","user.userAuth"],"mappings":"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"}