{"version":3,"file":"uv-drop-down-popup.js","sources":["../../../../../../../src/components/dropDown/my-drop-down/uv-drop-down-popup/uv-drop-down-popup.vue","../../../../../../../uniComponent:/L1VzZXJzL2d1b3hpYW9taW5nL2NvZGUvcGFwYS1jb2RlL3BtLXluL3VuaWFwcC1zb2NpYWwtc3BvcnRzLW5ldy9zcmMvY29tcG9uZW50cy9kcm9wRG93bi9teS1kcm9wLWRvd24vdXYtZHJvcC1kb3duLXBvcHVwL3V2LWRyb3AtZG93bi1wb3B1cC52dWU"],"sourcesContent":["<template>\n  <view class=\"uv-drop-down-popup\">\n    <uv-transition\n      :show=\"show\"\n      mode=\"fade\"\n      :duration=\"300\"\n      :custom-style=\"overlayStyle\"\n      @click=\"clickOverlay\"\n    >\n      <view\n        class=\"uv-dp__container\"\n        ref=\"uvDPContainer\"\n        :style=\"{ height: `${height}px` }\"\n        @click.stop=\"blockClick\"\n      >\n        <view class=\"uv-dp__container__list\" ref=\"uvDPList\">\n          <slot v-if=\"useSlot\"></slot>\n          <view\n            v-if=\"!useSlot\"\n            class=\"uv-dp__container__list--item\"\n            v-for=\"(item, index) in list\"\n            :key=\"index\"\n            @click=\"clickHandler(item, index)\"\n            :style=\"[itemCustomStyle(index)]\"\n          >\n            <uv-text\n              :text=\"item[keyName]\"\n              :size=\"getTextSize(index)\"\n              :color=\"getTextColor(index)\"\n            ></uv-text>\n            <uv-icon\n              v-if=\"getActive(index)\"\n              name=\"checkmark\"\n              :color=\"getTextColor(index)\"\n              size=\"16\"\n            ></uv-icon>\n          </view>\n        </view>\n      </view>\n    </uv-transition>\n  </view>\n</template>\n<script>\nimport mpMixin from '@climblee/uv-ui/libs/mixin/mpMixin.js'\nimport mixin from '@climblee/uv-ui/libs/mixin/mixin.js'\n// #ifdef APP-NVUE\nconst animation = uni.requireNativePlugin('animation')\nconst dom = uni.requireNativePlugin('dom')\n// #endif\n/**\n * DropDownPopup 下拉框\n * @description 下拉筛选框\n * @tutorial https://ext.dcloud.net.cn/plugin?name=uv-drop-down\n * @property {String | Number} name 字段标识\n * @property {String | Number} zIndex 弹出层的层级\n * @property {String | Number} opacity 遮罩层的透明度\n * @property {Boolean} clickOverlayOnClose 是否允许点击遮罩层关闭弹窗\n * @property {Object} currentDropItem 当前下拉筛选菜单对象\n * @property {String} keyName 指定从当前下拉筛选菜单对象元素中读取哪个属性作为文本展示\n */\nexport default {\n  name: 'uv-drop-down-popup',\n  mixins: [mpMixin, mixin],\n  props: {\n    sign: {\n      type: [String, Number],\n      default: 'UVDROPDOWN',\n    },\n    zIndex: {\n      type: [Number, String],\n      default: 999,\n    },\n    opacity: {\n      type: [Number, String],\n      default: 0.5,\n    },\n    clickOverlayOnClose: {\n      type: Boolean,\n      default: true,\n    },\n    // 当前下拉选项对象\n    currentDropItem: {\n      type: Object,\n      default() {\n        return {\n          activeIndex: 0,\n          child: [],\n        }\n      },\n    },\n    keyName: {\n      type: String,\n      default: 'label',\n    },\n    useSlot: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  data() {\n    return {\n      show: false,\n      rect: {},\n      height: 0,\n    }\n  },\n  computed: {\n    overlayStyle() {\n      let { height = 0, top = 0 } = this.rect\n      // #ifdef H5\n      top += this.$uv.sys().windowTop\n      // #endif\n      const style = {\n        position: 'fixed',\n        top: `${top + height}px`,\n        left: 0,\n        right: 0,\n        zIndex: this.zIndex,\n        bottom: 0,\n        'background-color': `rgba(0, 0, 0, ${this.opacity})`,\n      }\n      return this.$uv.deepMerge(style, this.$uv.addStyle(this.customStyle))\n    },\n    list() {\n      try {\n        return Array.isArray(this.currentDropItem.child) ? this.currentDropItem.child : []\n      } catch (e) {\n        return []\n      }\n    },\n    getTextColor(index) {\n      return (index) => {\n        const active = this.currentDropItem.activeIndex == index\n        const color = this.currentDropItem.color\n        const activeColor = this.currentDropItem.activeColor\n        if (active) {\n          return activeColor ? activeColor : '#3c9cff'\n        }\n        return color ? color : '#333'\n      }\n    },\n    getActive(index) {\n      return (index) => {\n        const active = this.currentDropItem.activeIndex == index\n        return active\n      }\n    },\n    getTextSize(index) {\n      return (index) => {\n        const active = this.currentDropItem.activeIndex == index\n        const size = this.currentDropItem.size\n        const activeSize = this.currentDropItem.activeSize\n        if (active) {\n          return activeSize ? activeSize : '30rpx'\n        }\n        return size ? size : '30rpx'\n      }\n    },\n    itemCustomStyle() {\n      return (index) => {\n        const active = this.currentDropItem.activeIndex == index\n        const style = {}\n        if (active && this.currentDropItem.itemActiveCustomStyle) {\n          return this.$uv.deepMerge(\n            style,\n            this.$uv.addStyle(this.currentDropItem.itemActiveCustomStyle),\n          )\n        }\n        if (this.currentDropItem.itemCustomStyle) {\n          return this.$uv.deepMerge(style, this.$uv.addStyle(this.currentDropItem.itemCustomStyle))\n        }\n        return style\n      }\n    },\n  },\n  created() {\n    this.init()\n  },\n  methods: {\n    blockClick() {},\n    clickHandler(item, index) {\n      this.currentDropItem.activeIndex = index\n      this.$emit('clickItem', item)\n      this.close()\n    },\n    init() {\n      uni.$off(`${this.sign}_GETRECT`)\n      uni.$on(`${this.sign}_GETRECT`, (rect) => {\n        this.rect = rect\n      })\n      uni.$off(`${this.sign}_CLICKMENU`)\n      uni.$on(`${this.sign}_CLICKMENU`, async (res) => {\n        if (res.show) {\n          this.open()\n        } else {\n          this.close()\n        }\n      })\n    },\n    open() {\n      this.show = true\n      this.$nextTick(async () => {\n        // #ifndef H5 || MP-WEIXIN\n        await this.$uv.sleep(60)\n        // #endif\n        const res = await this.queryRect()\n        // #ifndef APP-NVUE\n        this.height = res.height\n        // #endif\n        // #ifdef APP-NVUE\n        this.animation(res.height)\n        // #endif\n        this.$emit('popupChange', { show: true })\n      })\n    },\n    close() {\n      if (!this.show) return\n      this.height = 0\n      // #ifndef APP-NVUE\n      this.height = 0\n      // #endif\n      // #ifdef APP-NVUE\n      this.animation(0)\n      // #endif\n      this.show = false\n      uni.$emit(`${this.sign}_CLOSEPOPUP`)\n      this.$emit('popupChange', { show: false })\n    },\n    clickOverlay() {\n      if (this.clickOverlayOnClose) {\n        this.close()\n      }\n    },\n    // 查询内容高度\n    queryRect() {\n      // #ifndef APP-NVUE\n      // 组件内部一般用this.$uvGetRect，对外的为getRect，二者功能一致，名称不同\n      return new Promise((resolve) => {\n        this.$uvGetRect(`.uv-dp__container__list`).then((size) => {\n          resolve(size)\n        })\n      })\n      // #endif\n      // #ifdef APP-NVUE\n      // nvue下，使用dom模块查询元素高度\n      // 返回一个promise，让调用此方法的主体能使用then回调\n      return new Promise((resolve) => {\n        dom.getComponentRect(this.$refs.uvDPList, (res) => {\n          resolve(res.size)\n        })\n      })\n      // #endif\n    },\n    // nvue下设置高度\n    animation(height, duration = 200) {\n      // #ifdef APP-NVUE\n      const ref = this.$refs['uvDPContainer']\n      animation.transition(ref, {\n        styles: {\n          height: `${height}px`,\n        },\n        duration,\n      })\n      // #endif\n    },\n  },\n}\n</script>\n<style scoped lang=\"scss\">\n.uv-dp__container {\n  /* #ifndef APP-NVUE */\n  overflow: hidden;\n  transition: all 0.15s;\n  /* #endif */\n  // max-height: 50vh;\n  overflow: scroll;\n  background-color: #fff;\n  border-radius: 0 0 32rpx 32rpx;\n}\n.uv-dp__container__list {\n  &--item {\n    padding: 20rpx 32rpx;\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n  }\n}\n</style>\n","import Component from '/Users/guoxiaoming/code/papa-code/pm-yn/uniapp-social-sports-new/src/components/dropDown/my-drop-down/uv-drop-down-popup/uv-drop-down-popup.vue'\nwx.createComponent(Component)"],"names":["mpMixin","mixin","index","uni"],"mappings":"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"}