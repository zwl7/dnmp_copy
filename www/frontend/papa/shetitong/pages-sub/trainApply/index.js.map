{"version":3,"file":"index.js","sources":["../../../../../src/pages-sub/trainApply/index.vue","../../../../../uniPage:/cGFnZXMtc3ViL3RyYWluQXBwbHkvaW5kZXgudnVl"],"sourcesContent":["<template>\n  <view class=\"apply-container flex flex-col\">\n    <view class=\"train-title\">\n      <text class=\"uv-line-2\">{{ form.title }}</text>\n      <image :src=\"trainApply\" />\n    </view>\n    <view class=\"form-container overflow-auto mb-15\">\n      <TrainApplyForm\n        v-bind=\"{ formData: form, readonly }\"\n        ref=\"formItem\"\n        v-if=\"is_fill_instructor_info\"\n      ></TrainApplyForm>\n      <view class=\"common-title\" v-if=\"otherFormOptions.length\">其他信息</view>\n      <paForm\n        :value=\"otherFormValue\"\n        :optionList=\"otherFormOptions\"\n        :rules=\"otherFormRules\"\n        ref=\"otherFormRef\"\n      />\n    </view>\n    <view class=\"footer-fixed\">\n      <uv-button\n        type=\"primary\"\n        text=\"提交\"\n        shape=\"circle\"\n        size=\"medium\"\n        @click=\"submit\"\n      ></uv-button>\n    </view>\n  </view>\n</template>\n<script>\nimport TrainApplyForm from './form.vue'\nimport { rules } from './index.js'\nimport trainApply from '@/static/images/train-apply-bg.png'\nimport uniStorage from '@/utils/storages/uniStorage'\nimport paForm from '@/components/paForm/paForm.vue'\nimport FormatBackDataClass from '@/components/paForm/formatData.js'\nexport default {\n  components: {\n    TrainApplyForm,\n    paForm,\n  },\n  data() {\n    return {\n      rules,\n      readonly: false,\n      trainApply,\n      form: {},\n      is_fill_instructor_info: 1,\n      field_info: [],\n      otherFormValue: {},\n      otherFormOptions: [],\n      otherFormRules: {},\n    }\n  },\n  onLoad(options) {\n    let form = uniStorage.get('APPLYFORM')\n    console.log('----form', form)\n    this.form.title = form.title\n    this.form.train_activity_id = form.trainId\n    if (form.train_activity_id) {\n      this.getDetail(form.train_activity_id)\n    }\n    if (options.id) {\n      this.getTrainDetail(options.id)\n    }\n  },\n  methods: {\n    async getDetail(id) {\n      let res = await this.$api.getVoluntaryActivityItem({ train_activity_id: id })\n      if (res.code == 200) {\n        this.readonly = true\n        this.form = res.data\n      }\n    },\n    async getTrainDetail(id) {\n      let res = await this.$api.getWxTrainActivityItem({ train_activity_id: id })\n      if (res.code == 200) {\n        this.is_fill_instructor_info = res.data.is_fill_instructor_info\n        try {\n          let { fields, field_info } = res.data\n          field_info = JSON.parse(field_info)\n          let is_must_obj = {}\n          field_info.map((e) => {\n            is_must_obj[e.id] = e.m\n          })\n          fields.map((e) => {\n            if (e.field_select_value) {\n              e.field_select_value = JSON.parse(e.field_select_value)\n            }\n            e.is_must = is_must_obj[e.field_id]\n          })\n          let formatClass = new FormatBackDataClass(fields)\n          let formValue = formatClass.getDefaultData()\n          let formRules = formatClass.getRules()\n          let formOptions = formatClass.getDataList()\n          console.log({ formValue, formRules, formOptions })\n          this.otherFormRules = formRules\n          this.otherFormValue = formValue\n          this.otherFormOptions = formOptions\n        } catch (error) {\n          console.warn('error', error)\n        }\n      }\n    },\n    async submit() {\n      try {\n        let baseValidate = false\n        let form = {}\n        if (this.is_fill_instructor_info == 1) {\n          baseValidate = await this.$refs.formItem.validate()\n          this.form = { ...this.form, ...this.$refs.formItem.form }\n          let result = []\n          Object.keys(this.rules).forEach((key) => {\n            if (!this.form[key]) {\n              result.push(this.rules[key])\n            }\n          })\n          if (result.length > 0) {\n            this.$toast(result[0].message)\n            return\n          }\n          form = {\n            ...this.form,\n            first_become_time: Date.parse(this.form.time) / 1000 || 0,\n            now_level_grant_time: Date.parse(this.form.now_level_grant_time) / 1000 || 0,\n          }\n          if (form.fileList?.length > 0) {\n            form.avatar = form.fileList[0].url\n          }\n        } else {\n          form.train_activity_id = this.form.train_activity_id\n        }\n        let otherFormRef = this.$refs['otherFormRef']\n        let flag = await otherFormRef.validate()\n        let customData = otherFormRef.getCustomData()\n        if ((!baseValidate && this.is_fill_instructor_info == 1) || !flag) {\n          return\n        }\n        form.field_info = JSON.stringify([customData])\n        form.id && delete form.id\n        let res = await this.$api.addWxTrainActivityItem(form)\n        if (res.code == 200) {\n          await this.$toast('报名成功')\n          uni.redirectTo({ url: '/pages-sub/applyResult/success?type=train&title=报名成功' })\n        } else {\n          this.$toast(res.message)\n        }\n      } catch (error) {\n        console.warn('error', error)\n      }\n    },\n  },\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.apply-container {\n  padding-top: 32rpx;\n  // min-height: 100%;\n  background-color: #fff;\n\n  .train-title {\n    position: relative;\n    display: flex;\n    align-items: center;\n    overflow: hidden;\n    padding: 32rpx;\n    margin: 0 32rpx 32rpx;\n    height: 160rpx;\n    background-color: #ecf5ff;\n    border-radius: 16rpx;\n    box-sizing: border-box;\n\n    .uv-line-2 {\n      width: 68%;\n      font-size: 32rpx;\n      font-weight: 600;\n    }\n\n    image {\n      position: absolute;\n      right: -5%;\n      bottom: -9%;\n      width: 250rpx;\n      height: 150rpx;\n    }\n  }\n\n  .form-container {\n    padding: 0 32rpx 100rpx;\n    font-size: 28rpx;\n    color: #606266;\n    font-weight: 400;\n  }\n\n  .submit-btn {\n    margin-top: 80rpx;\n    height: 80rpx;\n    font-size: 28rpx;\n    color: #fff;\n    border-radius: 200rpx;\n    line-height: 80rpx;\n  }\n}\n\n.footer-fixed {\n  z-index: 1000;\n}\n.common-title {\n  color: $hubei-primary;\n  font-weight: 600;\n  font-size: 32rpx;\n  width: 100%;\n  height: 80rpx;\n  line-height: 80rpx;\n  padding: 0 40rpx;\n  margin-top: 32rpx;\n  opacity: 1;\n  border-radius: 80rpx;\n  background: linear-gradient(227.21deg, rgba(30, 141, 255, 0) 0%, rgba(48, 148, 255, 0.17) 100%);\n}\n</style>\n","import MiniProgramPage from '/Users/guoxiaoming/code/papa-code/pm-yn/uniapp-social-sports-new/src/pages-sub/trainApply/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["rules","trainApply","uniStorage","FormatBackDataClass","uni"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgCA,uBAAA,MAAA;AAIA,eAAA,MAAA;AAEA,MAAA,YAAA;AAAA,EACA,YAAA;AAAA,IACA;AAAA,IACA;AAAA,EACA;AAAA,EACA,OAAA;AACA,WAAA;AAAA,aACAA,MAAA;AAAA,MACA,UAAA;AAAA,kBACAC,cAAA;AAAA,MACA,MAAA,CAAA;AAAA,MACA,yBAAA;AAAA,MACA,YAAA,CAAA;AAAA,MACA,gBAAA,CAAA;AAAA,MACA,kBAAA,CAAA;AAAA,MACA,gBAAA,CAAA;AAAA,IACA;AAAA,EACA;AAAA,EACA,OAAA,SAAA;AACA,QAAA,OAAAC,qCAAA,IAAA,WAAA;AACA,YAAA,IAAA,YAAA,IAAA;AACA,SAAA,KAAA,QAAA,KAAA;AACA,SAAA,KAAA,oBAAA,KAAA;AACA,QAAA,KAAA,mBAAA;AACA,WAAA,UAAA,KAAA,iBAAA;AAAA,IACA;AACA,QAAA,QAAA,IAAA;AACA,WAAA,eAAA,QAAA,EAAA;AAAA,IACA;AAAA,EACA;AAAA,EACA,SAAA;AAAA,IACA,UAAA,IAAA;AAAA;AACA,YAAA,MAAA,MAAA,KAAA,KAAA,yBAAA,EAAA,mBAAA,GAAA,CAAA;AACA,YAAA,IAAA,QAAA,KAAA;AACA,eAAA,WAAA;AACA,eAAA,OAAA,IAAA;AAAA,QACA;AAAA,MACA;AAAA;AAAA,IACA,eAAA,IAAA;AAAA;AACA,YAAA,MAAA,MAAA,KAAA,KAAA,uBAAA,EAAA,mBAAA,GAAA,CAAA;AACA,YAAA,IAAA,QAAA,KAAA;AACA,eAAA,0BAAA,IAAA,KAAA;AACA,cAAA;AACA,gBAAA,EAAA,QAAA,WAAA,IAAA,IAAA;AACA,yBAAA,KAAA,MAAA,UAAA;AACA,gBAAA,cAAA,CAAA;AACA,uBAAA,IAAA,CAAA,MAAA;AACA,0BAAA,EAAA,EAAA,IAAA,EAAA;AAAA,YACA,CAAA;AACA,mBAAA,IAAA,CAAA,MAAA;AACA,kBAAA,EAAA,oBAAA;AACA,kBAAA,qBAAA,KAAA,MAAA,EAAA,kBAAA;AAAA,cACA;AACA,gBAAA,UAAA,YAAA,EAAA,QAAA;AAAA,YACA,CAAA;AACA,gBAAA,cAAA,IAAAC,6BAAAA,oBAAA,MAAA;AACA,gBAAA,YAAA,YAAA,eAAA;AACA,gBAAA,YAAA,YAAA,SAAA;AACA,gBAAA,cAAA,YAAA,YAAA;AACA,oBAAA,IAAA,EAAA,WAAA,WAAA,YAAA,CAAA;AACA,iBAAA,iBAAA;AACA,iBAAA,iBAAA;AACA,iBAAA,mBAAA;AAAA,UACA,SAAA,OAAA;AACA,oBAAA,KAAA,SAAA,KAAA;AAAA,UACA;AAAA,QACA;AAAA,MACA;AAAA;AAAA,IACA,SAAA;AAAA;;AACA,YAAA;AACA,cAAA,eAAA;AACA,cAAA,OAAA,CAAA;AACA,cAAA,KAAA,2BAAA,GAAA;AACA,2BAAA,MAAA,KAAA,MAAA,SAAA,SAAA;AACA,iBAAA,OAAA,kCAAA,KAAA,OAAA,KAAA,MAAA,SAAA;AACA,gBAAA,SAAA,CAAA;AACA,mBAAA,KAAA,KAAA,KAAA,EAAA,QAAA,CAAA,QAAA;AACA,kBAAA,CAAA,KAAA,KAAA,GAAA,GAAA;AACA,uBAAA,KAAA,KAAA,MAAA,GAAA,CAAA;AAAA,cACA;AAAA,YACA,CAAA;AACA,gBAAA,OAAA,SAAA,GAAA;AACA,mBAAA,OAAA,OAAA,CAAA,EAAA,OAAA;AACA;AAAA,YACA;AACA,mBAAA,iCACA,KAAA,OADA;AAAA,cAEA,mBAAA,KAAA,MAAA,KAAA,KAAA,IAAA,IAAA,OAAA;AAAA,cACA,sBAAA,KAAA,MAAA,KAAA,KAAA,oBAAA,IAAA,OAAA;AAAA,YACA;AACA,kBAAA,UAAA,aAAA,mBAAA,UAAA,GAAA;AACA,mBAAA,SAAA,KAAA,SAAA,CAAA,EAAA;AAAA,YACA;AAAA,iBACA;AACA,iBAAA,oBAAA,KAAA,KAAA;AAAA,UACA;AACA,cAAA,eAAA,KAAA,MAAA,cAAA;AACA,cAAA,OAAA,MAAA,aAAA,SAAA;AACA,cAAA,aAAA,aAAA,cAAA;AACA,cAAA,CAAA,gBAAA,KAAA,2BAAA,KAAA,CAAA,MAAA;AACA;AAAA,UACA;AACA,eAAA,aAAA,KAAA,UAAA,CAAA,UAAA,CAAA;AACA,eAAA,MAAA,OAAA,KAAA;AACA,cAAA,MAAA,MAAA,KAAA,KAAA,uBAAA,IAAA;AACA,cAAA,IAAA,QAAA,KAAA;AACA,kBAAA,KAAA,OAAA,MAAA;AACAC,0BAAAA,MAAA,WAAA,EAAA,KAAA,uDAAA,CAAA;AAAA,iBACA;AACA,iBAAA,OAAA,IAAA,OAAA;AAAA,UACA;AAAA,QACA,SAAA,OAAA;AACA,kBAAA,KAAA,SAAA,KAAA;AAAA,QACA;AAAA,MACA;AAAA;AAAA,EACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACzJA,GAAG,WAAW,eAAe;"}