{"version":3,"file":"detail.js","sources":["../../../../../src/pages-sub/trainApply/detail.vue","../../../../../uniPage:/cGFnZXMtc3ViL3RyYWluQXBwbHkvZGV0YWlsLnZ1ZQ"],"sourcesContent":["<template>\n  <view class=\"apply-container\">\n    <view class=\"train-header\">\n      <view class=\"train-title\">\n        <view class=\"mt-2\">\n          <text class=\"uv-line-2\">{{ form.promote_name }}</text>\n        </view>\n        <view class=\"mt-8 train-item\">\n          <view class=\"flex-between\">\n            <view class=\"w-50\">\n              <text class=\"color-grey mr-3\">ÂüπËÆ≠È°πÁõÆ</text>\n              <text>{{ form.promoteTagStr }}</text>\n            </view>\n            <view class=\"w-50\">\n              <text class=\"color-grey mr-3\">ÂüπËÆ≠Á∫ßÂà´</text>\n              <text>{{ form.promote_level_str }}</text>\n            </view>\n          </view>\n          <view class=\"flex-between mt-4\">\n            <view class=\"w-50\">\n              <text class=\"color-grey mr-3\">Êä•ÂêçÁä∂ÊÄÅ</text>\n              <text>{{ form.status_str }}</text>\n            </view>\n            <view class=\"w-50\">\n              <text class=\"color-grey mr-3\">ÂÆ°Ê†∏Â§áÊ≥®</text>\n              <text>{{ form.notes }}</text>\n            </view>\n          </view>\n        </view>\n      </view>\n      <view class=\"flex-between pd-32\">\n        <text style=\"font-weight: bold\">Êä•Âêç‰ø°ÊÅØ</text>\n        <!-- ‰∏çÁªôÁºñËæëÂÖà -->\n        <view v-if=\"false\">\n          <text v-if=\"readonly\" style=\"color: rgba(168, 171, 178, 1)\" @click=\"isEdit\">ÁºñËæë</text>\n          <text v-else class=\"submit-btn\" @click=\"submit\">ÂÆåÊàê</text>\n        </view>\n      </view>\n    </view>\n    <view class=\"form-container\">\n      <TrainApplyForm\n        v-bind=\"{ formData: form, readonly }\"\n        ref=\"trainApplyForm\"\n        v-if=\"is_fill_instructor_info\"\n      ></TrainApplyForm>\n      <view class=\"common-title mt-32\" v-if=\"customFormOptions.length > 0\">ÂÖ∂‰ªñ‰ø°ÊÅØ</view>\n      <paFormDetail :optionList=\"customFormOptions\" />\n    </view>\n    <!-- <view class=\"footer-fixed\">\n\t\t\t<uv-button\n\t\t\t\tclass=\"logout-btn mr-2\"\n\t\t\t\ttype=\"primary\"\n\t\t\t\t:plain=\"true\"\n\t\t\t\tshape=\"circle\"\n\t\t\t\tsize=\"medium\"\n\t\t\t\t@click=\"cancelApply\"\n\t\t\t\t>ÂèñÊ∂àÊä•Âêç</uv-button\n\t\t\t>\n\t\t</view> -->\n  </view>\n</template>\n<script>\nimport TrainApplyForm from './form'\nimport { rules } from './index.js'\nimport uniStorage from '@/utils/storages/uniStorage'\nimport paFormDetail from '@/components/paForm/paFormDetail.vue'\nexport default {\n  components: {\n    TrainApplyForm,\n    paFormDetail,\n  },\n  data() {\n    return {\n      rules,\n      type: 3,\n      readonly: false,\n      form: {\n        name: '',\n      },\n      field_info: [],\n      customFields: [],\n      is_fill_instructor_info: 1,\n      customFormOptions: [],\n    }\n  },\n  onUnload() {\n    uniStorage.remove('TrainApplyId')\n  },\n  onLoad(options) {\n    if (options.train_activity_apply_id) {\n      this.getDetail(options.train_activity_apply_id)\n    }\n  },\n  methods: {\n    isEdit() {\n      this.readonly = false\n      this.$refs.trainApplyForm.changeVisible()\n    },\n    cancelApply() {},\n    async getDetail(id) {\n      let res = await this.$api.getWxTrainActivityApplyItem({ train_activity_apply_id: id })\n      if (res.code == 200) {\n        this.readonly = true\n        let form = res.data\n        form = {\n          ...form,\n          title: `${form.province_str}${form.city_str}${form.county_str}${form.promote_level_str || ''}`,\n          avatar: form.avatar || form.avatar_str,\n          tagIdsStr: (form.tag_ids_arr || [])\n            .map((item) => {\n              return item.tag_id_str\n            })\n            .join(','),\n          promoteTagStr: (form.promote_tag_ids_arr || [])\n            .map((item) => {\n              return item.tag_id_str\n            })\n            .join(','),\n          tagGroup: `${form.province_str}/${form.city_str}/${form.county_str}`,\n          nationStr: form.nation_str,\n          educationLevelStr: form.education_level_str,\n          levelStr: form.level_str,\n          guide_type: form.guide_type,\n          guideTypeStr: form.guide_type_str,\n          personnelFormStr: form.personnel_form_str,\n          time:\n            form.first_become_time == 0\n              ? ''\n              : this.$dayjs(form.first_become_time * 1000).format('YYYY-MM-DD'),\n          now_level_organ_unit_name: form.now_level_organ_unit_name,\n          now_level_grant_time:\n            form.now_level_grant_time == 0\n              ? ''\n              : this.$dayjs(form.now_level_grant_time * 1000).format('YYYY-MM-DD'),\n          status_str: form.status_str || this.$dict.getDictLabel('statusColor', form.status, {}),\n          areaRangeStr: form.area_range_str,\n        }\n        this.field_info = res.data.field_info\n        await this.getTrainDetail(res.data.train_activity_id)\n        this.customFormOptions = this.formatCustomProblem()\n        console.log(this.customFormOptions)\n        this.form = form\n      } else {\n        this.$toast(res.message)\n      }\n    },\n    async getTrainDetail(train_activity_id) {\n      let res = await this.$api.getWxTrainActivityItem({ train_activity_id: train_activity_id })\n      if (res.code == 200) {\n        try {\n          this.is_fill_instructor_info = res.data.is_fill_instructor_info\n          this.customFields = res.data.fields\n          console.log('üöÄ ~ getTrainDetail ~ customFields:', this.customFields)\n        } catch (error) {\n          console.error('getTrainDetail', error)\n        }\n      }\n    },\n    // Ê†ºÂºèÂåñËá™ÂÆö‰πâÈóÆÈ¢ò\n    formatCustomProblem() {\n      let list = []\n      let answerInfo = {}\n      try {\n        let field_info = JSON.parse(this.field_info)\n        answerInfo = field_info[0]\n      } catch (e) {\n        console.error('formatCustomProblem', e)\n      }\n      this.customFields.map((e) => {\n        let obj = { label: e.field_name }\n        if (e.field_type == 10) {\n          obj.type == 'image'\n        }\n        let isFormatArray = answerInfo[e.field_id] instanceof Array && e.field_type != 10\n        if (isFormatArray) {\n          answerInfo[e.field_id] = answerInfo[e.field_id].join(',')\n        }\n        obj['value'] = answerInfo[e.field_id]\n        list.push(obj)\n      })\n      return list\n    },\n    async submit() {\n      try {\n        await this.$refs.trainApplyForm.validate().then(async () => {\n          this.form = { ...this.form, ...this.$refs.trainApplyForm.form }\n          let result = []\n          Object.keys(this.rules).forEach((key) => {\n            if (!this.form[key]) {\n              result.push(this.rules[key])\n            }\n          })\n          if (result.length > 0) {\n            this.$toast(result[0].message)\n            return\n          }\n          let form = {\n            ...this.form,\n            first_become_time: Date.parse(this.form.time) / 1000 || 0,\n            now_level_grant_time: Date.parse(this.form.now_level_grant_time) / 1000 || 0,\n          }\n          if (form.fileList?.length > 0) {\n            form.avatar = form.fileList[0].url\n          }\n          let res = await this.$api.editWxTrainActivityItem(form)\n          if (res.code == 200) {\n            await this.$toast('ÁºñËæëÊàêÂäü')\n            uniStorage.set('updated', true)\n            uni.navigateBack()\n          } else {\n            this.$toast(res.message)\n          }\n        })\n      } catch (error) {\n        console.warn('error', error)\n      }\n    },\n  },\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.apply-container {\n  padding-top: 32rpx;\n  min-height: 100%;\n  background-color: #fff;\n  .color-grey {\n    color: rgba(122, 134, 154, 1);\n  }\n  .w-50 {\n    width: 50%;\n  }\n  .pd-32 {\n    padding: 32rpx;\n  }\n  .flex-justify-center {\n    display: flex;\n    justify-content: center;\n  }\n  .flex-between {\n    display: flex;\n    justify-content: space-between;\n  }\n\n  .train-header {\n    .train-title {\n      // overflow: hidden;\n      padding: 32rpx;\n      margin: 0 32rpx 32rpx;\n      // height: 300rpx;\n      background: linear-gradient(180deg, rgba(64, 158, 255, 0.31) 0%, rgba(116, 205, 255, 0) 100%);\n      border-radius: 16rpx;\n      .train-item {\n        font-size: 0.875rem;\n      }\n      .uv-line-2 {\n        font-size: 32rpx;\n        font-weight: 600;\n      }\n    }\n  }\n  .form-container {\n    padding: 0 32rpx;\n    font-size: 28rpx;\n    color: #606266;\n    font-weight: 400;\n  }\n\n  .submit-btn {\n    color: $hubei-primary;\n  }\n}\n\n.common-title {\n  color: $hubei-primary;\n  font-weight: 600;\n  font-size: 32rpx;\n  width: 100%;\n  height: 80rpx;\n  line-height: 80rpx;\n  padding: 0 40rpx;\n  margin-top: 32rpx;\n  opacity: 1;\n  border-radius: 80rpx;\n  background: linear-gradient(227.21deg, rgba(30, 141, 255, 0) 0%, rgba(48, 148, 255, 0.17) 100%);\n}\n</style>\n","import MiniProgramPage from '/Users/guoxiaoming/code/papa-code/pm-yn/uniapp-social-sports-new/src/pages-sub/trainApply/detail.vue'\nwx.createPage(MiniProgramPage)"],"names":["rules","uniStorage","uni"],"mappings":"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"}