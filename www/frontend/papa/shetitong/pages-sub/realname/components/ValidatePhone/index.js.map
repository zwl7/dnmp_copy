{"version":3,"file":"index.js","sources":["../../../../../../../src/pages-sub/realname/components/ValidatePhone/index.vue","../../../../../../../uniComponent:/L1VzZXJzL2d1b3hpYW9taW5nL2NvZGUvcGFwYS1jb2RlL3BtLXluL3VuaWFwcC1zb2NpYWwtc3BvcnRzLW5ldy9zcmMvcGFnZXMtc3ViL3JlYWxuYW1lL2NvbXBvbmVudHMvVmFsaWRhdGVQaG9uZS9pbmRleC52dWU"],"sourcesContent":["<template>\n  <view class=\"h-full px-4 flex flex-col\">\n    <view>\n      <uv-form\n        ref=\"uForm\"\n        :model=\"formData\"\n        :label-width=\"90\"\n        :border-bottom=\"true\"\n        errorType=\"toast\"\n        label-position=\"left\"\n      >\n        <uv-form-item prop=\"phone\">\n          <text>已向绑定的手机号{{ formData.phone }}发送手机验证码</text>\n        </uv-form-item>\n        <uv-form-item prop=\"code\" :customStyle=\"formItemCustomStyle\">\n          <uv-input\n            v-model=\"formData.code\"\n            :focus=\"focus\"\n            border=\"none\"\n            placeholder=\"请输入短信验证码\"\n          >\n            <!-- <template #prefix>\n\t\t\t\t\t\t\t<text>请输入短信验证码</text>\n\t\t\t\t\t\t</template> -->\n            <template #suffix>\n              <uv-code :seconds=\"seconds\" ref=\"uCodeRef\" @change=\"codeChange\"></uv-code>\n              <a @tap=\"getCode\" class=\"code-btn\">{{ tips }}</a>\n            </template>\n          </uv-input>\n        </uv-form-item>\n      </uv-form>\n    </view>\n    <view class=\"center pt-30\">\n      <view class=\"next-step\">\n        <uv-button\n          type=\"primary\"\n          text=\"下一步\"\n          shape=\"circle\"\n          @click=\"handleSubmit\"\n          plain\n        ></uv-button>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script>\nimport * as user from '@/api/user/index'\nimport uniStorage from '@/utils/storages/uniStorage'\nimport { isMp } from '@/utils/platform'\nexport default {\n  props: {\n    handler: {\n      type: Function,\n      default: () => () => {},\n    },\n    params: {\n      type: Object,\n      default: () => ({}),\n    },\n  },\n  data() {\n    return {\n      formItemCustomStyle: {\n        background: 'rgba(246, 248, 252, 1)',\n        padding: '24rpx 32rpx',\n        borderRadius: '12rpx',\n        marginBottom: '24rpx',\n      },\n      focus: false,\n      seconds: 60,\n      tips: '',\n      formData: {\n        phone: '',\n        code: '',\n      },\n      formRules: {\n        code: {\n          type: 'string',\n          required: true,\n          message: '验证码不能为空',\n          trigger: ['blur'],\n        },\n      },\n    }\n  },\n  computed: {\n    userInfo() {\n      return this.$store.user.userInfo\n    },\n  },\n  created() {\n    this.formData = {\n      ...this.formData,\n      ...this.params,\n    }\n  },\n  mounted() {\n    this.$refs.uForm.setRules(this.formRules)\n    this.codeStart()\n  },\n  methods: {\n    codeStart() {\n      this.focus = true\n      this.$refs.uCodeRef.start()\n    },\n    async handleSubmit() {\n      if (isMp) {\n        this.platFormSubmit()\n      } else {\n        this.h5Submit()\n      }\n    },\n    async h5Submit() {\n      try {\n        await this.$refs.uForm.validate()\n      } catch (error) {\n        console.warn('error', error)\n        return\n      }\n      const params = {\n        ...this.formData,\n        code: this.formData.code,\n        token: uniStorage.get('token'),\n      }\n      this.$loading(true)\n      const res = await user.codeAuth(params)\n      this.$loading(false)\n      if (res.code == 200) {\n        const codeAuthed = res.data\n        if (codeAuthed) {\n          let form = codeAuthed.instructor_info || {}\n          this.$store.user.userInfo = {\n            ...form,\n            ...this.$store.user.userInfo,\n            instructor_info: form,\n          }\n          this.$store.user.userInfo.is_authenticate = 1\n          form = {\n            ...form,\n            avatar: form.avatar_str,\n            tagIdsStr: (form.tag_ids_arr || [])\n              .map((item) => {\n                return item.tag_id_str\n              })\n              .join(','),\n            tagGroup: `${form.province_str}/${form.city_str}/${form.county_str}`,\n            nationStr: form.nation_str,\n            educationLevelStr: form.education_level_str,\n            levelStr: form.level_str,\n            guide_type: form.guide_type,\n            guideTypeStr: form.guide_type_str,\n            personnelFormStr: form.personnel_form_str,\n            time:\n              form.first_become_time == 0\n                ? ''\n                : this.$dayjs(form.first_become_time * 1000).format('YYYY-MM-DD'),\n            now_level_grant_time:\n              form.now_level_grant_time == 0\n                ? ''\n                : this.$dayjs(form.now_level_grant_time * 1000).format('YYYY-MM-DD'),\n            status_str: form.status_str || this.$dict.getDictLabel('statusColor', form.status, {}),\n            areaRangeStr: form.area_range_str,\n          }\n          this.handler({\n            active: 2,\n            params: {\n              ...params,\n              memberInfo: form,\n            },\n          })\n        }\n      } else {\n        uni.showModal({\n          title: '提示',\n          showCancel: false,\n          confirmText: '我知道了',\n          content: res.message,\n          success: (e) => {\n            console.log(e)\n          },\n        })\n      }\n    },\n    async platFormSubmit() {\n      try {\n        await this.$refs.uForm.validate()\n      } catch (error) {\n        console.warn('error', error)\n        return\n      }\n      const params = {\n        ...this.formData,\n        code: this.formData.code,\n        token: uniStorage.get('token'),\n      }\n      this.$loading(true)\n      const res = await user.platformCodeAuth(params)\n      this.$loading(false)\n      if (res.code == 200) {\n        const codeAuthed = res.data\n        if (codeAuthed) {\n          this.$store.user.getUserInfo()\n          let form = codeAuthed.instructor_info?.rs || {}\n          form = {\n            ...form,\n            avatar: form.avatar_str,\n            tagIdsStr: (form.tag_ids_arr || [])\n              .map((item) => {\n                return item.tag_id_str\n              })\n              .join(','),\n            tagGroup: `${form.province_str}/${form.city_str}/${form.county_str}`,\n            nationStr: form.nation_str,\n            educationLevelStr: form.education_level_str,\n            levelStr: form.level_str,\n            guide_type: form.guide_type,\n            guideTypeStr: form.guide_type_str,\n            personnelFormStr: form.personnel_form_str,\n            time:\n              form.first_become_time == 0\n                ? ''\n                : this.$dayjs(form.first_become_time * 1000).format('YYYY-MM-DD'),\n            now_level_grant_time:\n              form.now_level_grant_time == 0\n                ? ''\n                : this.$dayjs(form.now_level_grant_time * 1000).format('YYYY-MM-DD'),\n            status_str: form.status_str || this.$dict.getDictLabel('statusColor', form.status, {}),\n            areaRangeStr: form.area_range_str,\n          }\n          this.handler({\n            active: 2,\n            params: {\n              ...params,\n              memberInfo: form,\n            },\n          })\n        }\n      } else {\n        uni.showModal({\n          title: '提示',\n          showCancel: false,\n          confirmText: '我知道了',\n          content: res.message,\n          success: (e) => {\n            console.log(e)\n          },\n        })\n      }\n    },\n    async getCode() {\n      this.focus = true\n      const params = {\n        ...this.formData,\n      }\n      await this.$api.userAuth(params)\n      this.$refs.uCodeRef.start()\n    },\n    codeChange(text) {\n      this.tips = text\n    },\n  },\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.code-btn {\n  color: $hubei-primary;\n}\n\n:deep(.uv-form-item__body__right__message) {\n  margin: 0 !important;\n}\n\n:deep(.uv-input__content__subfix-icon) {\n  margin-right: 10px;\n}\n\n.next-step {\n  width: 45%;\n}\n.center {\n  display: flex;\n  justify-content: center;\n}\n.suffix-idcard {\n  color: rgba(168, 171, 178, 1);\n}\n</style>\n","import Component from '/Users/guoxiaoming/code/papa-code/pm-yn/uniapp-social-sports-new/src/pages-sub/realname/components/ValidatePhone/index.vue'\nwx.createComponent(Component)"],"names":["isMp","uniStorage","user.codeAuth","uni","user.platformCodeAuth"],"mappings":"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"}