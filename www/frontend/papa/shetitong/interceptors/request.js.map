{"version":3,"file":"request.js","sources":["../../../../src/interceptors/request.ts"],"sourcesContent":["/* eslint-disable no-param-reassign */\nimport qs from 'qs'\nimport { useUserStore } from '@/store/index'\nimport { platform } from '@/utils/platform'\nimport { getEvnBaseUrl, getEvnCompanyID } from '@/utils'\nexport type CustomRequestOptions = UniApp.RequestOptions & {\n  query?: Record<string, any>\n  /** 出错时是否隐藏错误提示 */\n  hideErrorToast?: boolean\n} & IUniUploadFileOptions // 添加uni.uploadFile参数类型\n\n// 请求基准地址\nconst baseUrl = getEvnBaseUrl()\nconst companyId = getEvnCompanyID()\n\n// 拦截器配置\nconst httpInterceptor = {\n  invoke(options: CustomRequestOptions) {\n    if (options.query) {\n      const queryStr = qs.stringify(options.query)\n      if (options.url.includes('?')) {\n        options.url += `&${queryStr}`\n      } else {\n        options.url += `?${queryStr}`\n      }\n    }\n    // 非 http 开头需拼接地址\n    if (!options.url.startsWith('http')) {\n      // #ifdef H5\n      if (JSON.parse(__VITE_APP_PROXY__)) {\n        // 啥都不需要做\n      } else {\n        options.url = baseUrl + options.url\n      }\n      // #endif\n      // #ifndef H5\n      options.url = baseUrl + options.url\n      // #endif\n    }\n    options.timeout = 10000 // 10s\n    options.header = {\n      ...options.header,\n      origin: baseUrl.split('://')[1],\n    }\n    if (typeof options.data === 'object') {\n      options.data = {\n        ...options.data,\n        company_id: companyId,\n      }\n    }\n    // 3. 添加 token 请求头标识\n    const userStore = useUserStore()\n    const token = userStore.token\n    if (token) {\n      options.header.Authorization = `${token}`\n    }\n  },\n  success(options: UniApp.RequestSuccessCallbackResult) {\n    return options\n  },\n}\n\nexport const requestInterceptor = {\n  install() {\n    // 拦截 request 请求\n    uni.addInterceptor('request', httpInterceptor)\n    // 拦截 uploadFile 文件上传\n    uni.addInterceptor('uploadFile', httpInterceptor)\n  },\n}\n"],"names":["getEvnBaseUrl","getEvnCompanyID","qs","useUserStore","uni"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAYA,MAAM,UAAUA,YAAAA,cAAc;AAC9B,MAAM,YAAYC,YAAAA,gBAAgB;AAGlC,MAAM,kBAAkB;AAAA,EACtB,OAAO,SAA+B;AACpC,QAAI,QAAQ,OAAO;AACjB,YAAM,WAAWC,cAAA,GAAG,UAAU,QAAQ,KAAK;AAC3C,UAAI,QAAQ,IAAI,SAAS,GAAG,GAAG;AACrB,gBAAA,OAAO,IAAI,QAAQ;AAAA,MAAA,OACtB;AACG,gBAAA,OAAO,IAAI,QAAQ;AAAA,MAAA;AAAA,IAC7B;AAGF,QAAI,CAAC,QAAQ,IAAI,WAAW,MAAM,GAAG;AAS3B,cAAA,MAAM,UAAU,QAAQ;AAAA,IAAA;AAGlC,YAAQ,UAAU;AAClB,YAAQ,SAAS,iCACZ,QAAQ,SADI;AAAA,MAEf,QAAQ,QAAQ,MAAM,KAAK,EAAE,CAAC;AAAA,IAChC;AACI,QAAA,OAAO,QAAQ,SAAS,UAAU;AACpC,cAAQ,OAAO,iCACV,QAAQ,OADE;AAAA,QAEb,YAAY;AAAA,MACd;AAAA,IAAA;AAGF,UAAM,YAAYC,iBAAAA,aAAa;AAC/B,UAAM,QAAQ,UAAU;AACxB,QAAI,OAAO;AACD,cAAA,OAAO,gBAAgB,GAAG,KAAK;AAAA,IAAA;AAAA,EAE3C;AAAA,EACA,QAAQ,SAA8C;AAC7C,WAAA;AAAA,EAAA;AAEX;AAEO,MAAM,qBAAqB;AAAA,EAChC,UAAU;AAEJC,wBAAA,eAAe,WAAW,eAAe;AAEzCA,wBAAA,eAAe,cAAc,eAAe;AAAA,EAAA;AAEpD;;"}