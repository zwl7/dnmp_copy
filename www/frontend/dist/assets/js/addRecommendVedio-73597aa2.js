import{d as O,r as n,$ as Z,I as P,e as p,o as C,a as $,b as S,f as a,w as o,q as r,m as ee,u as l,F as W,p as H,h as R,E as j,_ as J,A as te,P as ue,Q as ae,g as oe,N as le,U as se,x as ie,k as ne,y as de,z as re}from"./index-73817fb6.js";import{F as ce}from"./index-dfa22ab7.js";import{V as pe}from"./index-c0d3fb64.js";import{I as me}from"./Imgs-dbc6d0a0.js";import{h as _e,b as fe,c as ve}from"./upload-d8b475c5.js";import{u as ge}from"./useFormEdit-e635c879.js";import{K as Fe}from"./tabs-3df7d807.js";import{g as ye}from"./saihui-f69ee65f.js";import{m as Ee,n as Ce,o as be}from"./operatManage-c4d273ad.js";const we={class:"local-container",style:{position:"relative"}},Ae={class:"el-upload__tip font-grey"},Be=O({__name:"VideoHw",emits:["success","delete"],setup(A,{emit:B}){const h=n(1024),L=n(["video/mp4"]),x=n(0),z=n(!1),V=n(!1),F=n(null),D=n(!0),y=n({}),c=n(null),E=Z({time_len:0,size:0,url:""}),b=s=>{const m=s.size/1024/1024<h.value,_=L.value;return _.includes(s.type)||j({title:"\u6E29\u99A8\u63D0\u793A",message:"\u4E0A\u4F20\u7684\u89C6\u9891\u4E0D\u7B26\u5408\u6240\u9700\u7684\u683C\u5F0F\uFF01",type:"warning"}),m||j({title:"\u6E29\u99A8\u63D0\u793A",message:`\u4E0A\u4F20\u7684\u89C6\u9891\u5927\u5C0F\u4E0D\u80FD\u8D85\u8FC7 ${h.value}M\uFF01`,type:"warning"}),_.includes(s.type)&&m},t=async s=>{const m=URL.createObjectURL(s.file),_=new Audio(m);_.addEventListener("loadedmetadata",function(e){E.time_len=_.duration});const f=s.file,{data:v}=await _e({title:f.name.split(".")[0],video_name:f.name.split(".")[0],video_type:f.type.split("/")[1].toUpperCase()}),u={videoFile:f,bucket:v.target.bucket,location:v.target.location,object:v.target.object,asset_id:v.asset_id,is_check:!1};E.size=f.size,V.value=!0;try{c.value.addAsset(u),c.value.startUpload()}catch{}},U=()=>{c.value||(c.value=new VodClient({access_key_id:F.value.access,secret_access_key:F.value.secret,security_token:F.value.securitytoken,project_id:"09cb3c544e8010582fc1c006957ef9cf",vod_server:"vod.cn-north-4.myhuaweicloud.com",vod_port:"",onUploadstarted:function(s){},onUploadProgress:s=>{x.value=s.progress},onUploadSucceed:async s=>{const{data:m}=await fe({asset_id:s.asset_id});m&&(z.value=!1,E.url=m.video_url,B("success",E))},onUploadFailed:function(s,m){},onUploadTokenExpired:async function(){c.value="",await I(),U()}}))},q=()=>{j({title:"\u6E29\u99A8\u63D0\u793A",message:"\u5F53\u524D\u6700\u591A\u53EA\u80FD\u4E0A\u4F20 1 \u4E2A\u89C6\u9891\uFF0C\u8BF7\u79FB\u9664\u540E\u4E0A\u4F20\uFF01",type:"warning"})},N=s=>{V.value=!1,B("delete",s),c.value&&c.value.cancelUpload(0)},I=async()=>{const{data:s}=await ve({});F.value=s.credential};return P(async()=>{await I(),U()}),(s,m)=>{const _=p("el-button"),f=p("el-upload"),v=p("el-progress");return C(),$("div",null,[S("div",we,[a(f,{class:"upload-demo",action:"#","http-request":t,"list-type":"text",name:"image",data:l(y),limit:1,"before-upload":b,"on-exceed":q,"on-remove":N},{trigger:o(()=>[a(_,{type:"primary",plain:""},{default:o(()=>[r("\u89C6\u9891\u4E0A\u4F20")]),_:1}),ee(s.$slots,"button",{},void 0,!0)]),tip:o(()=>[S("div",Ae,[l(D)?(C(),$(W,{key:0},[r("\u53EA\u80FD\u4E0A\u4F20\u89C6\u9891\u6587\u4EF6")],64)):H("v-if",!0)])]),_:3},8,["data"]),l(V)?(C(),R(v,{key:0,style:{width:"400px"},percentage:l(x),status:l(z)===!1?"":"success"},null,8,["percentage","status"])):H("v-if",!0)])])}}});const he=J(Be,[["__scopeId","data-v-27265574"],["__file","/Users/zwl/dnmp/www/frontend/ppos-sport-online/src/components/Upload/VideoHw.vue"]]),Ve={name:[{required:!0,message:"\u8BF7\u8F93\u5165\u89C6\u9891\u6807\u9898",trigger:"change"},{max:20,message:"\u6700\u591A20\u4E2A\u5B57\u7B26",trigger:"change"}],match_id:[{required:!0,message:"\u8BF7\u9009\u62E9\u6240\u5C5E\u8D5B\u4F1A",trigger:"change"}],imagesList:[{required:!0,message:"\u8BF7\u9009\u62E9\u6216\u4E0A\u4F20\u5C01\u9762\u56FE\u7247",trigger:"change"}],admin_status:[{required:!0,message:"\u8BF7\u9009\u62E9\u516C\u544A\u72B6\u6001 ",trigger:"change"}],type_two:[{required:!0,message:"\u8BF7\u9009\u62E9\u89C6\u9891\u7C7B\u578B",trigger:"change"}]},Q=A=>(de("data-v-7b0b9b0c"),A=A(),re(),A),De=Q(()=>S("span",{class:"tip"},"2M",-1)),Ue=Q(()=>S("span",{class:"tip"},"jpeg/jpg/png",-1)),ke=O({__name:"addRecommendVedio",setup(A){const{closeCurrent:B,ruleFormRef:h,setTitle:L,loading:x,addMethod:z,updateMethod:V}=ge(),F=Fe(),D=te(),y=n(D.query.activity_video_id),c=n(!1),E=n([]),b=n(""),t=n({match_id:"",name:"",images:"",imagesList:[],type_two:"1",des:"",url:"",admin_status:"1",time_len:0,size:0}),U=n(!1),q=async u=>{u.validate(async(e,g)=>{if(e){if(!U.value&&!y.value){ie.warning("\u8BF7\u5148\u4E0A\u4F20\u5B8C\u89C6\u9891");return}let w=I(),d=z;y.value&&(w.activity_video_id=y.value,d=V),(await d(y.value?Ee:Ce,w)).flag&&(B(),localStorage.removeItem("saihuiContent"))}})},N=()=>{B()},I=()=>{let u=JSON.parse(JSON.stringify(t.value)),e=u.imagesList.map(g=>g.url);return u.images=e.join(","),u.imagesList&&delete u.imagesList,u},s=async()=>{let u={activity_video_id:y.value},e=await be(u);if(e.code==200){t.value.name=e.data.name,t.value.match_id=e.data.match_id,t.value.des=e.data.des,t.value.type_two=String(e.data.type_two);let g=e.data.images.split(",").map((w,d)=>({name:String(d),url:w}));t.value.url=e.data.url,b.value=e.data.url,t.value.time_len=e.data.time_len,t.value.size=e.data.size,await ne(),t.value.imagesList=g}},m=async()=>{c.value=!0},_=u=>{t.value.time_len=u.time_len*1e3,t.value.size=u.size,t.value.url=u.url,b.value=u.url,U.value=!0},f=()=>{t.value.url=""},v=async()=>{let u=await ye();u.code==200&&(E.value=u.data)};return ue((u,e,g)=>{u.name==="wordEdit"?F.addKeepAliveName(e.name):F.removeKeepAliveName(e.name),g()}),ae(()=>{try{let u=JSON.parse(localStorage.getItem("saihuiAdd"));u&&(t.value.name=u.title,t.value.des=u.content)}catch(u){console.error("-------\u7F13\u5B58\u89E3\u6790\u9519\u8BEF",u)}}),P(()=>{v(),D.query.activity_video_id?(L(`\u89C6\u9891\u63A8\u8350_${D.query.activity_video_id}`),s()):L("\u89C6\u9891\u63A8\u8350\u65B0\u589E")}),(u,e)=>{const g=p("el-option"),w=p("el-select"),d=p("el-form-item"),T=p("el-input"),k=p("el-radio"),K=p("el-radio-group"),M=p("el-button"),G=p("el-col"),X=p("el-form");return C(),R(ce,null,{default:o(()=>[a(X,{model:l(t),rules:l(Ve),ref_key:"ruleFormRef",ref:h,"label-width":"120px"},{default:o(()=>[a(G,{span:10},{default:o(()=>[a(d,{label:"\u6240\u5C5E\u8D5B\u4F1A",prop:"match_id"},{default:o(()=>[a(w,{modelValue:l(t).match_id,"onUpdate:modelValue":e[0]||(e[0]=i=>l(t).match_id=i),placeholder:"\u8BF7\u9009\u62E9\u6240\u5C5E\u8D5B\u4F1A",style:{width:"60%"}},{default:o(()=>[(C(!0),$(W,null,oe(l(E),(i,Y)=>(C(),R(g,{key:Y,label:i.name,value:i.match_id,disabled:i.status!==1},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(d,{label:"\u89C6\u9891\u6807\u9898",prop:"name"},{default:o(()=>[a(T,{modelValue:l(t).name,"onUpdate:modelValue":e[1]||(e[1]=i=>l(t).name=i),placeholder:"\u8BF7\u8F93\u5165\u89C6\u9891\u6807\u9898"},null,8,["modelValue"])]),_:1}),a(d,{label:"\u89C6\u9891\u7C7B\u578B",prop:"type_two"},{default:o(()=>[a(K,{modelValue:l(t).type_two,"onUpdate:modelValue":e[2]||(e[2]=i=>l(t).type_two=i)},{default:o(()=>[a(k,{label:"1"},{default:o(()=>[r("\u5065\u8EAB\u6307\u5BFC")]),_:1}),a(k,{label:"2"},{default:o(()=>[r("\u4F24\u75C5\u5904\u7406")]),_:1}),a(k,{label:"3"},{default:o(()=>[r("\u5176\u4ED6")]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(d,{label:"\u5C01\u9762",prop:"imagesList"},{default:o(()=>[a(me,{fileList:l(t).imagesList,"onUpdate:fileList":e[3]||(e[3]=i=>l(t).imagesList=i),fileSize:5,limit:1},{tip:o(()=>[r(" \u8BF7\u4E0A\u4F20\u5927\u5C0F\u4E0D\u8D85\u8FC7 "),De,r(" \u683C\u5F0F\u4E3A"),Ue,r("\u7684\u56FE\u7247 ")]),_:1},8,["fileList"])]),_:1}),a(d,{required:"",label:"\u89C6\u9891\u4E0A\u4F20"},{default:o(()=>[S("div",null,[a(he,{onSuccess:_,onDelete:f}),Boolean(l(t).url)?(C(),R(M,{key:0,plain:"",onClick:le(m,["prevent"])},{default:o(()=>[r("\u67E5\u770B\u89C6\u9891")]),_:1},8,["onClick"])):H("v-if",!0)])]),_:1}),a(d,{label:"\u89C6\u9891\u8BF4\u660E",prop:"des"},{default:o(()=>[a(T,{placeholder:"\u8BF7\u8F93\u5165\u89C6\u9891\u8BF4\u660E",modelValue:l(t).des,"onUpdate:modelValue":e[4]||(e[4]=i=>l(t).des=i),type:"textarea"},null,8,["modelValue"])]),_:1}),a(d,{label:"\u72B6\u6001",prop:"admin_status"},{default:o(()=>[a(K,{modelValue:l(t).admin_status,"onUpdate:modelValue":e[5]||(e[5]=i=>l(t).admin_status=i)},{default:o(()=>[a(k,{label:"1"},{default:o(()=>[r("\u53D1\u5E03")]),_:1}),a(k,{label:"2"},{default:o(()=>[r("\u6682\u4E0D\u53D1\u5E03")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(d,null,{default:o(()=>[a(M,{type:"primary",loading:l(x),onClick:e[6]||(e[6]=i=>q(l(h)))},{default:o(()=>[r("\u521B\u5EFA")]),_:1},8,["loading"]),a(M,{onClick:N},{default:o(()=>[r("\u53D6\u6D88")]),_:1})]),_:1})]),_:1},8,["model","rules"]),a(pe,{visible:l(c),"onUpdate:visible":e[7]||(e[7]=i=>se(c)?c.value=i:null),title:"\u89C6\u9891\u64AD\u653E",url:l(b),poster:l(b)},null,8,["visible","url","poster"])]),_:1})}}});const Me=J(ke,[["__scopeId","data-v-7b0b9b0c"],["__file","/Users/zwl/dnmp/www/frontend/ppos-sport-online/src/views/operatManage/addRecommendVedio.vue"]]);export{Me as default};
