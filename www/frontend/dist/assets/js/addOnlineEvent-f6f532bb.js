import{d as te,r as h,A as ue,B as ae,P as le,Q as ie,I as oe,e as m,o as f,h as w,w as o,f as i,u as l,a as x,g as N,F as z,q as c,p as re,b as O,x as de,R as se,k as ne,_ as me}from"./index-73817fb6.js";import{F as pe}from"./index-dfa22ab7.js";import{W as _e}from"./index-da48d765.js";import{I as ce}from"./Imgs-dbc6d0a0.js";import{C as Fe}from"./Cascader-97df9fc1.js";import{u as ge}from"./useFormEdit-e635c879.js";import{K as fe}from"./tabs-3df7d807.js";import{u as Ee,b as ve,c as Be}from"./event-3905bdce.js";import{g as he}from"./saihui-f69ee65f.js";import{g as ye}from"./project-7708919b.js";import"./style-6cf98c5c.js";import"./upload-d8b475c5.js";const De={match_id:[{required:!0,message:"\u8BF7\u9009\u62E9\u6240\u5C5E\u8D5B\u4F1A",trigger:"change"}],name:[{required:!0,message:"\u8BF7\u8F93\u5165\u8D5B\u4F1A\u540D\u79F0",trigger:"change"},{max:20,message:"\u6700\u591A20\u4E2A\u5B57\u7B26",trigger:"change"}],project_id:[{required:!0,message:"\u8BF7\u9009\u62E9\u6240\u5C5E\u9879\u76EE",trigger:"change"}],imagesList:[{required:!0,message:"\u8BF7\u9009\u62E9\u6216\u4E0A\u4F20\u5C01\u9762\u56FE\u7247",trigger:"change"}],organizational_unit:[{required:!0,message:"\u8BF7\u8F93\u5165\u4E3E\u529E\u5355\u4F4D ",trigger:"change"}],hold_unit:[{required:!0,message:"\u8BF7\u8F93\u5165\u627F\u529E\u5355\u4F4D ",trigger:"change"}],match_time:[{required:!0,message:"\u8BF7\u9009\u62E9\u6BD4\u8D5B\u65F6\u95F4 ",trigger:"change"}],apply_time:[{required:!0,message:"\u8BF7\u9009\u62E9\u62A5\u540D\u65F6\u95F4 ",trigger:"change"}],upload_time:[{required:!0,message:"\u8BF7\u9009\u4E0A\u4F20\u4F5C\u54C1\u65F6\u95F4 ",trigger:"change"}],vote_start_time:[{required:!0,message:"\u8BF7\u9009\u5206\u6570\u7EDF\u8BA1\u622A\u6B62\u65F6\u95F4 ",trigger:"change"}],awards_time:[{required:!0,message:"\u8BF7\u9009\u62E9\u8BC1\u4E66\u9881\u53D1\u65F6\u95F4 ",trigger:"change"}],status:[{required:!0,message:"\u8BF7\u9009\u62E9\u8D5B\u4F1A\u72B6\u6001 ",trigger:"change"}],des:[{required:!0,message:"\u8BF7\u8F93\u5165\u8D5B\u4E8B\u4ECB\u7ECD ",trigger:"change"}]},Ce=O("span",{class:"tip"},"2M",-1),we=O("span",{class:"tip"},"jpeg/jpg/png",-1),be=te({__name:"addOnlineEvent",setup(Ae){const{closeCurrent:b,ruleFormRef:A,setTitle:V,loading:R,addMethod:I,updateMethod:K}=ge(),j=fe(),u=h({match_id:"",city_id:"",cities:[],project_id:"",name:"",images:"",imagesList:[],organizational_unit:"",hold_unit:"",match_time:[],match_start_time:"",match_end_time:"",apply_time:[],apply_start_time:"",apply_end_time:"",upload_time:[],upload_start_time:"",upload_end_time:"",vote_start_time:"",awards_time:"",status:"1",des:""}),y=ue(),P=ae(),p=h(y.query.match_activity_id),J=async e=>{e.validate(async(t,d)=>{if(t){if(!$())return;let s=L(),r=I;p.value&&(s.match_activity_id=p.value,r=K),(await r(p.value?Ee:ve,s)).flag&&b()}else Object.keys(d).forEach((s,r)=>{const n=d[s][0].field;r==0&&e.scrollToField(n)})})},W=()=>{b()},$=()=>{let e=L(),t=new Date(e.apply_start_time).getTime();return new Date(e.upload_start_time).getTime()<t?(de.warning("\u4E0A\u4F20\u4F5C\u54C1\u65F6\u95F4\u5E94\u5927\u4E8E\u62A5\u540D\u5F00\u59CB\u65F6\u95F4"),!1):!0},L=()=>{let e=JSON.parse(JSON.stringify(u.value)),t=e.imagesList.map(n=>n.url);e.cities?(e.city_id=e.cities[u.value.cities.length-1],e.cities&&delete e.cities):e.city_id=0,e.images=t.join(","),e.imagesList&&delete e.imagesList;let d=D(e.match_time);e.match_start_time=d.start,e.match_end_time=d.end,e.match_time&&delete e.match_time;let s=D(e.apply_time);e.apply_start_time=s.start,e.apply_end_time=s.end,e.apply_time&&delete e.apply_time;let r=D(e.upload_time);return e.upload_start_time=r.start,e.upload_end_time=r.end,e.upload_time&&delete e.upload_time,e.vote_start_time=Math.floor(new Date(e.vote_start_time).getTime()/1e3),e.vote_time&&delete e.vote_time,e.awards_time=Math.floor(new Date(e.awards_time).getTime()/1e3),e},D=e=>{let t={start:"",end:""};return e.length>0&&(t.start=Math.floor(new Date(e[0]).getTime()/1e3),t.end=Math.floor(new Date(e[1]).getTime()/1e3)),t},H=async()=>{let e={match_activity_id:p.value},t=await Be(e);if(t.code==200){let{match_id:d,city_id:s,name:r,project_id:n,organizational_unit:_,hold_unit:E,des:C,match_start_time:v,match_end_time:g,apply_start_time:B,apply_end_time:a,upload_end_time:F,upload_start_time:M,vote_start_time:S,vote_end_time:Ve,awards_time:T}=t.data;u.value.match_id=d,u.value.cities=se(String(s)),u.value.cities,u.value.name=r,u.value.project_id=n;let Y=t.data.images.split(",").map((Z,ee)=>({name:String(ee),url:Z}));await ne(),u.value.imagesList=Y,u.value.organizational_unit=_,u.value.hold_unit=E,u.value.des=C,u.value.status=String(t.data.status),v&&g&&(u.value.match_time=[new Date(v*1e3),new Date(g*1e3)]),B&&a&&(u.value.apply_time=[new Date(B*1e3),new Date(a*1e3)]),M&&F&&(u.value.upload_time=[new Date(M*1e3),new Date(F*1e3)]),S&&(u.value.vote_start_time=new Date(S*1e3)),T&&(u.value.awards_time=new Date(T*1e3)),U(t.data.match_id)}},Q=()=>{localStorage.setItem("evntContent",u.value.des),P.push({name:"wordEdit",query:{type:"evntAdd",title:u.value.name,id:p.value}})};le((e,t,d)=>{e.name==="wordEdit"?j.addKeepAliveName(t.name):j.removeKeepAliveName(t.name),d()}),ie(()=>{try{let e=JSON.parse(localStorage.getItem("evntAdd"));e&&(u.value.name=e.title,u.value.des=e.content)}catch(e){console.error("-------\u7F13\u5B58\u89E3\u6790\u9519\u8BEF",e)}});const G=e=>{U(e),u.value.project_id=""},q=h([]),X=async()=>{let e=await he();e.code==200&&(q.value=e.data)},k=h([]),U=async e=>{let t=await ye({match_id:e});t.code==200&&(k.value=t.data)};return oe(()=>{X(),y.query.match_activity_id?(V(`\u8D5B\u4E8B\u7F16\u8F91_${y.query.match_activity_id}`),H()):V("\u8D5B\u4E8B\u65B0\u589E")}),(e,t)=>{const d=m("el-option"),s=m("el-select"),r=m("el-form-item"),n=m("el-input"),_=m("el-date-picker"),E=m("el-radio"),C=m("el-radio-group"),v=m("el-col"),g=m("el-button"),B=m("el-form");return f(),w(pe,null,{default:o(()=>[i(B,{model:l(u),rules:l(De),ref_key:"ruleFormRef",ref:A,"label-width":"140px"},{default:o(()=>[i(v,{span:12,class:"form-container"},{default:o(()=>[i(r,{label:"\u6240\u5C5E\u8D5B\u4F1A",prop:"match_id"},{default:o(()=>[i(s,{modelValue:l(u).match_id,"onUpdate:modelValue":t[0]||(t[0]=a=>l(u).match_id=a),disabled:Boolean(l(p)),placeholder:"\u8BF7\u9009\u62E9\u6240\u5C5E\u8D5B\u4F1A",onChange:G,style:{width:"60%"}},{default:o(()=>[(f(!0),x(z,null,N(l(q),(a,F)=>(f(),w(d,{key:F,label:a.name,value:a.match_id,disabled:a.status!==1},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),i(r,{label:"\u53D1\u5E03\u57CE\u5E02",prop:"city_id"},{default:o(()=>[i(Fe,{placeholder:"\u8BF7\u9009\u62E9\u53D1\u5E03\u57CE\u5E02",multiple:!1,checkStrictly:!0,value:l(u).cities,"onUpdate:value":t[1]||(t[1]=a=>l(u).cities=a)},null,8,["value"])]),_:1}),i(r,{label:"\u8D5B\u4E8B\u540D\u79F0",prop:"name"},{default:o(()=>[i(n,{modelValue:l(u).name,"onUpdate:modelValue":t[2]||(t[2]=a=>l(u).name=a),placeholder:"\u8BF7\u8F93\u5165\u8D5B\u4E8B\u540D\u79F0"},null,8,["modelValue"])]),_:1}),i(r,{label:"\u6240\u5C5E\u9879\u76EE",prop:"project_id"},{default:o(()=>[i(s,{modelValue:l(u).project_id,"onUpdate:modelValue":t[3]||(t[3]=a=>l(u).project_id=a),disabled:Boolean(l(p)),placeholder:"\u8BF7\u9009\u62E9\u6240\u5C5E\u9879\u76EE",style:{width:"60%"}},{default:o(()=>[(f(!0),x(z,null,N(l(k),(a,F)=>(f(),w(d,{key:F,label:a.name,value:a.project_id,disabled:a.status!==1},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),i(r,{label:"\u8BE6\u60C5\u80CC\u666F",prop:"imagesList"},{default:o(()=>[i(ce,{fileList:l(u).imagesList,"onUpdate:fileList":t[4]||(t[4]=a=>l(u).imagesList=a),fileSize:5,limit:6},{tip:o(()=>[c(" \u8BF7\u4E0A\u4F20\u5927\u5C0F\u4E0D\u8D85\u8FC7 "),Ce,c(" \u683C\u5F0F\u4E3A"),we,c("\u7684\u56FE\u7247 ")]),_:1},8,["fileList"])]),_:1}),i(r,{label:"\u7EC4\u7EC7\u5355\u4F4D",prop:"organizational_unit"},{default:o(()=>[i(n,{modelValue:l(u).organizational_unit,"onUpdate:modelValue":t[5]||(t[5]=a=>l(u).organizational_unit=a),placeholder:"\u8BF7\u8F93\u5165\u7EC4\u7EC7\u5355\u4F4D",type:"textarea"},null,8,["modelValue"])]),_:1}),i(r,{label:"\u627F\u529E\u5355\u4F4D",prop:"hold_unit"},{default:o(()=>[i(n,{modelValue:l(u).hold_unit,"onUpdate:modelValue":t[6]||(t[6]=a=>l(u).hold_unit=a),placeholder:"\u8BF7\u8F93\u5165\u627F\u529E\u5355\u4F4D",type:"textarea"},null,8,["modelValue"])]),_:1}),i(r,{label:"\u6BD4\u8D5B\u65F6\u95F4",prop:"match_time"},{default:o(()=>[i(_,{modelValue:l(u).match_time,"onUpdate:modelValue":t[7]||(t[7]=a=>l(u).match_time=a),type:"datetimerange","range-separator":"\u81F3","start-placeholder":"\u5F00\u59CB\u65F6\u95F4","end-placeholder":"\u7ED3\u675F\u65F6\u95F4",style:{width:"80%"}},null,8,["modelValue"])]),_:1}),i(r,{label:"\u62A5\u540D\u65F6\u95F4",prop:"apply_time"},{default:o(()=>[i(_,{modelValue:l(u).apply_time,"onUpdate:modelValue":t[8]||(t[8]=a=>l(u).apply_time=a),type:"datetimerange","range-separator":"\u81F3","start-placeholder":"\u5F00\u59CB\u65F6\u95F4","end-placeholder":"\u7ED3\u675F\u65F6\u95F4"},null,8,["modelValue"])]),_:1}),i(r,{label:"\u4E0A\u4F20\u4F5C\u54C1\u65F6\u95F4",prop:"upload_time"},{default:o(()=>[i(_,{modelValue:l(u).upload_time,"onUpdate:modelValue":t[9]||(t[9]=a=>l(u).upload_time=a),type:"datetimerange","range-separator":"\u81F3","start-placeholder":"\u5F00\u59CB\u65F6\u95F4","end-placeholder":"\u7ED3\u675F\u65F6\u95F4"},null,8,["modelValue"])]),_:1}),i(r,{label:"\u5206\u6570\u7EDF\u8BA1\u622A\u6B62\u65F6\u95F4",prop:"vote_start_time"},{default:o(()=>[re(` <el-date-picker\r
						v-model="form.vote_time"\r
						type="datetimerange"\r
						range-separator="\u81F3"\r
						start-placeholder="\u5F00\u59CB\u65F6\u95F4"\r
						end-placeholder="\u7ED3\u675F\u65F6\u95F4"\r
					/> `),i(_,{modelValue:l(u).vote_start_time,"onUpdate:modelValue":t[10]||(t[10]=a=>l(u).vote_start_time=a),type:"datetime",placeholder:"\u8BF7\u9009\u5206\u6570\u7EDF\u8BA1\u622A\u6B62\u65F6\u95F4",style:{width:"60%"}},null,8,["modelValue"])]),_:1}),i(r,{label:"\u8BC1\u4E66\u9881\u53D1\u65F6\u95F4",prop:"awards_time"},{default:o(()=>[i(_,{modelValue:l(u).awards_time,"onUpdate:modelValue":t[11]||(t[11]=a=>l(u).awards_time=a),type:"datetime",placeholder:"\u8BF7\u9009\u8BC1\u4E66\u9881\u53D1\u65F6\u95F4",style:{width:"60%"}},null,8,["modelValue"])]),_:1}),i(r,{label:"\u72B6\u6001",prop:"status"},{default:o(()=>[i(C,{modelValue:l(u).status,"onUpdate:modelValue":t[12]||(t[12]=a=>l(u).status=a)},{default:o(()=>[i(E,{label:"1"},{default:o(()=>[c("\u542F\u7528")]),_:1}),i(E,{label:"2"},{default:o(()=>[c("\u7981\u7528")]),_:1})]),_:1},8,["modelValue"])]),_:1}),i(r,{label:"\u8D5B\u4E8B\u4ECB\u7ECD",prop:"des"},{default:o(()=>[i(_e,{value:l(u).des,"onUpdate:value":t[13]||(t[13]=a=>l(u).des=a),title:l(u).name,"onUpdate:title":t[14]||(t[14]=a=>l(u).name=a),hideToolBar:!0,showEditorAll:!0,height:"300px",onEdit:Q},null,8,["value","title"])]),_:1})]),_:1}),i(r,null,{default:o(()=>[i(g,{type:"primary",loading:l(R),onClick:t[15]||(t[15]=a=>J(l(A)))},{default:o(()=>[c("\u521B\u5EFA")]),_:1},8,["loading"]),i(g,{onClick:W},{default:o(()=>[c("\u53D6\u6D88")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1})}}}),Re=me(be,[["__file","/Users/zwl/dnmp/www/frontend/ppos-sport-online/src/views/events/addOnlineEvent.vue"]]);export{Re as default};
