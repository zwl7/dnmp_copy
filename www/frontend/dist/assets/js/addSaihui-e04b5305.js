import{d as k,A as U,B as M,r as h,P as N,Q as R,I as T,e as d,o as j,h as K,w as o,f as a,u as l,q as m,R as J,k as O,y as P,z as W,b as y,_ as $}from"./index-73817fb6.js";import{F as Q}from"./index-dfa22ab7.js";import{W as G}from"./index-da48d765.js";import{I as H}from"./Imgs-dbc6d0a0.js";import{C as X}from"./Cascader-97df9fc1.js";import{u as Y}from"./useFormEdit-e635c879.js";import{K as Z}from"./tabs-3df7d807.js";import{u as ee,a as te,b as ue}from"./saihui-f69ee65f.js";import"./style-6cf98c5c.js";import"./upload-d8b475c5.js";const ae={name:[{required:!0,message:"\u8BF7\u8F93\u5165\u8D5B\u4F1A\u540D\u79F0",trigger:"change"},{max:20,message:"\u6700\u591A20\u4E2A\u5B57\u7B26",trigger:"change"}],imagesList:[{required:!0,message:"\u8BF7\u9009\u62E9\u6216\u4E0A\u4F20\u5C01\u9762\u56FE\u7247",trigger:"change"}],organizer:[{required:!0,message:"\u8BF7\u8F93\u5165\u4E3E\u529E\u5355\u4F4D ",trigger:"change"}],status:[{required:!0,message:"\u8BF7\u9009\u62E9\u8D5B\u4F1A\u72B6\u6001 ",trigger:"change"}],des:[{required:!0,message:"\u8BF7\u8F93\u5165\u8D5B\u4E8B\u4ECB\u7ECD ",trigger:"change"}]},C=c=>(P("data-v-28253803"),c=c(),W(),c),le=C(()=>y("span",{class:"tip"},"2M",-1)),oe=C(()=>y("span",{class:"tip"},"jpeg/jpg/png",-1)),ie=k({__name:"addSaihui",setup(c){const{closeCurrent:_,ruleFormRef:f,setTitle:F,loading:D,addMethod:A,updateMethod:S}=Y(),E=Z(),g=U(),L=M(),p=h(g.query.match_id),t=h({name:"",images:"",imagesList:[],organizer:"",hold_unit:"",des:"",status:"1",cities:[],city_id:""}),b=async u=>{u.validate(async(e,r)=>{if(e){let s=V(),n=A;p.value&&(s.match_id=p.value,n=S),(await n(p.value?ee:te,s)).flag&&(_(),localStorage.removeItem("saihuiContent"))}})},w=()=>{_()},V=()=>{let u=JSON.parse(JSON.stringify(t.value)),e=u.imagesList.map(r=>r.url);return u.images=e.join(","),u.imagesList&&delete u.imagesList,u.cities?(u.city_id=u.cities[t.value.cities.length-1],u.cities&&delete u.cities):u.city_id=0,u},x=async()=>{let u={match_id:p.value},e=await ue(u);if(e.code==200){t.value.name=e.data.name,t.value.organizer=e.data.organizer,t.value.hold_unit=e.data.hold_unit,t.value.des=e.data.des,t.value.status=String(e.data.status);let r=e.data.images.split(",").map((s,n)=>({name:String(n),url:s}));t.value.cities=J(String(e.data.city_id)),await O(),t.value.imagesList=r}},I=()=>{localStorage.setItem("saihuiContent",t.value.des),L.push({name:"wordEdit",query:{type:"saihuiAdd",title:t.value.name,id:p.value}})};return N((u,e,r)=>{u.name==="wordEdit"?E.addKeepAliveName(e.name):E.removeKeepAliveName(e.name),r()}),R(()=>{try{let u=JSON.parse(localStorage.getItem("saihuiAdd"));u&&(t.value.name=u.title,t.value.des=u.content)}catch(u){console.error("-------\u7F13\u5B58\u89E3\u6790\u9519\u8BEF",u)}}),T(()=>{g.query.match_id?(F(`\u8D5B\u4F1A\u7F16\u8F91_${g.query.match_id}`),x()):F("\u8D5B\u4F1A\u65B0\u589E")}),(u,e)=>{const r=d("el-input"),s=d("el-form-item"),n=d("el-radio"),v=d("el-radio-group"),q=d("el-col"),B=d("el-button"),z=d("el-form");return j(),K(Q,null,{default:o(()=>[a(z,{model:l(t),rules:l(ae),ref_key:"ruleFormRef",ref:f,"label-width":"120px"},{default:o(()=>[a(q,{span:10},{default:o(()=>[a(s,{label:"\u8D5B\u4F1A\u540D\u79F0",prop:"name"},{default:o(()=>[a(r,{modelValue:l(t).name,"onUpdate:modelValue":e[0]||(e[0]=i=>l(t).name=i),placeholder:"\u8BF7\u8F93\u5165\u8D5B\u4F1A\u540D\u79F0"},null,8,["modelValue"])]),_:1}),a(s,{label:"\u53D1\u5E03\u57CE\u5E02",prop:"city_id"},{default:o(()=>[a(X,{placeholder:"\u8BF7\u9009\u62E9\u53D1\u5E03\u57CE\u5E02",multiple:!1,checkStrictly:!0,value:l(t).cities,"onUpdate:value":e[1]||(e[1]=i=>l(t).cities=i)},null,8,["value"])]),_:1}),a(s,{label:"\u5C01\u9762",prop:"imagesList"},{default:o(()=>[a(H,{fileList:l(t).imagesList,"onUpdate:fileList":e[2]||(e[2]=i=>l(t).imagesList=i),fileSize:5,limit:1},{tip:o(()=>[m(" \u8BF7\u4E0A\u4F20\u5927\u5C0F\u4E0D\u8D85\u8FC7 "),le,m(" \u683C\u5F0F\u4E3A"),oe,m("\u7684\u56FE\u7247 ")]),_:1},8,["fileList"])]),_:1}),a(s,{label:"\u4E3E\u529E\u5355\u4F4D",prop:"organizer"},{default:o(()=>[a(r,{placeholder:"\u8BF7\u8F93\u5165\u4E3E\u529E\u5355\u4F4D",modelValue:l(t).organizer,"onUpdate:modelValue":e[3]||(e[3]=i=>l(t).organizer=i),type:"textarea"},null,8,["modelValue"])]),_:1}),a(s,{label:"\u627F\u529E\u5355\u4F4D",prop:"hold_unit"},{default:o(()=>[a(r,{placeholder:"\u8BF7\u8F93\u5165\u627F\u529E\u5355\u4F4D",modelValue:l(t).hold_unit,"onUpdate:modelValue":e[4]||(e[4]=i=>l(t).hold_unit=i),type:"textarea"},null,8,["modelValue"])]),_:1}),a(s,{label:"\u8D5B\u4E8B\u4ECB\u7ECD",prop:"des"},{default:o(()=>[a(G,{value:l(t).des,"onUpdate:value":e[5]||(e[5]=i=>l(t).des=i),title:l(t).name,"onUpdate:title":e[6]||(e[6]=i=>l(t).name=i),hideToolBar:!0,showEditorAll:!0,height:"300px",onEdit:I},null,8,["value","title"])]),_:1}),a(s,{label:"\u72B6\u6001",prop:"status"},{default:o(()=>[a(v,{modelValue:l(t).status,"onUpdate:modelValue":e[7]||(e[7]=i=>l(t).status=i)},{default:o(()=>[a(n,{label:"1"},{default:o(()=>[m("\u542F\u7528")]),_:1}),a(n,{label:"2"},{default:o(()=>[m("\u7981\u7528")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(s,null,{default:o(()=>[a(B,{type:"primary",loading:l(D),onClick:e[8]||(e[8]=i=>b(l(f)))},{default:o(()=>[m("\u521B\u5EFA")]),_:1},8,["loading"]),a(B,{onClick:w},{default:o(()=>[m("\u53D6\u6D88")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1})}}});const Fe=$(ie,[["__scopeId","data-v-28253803"],["__file","/Users/zwl/dnmp/www/frontend/ppos-sport-online/src/views/eventsManage/addSaihui.vue"]]);export{Fe as default};
