import{b as B,v as C,w as A,a as g}from"./element-plus.fda9d17d.js";import"./vue.ed337178.js";import{h}from"./http.ed4ad2d7.js";import{_ as b}from"./index.43a84b26.js";import{k as N,d as n,F as P,o as l,c as T,a as V,X as v,W as i,a0 as k,a3 as I,a4 as O,l as x,_ as f,$ as R}from"./@vue.7f0f1fa4.js";const S=a=>h.fetchPost("/pub/export/taskRate",a),L=a=>h.fetchPost("/pub/export/task",a),U=a=>h.fetchPost("/pub/export/taskDel",a);const $={class:"app-container"},j={class:"flex-export-data"},q=N({__name:"index",props:{taskName:String,taskOption:Object},setup(a){const u=a,p=n(""),_=n(0),o=n(0),c=n(0),s=n(1);P(()=>{clearTimeout(c.value)});const F=()=>{D()},d=async()=>{var r;const e={task_name:u.taskName,task_id:o.value,...(r=u.taskOption)==null?void 0:r.param},t=(await S(e)).data;s.value=t.status,t.status===1?(t.completed.path&&(p.value={}.VITE_APP_AUTH_API+t.completed.path),c.value!==0&&g({title:"\u6E29\u99A8\u63D0\u793A",message:"\u5BFC\u51FA\u5B8C\u6210\uFF01",type:"success"})):(t.status===2?(_.value=parseFloat(t.processing.rate),o.value=t.processing.task_id):t.status===3&&(_.value=0,o.value=t.waiting.task_id),c.value=window.setTimeout(d,3e3))},y=async()=>{const e={task_id:o.value};await U(e),g({title:"\u6E29\u99A8\u63D0\u793A",message:"\u5BFC\u51FA\u4EFB\u52A1\u53D6\u6D88\u6210\u529F\uFF01",type:"success"}),clearTimeout(c.value),d()},D=async()=>{var t;const e={task_name:u.taskName,...(t=u.taskOption)==null?void 0:t.param},m=await L(e);o.value=m.data.task_id,d()},E=()=>{const e=document.createElement("a");e.href=p.value,e.download="exportData",e.click()};return(e,m)=>{const t=B,r=C,w=A;return l(),T("div",$,[V("div",j,[s.value!==2?(l(),v(t,{key:0,type:"primary",disabled:s.value===3,onClick:F},{default:i(()=>[f(R(s.value!==3?"\u5BFC\u51FA":"\u7B49\u5F85\u4E2D"),1)]),_:1},8,["disabled"])):k("v-if",!0),s.value===2?(l(),v(w,{key:1,span:8,class:"fr ml-20",align:"right"},{default:i(()=>[x(r,{percentage:_.value,class:"el-progress"},null,8,["percentage"])]),_:1})):k("v-if",!0),s.value!==1?(l(),v(t,{key:2,class:"ml-20",onClick:y},{default:i(()=>[f(" \u53D6\u6D88 ")]),_:1})):k("v-if",!0),I(x(t,{type:"info",onClick:E},{default:i(()=>[f(" \u4E0B\u8F7D\u6570\u636E ")]),_:1},512),[[O,s.value===1&&p.value!==""]])])])}}});var G=b(q,[["__scopeId","data-v-71408747"]]);export{G as d};
