import{b as R,B as W,m as X,n as j,r as G,c as H}from"./element-plus.fda9d17d.js";import"./vue.ed337178.js";import{u as J}from"./vue-router.52e17900.js";import K from"./splitBillDialog.f2077dbf.js";import{h as g}from"./http.ed4ad2d7.js";import{d as h,Q as q,k as O,o as z,c as Y,a as t,l,W as _,$ as s,u as e,U as Z,_ as E,X as Q,aA as tt,aB as it}from"./@vue.7f0f1fa4.js";import{_ as et,t as st}from"./index.43a84b26.js";import"./lodash-es.32c7d6de.js";import"./async-validator.6fbb5f2f.js";import"./@vueuse.a0d26dd7.js";import"./dayjs.8e294223.js";import"./axios.c8347845.js";import"./@element-plus.debac796.js";import"./@ctrl.b082b0c1.js";import"./@popperjs.36402333.js";import"./escape-html.e5dfadb9.js";import"./normalize-wheel-es.8aeb3683.js";import"./qs.fa7a39be.js";import"./side-channel.3e40f30b.js";import"./get-intrinsic.8c87d952.js";import"./has-symbols.caae0f97.js";import"./has-proto.76cff6c7.js";import"./function-bind.cb3858f2.js";import"./has.c1051c46.js";import"./call-bind.208b5ef0.js";import"./object-inspect.ac588fa5.js";import"./pinia.840704ed.js";import"./vue-demi.4b2e6391.js";import"./js-cookie.711e9524.js";import"./nprogress.d7e4ab0b.js";import"./default-passive-events.74004992.js";const at=w=>{const f=h(w.activity_id),y=h(!1),m=q({name:"--",community_name:"--",date:"--",is_free_str:"--",activity_status_str:"--"}),a=()=>{g.fetchPost("/activityPlatform/activity/get",{activity_id:f.value}).then(i=>{if(i.code===200){m.name=i.data.name,m.community_name=i.data.community_name,m.date=i.data.start_time+" \u81F3 "+i.data.end_time,m.is_free_str=i.data.is_free_str;let d=new Date(i.data.end_time).getTime(),c=new Date(i.data.start_time).getTime(),D=new Date().getTime(),B="\u5DF2\u7ED3\u675F";D>d?B="\u5DF2\u7ED3\u675F":D>=c&&D<=d?B="\u8FDB\u884C\u4E2D":D<c&&(B="\u672A\u5F00\u59CB"),m.activity_status_str=B}})},u=q({share_worth:0,worth:0,handle:0,freeze_worth:0,distribution_worth:0,share_distribution_1:0,share_distribution_2:0,share_distribution_3:0,share_distribution_handle:0}),C=()=>{g.fetchPost("/activityPlatform/activity/distributionDetailed",{activity_id:f.value}).then(i=>{if(console.log(i),i.code===200){u.share_worth=i.data.share_worth,u.worth=i.data.worth,u.handle=i.data.handle,u.freeze_worth=i.data.freeze_worth,u.distribution_worth=i.data.distribution_worth;let d=0;u.share_distribution_1=i.data.role_1,u.share_distribution_2=i.data.role_2,u.share_distribution_3=i.data.role_3,i.data.share_detailed.map(c=>{d+=c.handle}),u.share_distribution_handle=d/100}})},F=()=>g.fetchPost("/activityPlatform/activity/distribution",{activity_id:f.value}),V=i=>g.fetchPost("/activityPlatform/activity/distributionPay",i),x=i=>g.fetchPost("/activityPlatform/activity/distributionPayQuery",i),A=h([]);return{activityInfo:m,getActivityDetail:a,collectionInfo:u,getDistributionDetailed:C,handleDistribution:F,handleDistributionPay:V,handleDistributionPayQuery:x,loading:y,activity_id:f,getDistributionList:()=>{g.fetchPost("/activityPlatform/activity/distributionList",{activity_id:f.value,page:1,size:1e3}).then(i=>{i.code===200&&(A.value=i.data.list)})},tableData:A}};const o=w=>(tt("data-v-2896c70e"),w=w(),it(),w),ot={class:"header_container"},lt={class:"button"},ut={class:"line"},nt={class:"title"},dt={class:"tags"},_t={class:"line"},ct={class:"time"},rt={class:"communty"},vt={class:"line money_box"},ht={class:"item"},mt=o(()=>t("div",{class:"label"},"\u5B9E\u9645\u6536\u6B3E",-1)),pt={class:"value"},bt={class:"item"},ft=o(()=>t("div",{class:"label"},"\u5F85\u5212\u62E8\u91D1\u989D",-1)),yt={class:"value"},Dt={class:"item"},Et=o(()=>t("div",{class:"label"},"\u5DF2\u5212\u62E8\u91D1\u989D",-1)),wt={class:"value"},Bt={class:"item"},gt=o(()=>t("div",{class:"label"},"\u51BB\u7ED3\u91D1\u989D",-1)),Ct={class:"value"},Ft={class:"item"},Pt=o(()=>t("div",{class:"label"},"\u624B\u7EED\u8D39",-1)),kt={class:"value"},xt={class:"item"},At=o(()=>t("div",{class:"label"},"\u4E3B\u7406\u4EBA",-1)),It={class:"value"},Vt={class:"item"},Tt=o(()=>t("div",{class:"label"},"\u5E73\u53F0",-1)),St={class:"value"},zt={class:"table_container"},qt={class:"dialog_container"},Qt=o(()=>t("div",{class:"line"},[t("div",{class:"label title"},"\u9884\u8BA1\u5212\u62E8")],-1)),$t={class:"line"},Lt=o(()=>t("div",{class:"label"},"\u4E3B\u7406\u4EBA",-1)),Mt={class:"value"},Nt={class:"line"},Ut=o(()=>t("div",{class:"label"},"\u5E73\u53F0",-1)),Rt={class:"value"},Wt={class:"line"},Xt=o(()=>t("div",{class:"label"},"\u624B\u7EED\u8D39",-1)),jt={class:"value"},Gt=o(()=>t("div",{class:"line"},[t("div",{class:"label title"},"\u8D44\u91D1\u60C5\u51B5")],-1)),Ht={class:"line"},Jt=o(()=>t("div",{class:"label"},"\u5B9E\u9645\u6536\u6B3E",-1)),Kt={class:"value"},Ot={class:"line"},Yt=o(()=>t("div",{class:"label"},"\u5F85\u5212\u62E8\u91D1\u989D",-1)),Zt={class:"value"},ti={class:"line"},ii=o(()=>t("div",{class:"label"},"\u51BB\u7ED3\u91D1\u989D",-1)),ei={class:"value"},si={class:"line"},ai=o(()=>t("div",{class:"label"},"\u5DF2\u5212\u62E8\u91D1\u989D",-1)),oi={class:"value"},li={class:"dialog-footer"},ui=O({__name:"detail",setup(w){const f=J(),{activityInfo:y,getActivityDetail:m,collectionInfo:a,getDistributionDetailed:u,loading:C,activity_id:F,handleDistribution:V,handleDistributionPay:x,handleDistributionPayQuery:A,getDistributionList:T,tableData:i}=at(f.query),d=h(!1),c=h(!1),D=h("");m(),u(),T();const B=st(async()=>{C.value=!0;try{let p=await V();if(C.value=!1,d.value=!1,p.code===200){D.value=p.data.distribution_no;let n={distribution_no:p.data.distribution_no,activity_id:F.value,hiddenMessage:!0},b=await x(n);c.value=!0,$()}}catch{}},300),P=h(0),k=h(""),S=h(1),$=()=>{k.value=setInterval(()=>{P.value%2==0&&L(),P.value=P.value+1,P.value>=30&&(S.value=3,clearInterval(k.value),k.value=null,c.value=!1)},1e3)},L=async()=>{(await A({distribution_no:D.value,activity_id:F.value,hiddenMessage:!0})).code===200&&(S.value=2,clearInterval(k.value),k.value=null,c.value=!1)},M=p=>{let{role_str:n,distribution_no:b}=p,I=`\u6B64\u64CD\u4F5C\u5C06\u5BF9\u3010${n}\u3011\u6536\u76CA\u8FDB\u884C\u5212\u62E8`;H.confirm(I,"\u63D0\u793A",{confirmButtonText:"\u786E\u8BA4",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(async()=>{let r={distribution_no:b,activity_id:F.value};await x(r),T()}).catch(()=>{})};return(p,n)=>{const b=R,I=W,r=X,N=j,U=G;return z(),Y(Z,null,[t("div",ot,[t("div",lt,[l(b,{type:"primary",onClick:n[0]||(n[0]=v=>d.value=!0)},{default:_(()=>[E("\u5212\u62E8")]),_:1})]),t("div",ut,[t("div",nt,s(e(y).name),1),t("div",dt,[l(I,{size:"small"},{default:_(()=>[E(s(e(y).activity_status_str),1)]),_:1}),l(I,{size:"small"},{default:_(()=>[E(s(e(y).is_free_str),1)]),_:1})])]),t("div",_t,[t("div",ct,s(e(y).community_name),1),t("div",rt,s(e(y).date),1)]),t("div",vt,[t("div",ht,[mt,t("div",pt,s(e(a).worth),1)]),t("div",bt,[ft,t("div",yt,s(e(a).share_worth),1)]),t("div",Dt,[Et,t("div",wt,s(e(a).distribution_worth),1)]),t("div",Bt,[gt,t("div",Ct,s(e(a).freeze_worth),1)]),t("div",Ft,[Pt,t("div",kt,s(e(a).handle),1)]),t("div",xt,[At,t("div",It,s(e(a).share_distribution_1),1)]),t("div",Vt,[Tt,t("div",St,s(e(a).share_distribution_3),1)])])]),t("div",zt,[l(N,{data:e(i),border:"",style:{width:"100%"}},{default:_(()=>[l(r,{type:"index",width:"50"}),l(r,{prop:"record_time",label:"\u5212\u62E8\u65F6\u95F4"}),l(r,{prop:"role_str",label:"\u5212\u62E8\u5BF9\u8C61"}),l(r,{prop:"worth",label:"\u5212\u62E8\u91D1\u989D"}),l(r,{prop:"status_str",label:"\u5212\u62E8\u72B6\u6001"}),l(r,{prop:"operator",label:"\u64CD\u4F5C\u4EBA"}),l(r,{prop:"address",label:"\u64CD\u4F5C"},{default:_(v=>[v.row.status==0?(z(),Q(b,{key:0,type:"primary",link:"",onClick:ni=>M(v.row)},{default:_(()=>[E("\u91CD\u65B0\u5212\u62E8")]),_:2},1032,["onClick"])):(z(),Q(b,{key:1,type:"info",link:""},{default:_(()=>[E(s(v.row.status_str),1)]),_:2},1024))]),_:1})]),_:1},8,["data"])]),t("div",null,[l(U,{modelValue:d.value,"onUpdate:modelValue":n[2]||(n[2]=v=>d.value=v),width:"400px","show-close":!1},{footer:_(()=>[t("span",li,[l(b,{onClick:n[1]||(n[1]=v=>d.value=!1)},{default:_(()=>[E("\u53D6\u6D88")]),_:1}),l(b,{type:"primary",loading:e(C),onClick:e(B)},{default:_(()=>[E(" \u786E\u8BA4\u5212\u62E8 ")]),_:1},8,["loading","onClick"])])]),default:_(()=>[t("div",qt,[Qt,t("div",$t,[Lt,t("div",Mt,s(e(a).share_distribution_1),1)]),t("div",Nt,[Ut,t("div",Rt,s(e(a).share_distribution_3),1)]),t("div",Wt,[Xt,t("div",jt,s(e(a).share_distribution_handle),1)]),Gt,t("div",Ht,[Jt,t("div",Kt,s(e(a).worth),1)]),t("div",Ot,[Yt,t("div",Zt,s(e(a).share_worth),1)]),t("div",ti,[ii,t("div",ei,s(e(a).freeze_worth),1)]),t("div",si,[ai,t("div",oi,s(e(a).distribution_worth),1)])])]),_:1},8,["modelValue"])]),t("div",null,[l(K,{modelValue:c.value,"onUpdate:modelValue":n[3]||(n[3]=v=>c.value=v),cucrrentCount:P.value,queryStatus:S.value},null,8,["modelValue","cucrrentCount","queryStatus"])])],64)}}});var Mi=et(ui,[["__scopeId","data-v-2896c70e"]]);export{Mi as default};
